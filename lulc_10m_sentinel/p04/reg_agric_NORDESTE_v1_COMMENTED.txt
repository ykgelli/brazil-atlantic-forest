var rev_agric = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-35.66799570888529, -5.186646318560072],
          [-35.90969492763529, -6.8691244024268325],
          [-36.10744883388529, -8.371803124961009],
          [-36.53591563076029, -8.947438184215246],
          [-35.48122813076029, -8.676022026819764],
          [-34.64626719326029, -8.099977821819303],
          [-34.59133555263529, -6.607274037126748],
          [-35.31643320888529, -4.945891543819747]]]),
    rev01_1985_agric = /* color: #ffc82d */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.27556556202793, -6.124830875541632],
                  [-35.27110236622715, -6.125598941735282],
                  [-35.27024405934238, -6.1215025759370025],
                  [-35.27547973133945, -6.120051772183539]]]),
            {
              "reference": 19,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.24689811207676, -6.120393138126989],
                  [-35.2562536571207, -6.132511487737138],
                  [-35.24578231312656, -6.133364882266181]]]),
            {
              "reference": 19,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.23867930588392, -6.148872858867258],
                  [-35.23885096726087, -6.146142071077558],
                  [-35.24185504135755, -6.146824769339166],
                  [-35.23902262863783, -6.1505795941158965]]]),
            {
              "reference": 19,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.2731832426515, -6.155443759512152],
                  [-35.273269073339975, -6.146910106560282],
                  [-35.28219546494154, -6.149726227176319]]]),
            {
              "reference": 19,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.27176654825293, -6.194156178279472],
                  [-35.272281532383786, -6.196716060272925],
                  [-35.26901996622168, -6.195521450221021]]]),
            {
              "reference": 19,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.298820511586904, -6.206386829407778],
                  [-35.299507157094716, -6.210397212650767],
                  [-35.292297379262685, -6.210994501159079],
                  [-35.29083825755858, -6.204850929867858]]]),
            {
              "reference": 19,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.31521417308593, -6.202888385052928],
                  [-35.30997850108886, -6.209373287917318],
                  [-35.31015016246581, -6.203144369573607]]]),
            {
              "reference": 19,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.28194935633934, -6.2251007271345005],
                  [-35.28624089076317, -6.230049530183883],
                  [-35.281777694962386, -6.230646796362526]]]),
            {
              "reference": 19,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.320716892214044, -6.246659635507892],
                  [-35.31985858532928, -6.244099996715031],
                  [-35.32389262768768, -6.243929353683935]]]),
            {
              "reference": 19,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.28133880816186, -6.264372507507017],
                  [-35.281767961604245, -6.258997433663486],
                  [-35.28545868120874, -6.263263369816254]]]),
            {
              "reference": 19,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.264113292030544, -6.342733393331621],
                  [-35.257075175575466, -6.336761987427492],
                  [-35.26728902750418, -6.337615049646649]]]),
            {
              "reference": 19,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.25352425054699, -6.356476057160543],
                  [-35.250863499204215, -6.365347495512147],
                  [-35.24768776373058, -6.358523325754228]]]),
            {
              "reference": 19,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.25343841985851, -6.372853977518566],
                  [-35.249833530942496, -6.379080862202267],
                  [-35.24365372137218, -6.376436577944623]]]),
            {
              "reference": 19,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.2772743194861, -6.403978077879558],
                  [-35.27435607607789, -6.399286824717585],
                  [-35.2801925628943, -6.397325015164406]]]),
            {
              "reference": 19,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.26852271943241, -6.396394843541216],
                  [-35.26534698395878, -6.3919594122006576],
                  [-35.272900084544716, -6.391788817919221]]]),
            {
              "reference": 19,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.24079940705448, -6.403389099360325],
                  [-35.24285934357792, -6.403303804134592],
                  [-35.24217269807011, -6.407227369766591]]]),
            {
              "reference": 19,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.14468244187859, -6.485698109319561],
                  [-35.13618520371941, -6.482542688416612],
                  [-35.14039090745476, -6.4770846164594476]]]),
            {
              "reference": 19,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.15247425590738, -6.50094732410536],
                  [-35.156079144823394, -6.508451802107466],
                  [-35.14895519767984, -6.5091340218219]]]),
            {
              "reference": 19,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.11159681178108, -6.547343062632694],
                  [-35.11348508692756, -6.553823608863444],
                  [-35.10824941493049, -6.553653069251672]]]),
            {
              "reference": 19,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.0770928750135, -6.536001904343119],
                  [-35.08387349940315, -6.541544607849226],
                  [-35.07898115015998, -6.543676400521202]]]),
            {
              "reference": 19,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.06051350481008, -6.551027556101375],
                  [-35.054162033862816, -6.552732958571868],
                  [-35.05210209733938, -6.548469441466132]]]),
            {
              "reference": 19,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.034249314136254, -6.557252246915478],
                  [-35.03888417131399, -6.559213434770086],
                  [-35.03485012895559, -6.560663003440889]]]),
            {
              "reference": 19,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.05681841170683, -6.626402486325339],
                  [-35.052441046594524, -6.628363400634446],
                  [-35.054415152429485, -6.6225658923039905]]]),
            {
              "reference": 19,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.072973031391165, -6.651450496744566],
                  [-35.07228638588335, -6.658100183804712],
                  [-35.06928231178667, -6.654349089353742]]]),
            {
              "reference": 19,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.09528901039507, -6.665602286690485],
                  [-35.10129715858843, -6.668159795533775],
                  [-35.099151391376516, -6.670632041395985]]]),
            {
              "reference": 19,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.078241900755195, -6.689094938269365],
                  [-35.073263720823554, -6.6864522919471545],
                  [-35.079958514524726, -6.68568506937047]]]),
            {
              "reference": 19,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.16805184727897, -6.726155480995731],
                  [-35.16067040806998, -6.725303080844055],
                  [-35.16564858800162, -6.7218934652853095]]]),
            {
              "reference": 19,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.157965760878874, -6.747012128993276],
                  [-35.16105566566403, -6.750762510584161],
                  [-35.15487585609372, -6.7504215680037065]]]),
            {
              "reference": 19,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.14651455567506, -6.773116606567099],
                  [-35.141708037120374, -6.774991699710772],
                  [-35.142394682628186, -6.768855004138818]]]),
            {
              "reference": 19,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.14888269629882, -6.813704631921458],
                  [-35.155749151376945, -6.819158967608332],
                  [-35.14587862220214, -6.818306731748856]]]),
            {
              "reference": 19,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.11454168303303, -6.877744126298952],
                  [-35.123468074634594, -6.880641360994655],
                  [-35.12441221220784, -6.885157603348413]]]),
            {
              "reference": 19,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.11711342124158, -6.918364274666057],
                  [-35.121919939796264, -6.908139475605946],
                  [-35.123379061500366, -6.915467270729938]]]),
            {
              "reference": 19,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.09127838401013, -6.915467270729938],
                  [-35.095655749122436, -6.905924073325849],
                  [-35.09788734702283, -6.916574950803736]]]),
            {
              "reference": 19,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.1592440155999, -6.905422643327557],
                  [-35.15950150766533, -6.910023856719684],
                  [-35.155724957372364, -6.908149293704594]]]),
            {
              "reference": 19,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.17083115854424, -6.898350320684825],
                  [-35.17177529611748, -6.902099516933576],
                  [-35.1647371796624, -6.902525560083046]]]),
            {
              "reference": 19,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.164292442346365, -6.9776114365616175],
                  [-35.16961394503191, -6.980678446527074],
                  [-35.16549407198504, -6.982723108670218]]]),
            {
              "reference": 19,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.18334685518816, -6.985449310959058],
                  [-35.18386183931902, -6.988175497354311],
                  [-35.18094359591082, -6.984767761876639]]]),
            {
              "reference": 19,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.228070793279606, -7.01062908434956],
                  [-35.231074867376286, -7.017614528128613],
                  [-35.22094684613605, -7.015144078280823]]]),
            {
              "reference": 19,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-36.0353617128962, -9.587908838436451],
                  [-36.03776497217354, -9.592140398910768],
                  [-36.03450340601143, -9.590532412150823]]]),
            {
              "reference": 19,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-36.04051155420479, -9.602380556659277],
                  [-36.045146411382525, -9.60779671327146],
                  [-36.03622001978096, -9.605088645795757]]]),
            {
              "reference": 19,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-36.01909421473245, -9.572847686289428],
                  [-36.024930701548854, -9.573270863488364],
                  [-36.02081082850198, -9.57572528084628]]]),
            {
              "reference": 19,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.979894210906394, -9.555767177633935],
                  [-35.97680430612124, -9.557798525425367],
                  [-35.98032336434878, -9.551535164131536]]]),
            {
              "reference": 19,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.97929339608706, -9.562199737369717],
                  [-35.97577433785952, -9.566008432508116],
                  [-35.97483020028628, -9.563215393577606]]]),
            {
              "reference": 19,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.96581682457238, -9.53783047319827],
                  [-35.97079500450402, -9.54121622440119],
                  [-35.96658930076867, -9.542147300087022]]]),
            {
              "reference": 19,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.93034473410316, -9.529553178866157],
                  [-35.921160850436166, -9.532685075894815],
                  [-35.92502323141761, -9.52371253737283]]]),
            {
              "reference": 19,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.873268497091956, -9.519185936332706],
                  [-35.87592924843473, -9.514868819048953],
                  [-35.87996329079313, -9.520201720708627]]]),
            {
              "reference": 19,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.87592924843473, -9.501747833924957],
                  [-35.87919081459684, -9.502255752388319],
                  [-35.87721670876188, -9.506657680829937]]]),
            {
              "reference": 19,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.89102295771131, -9.497850055976393],
                  [-35.89316872492322, -9.492770772093433],
                  [-35.89462784662732, -9.498019364141983]]]),
            {
              "reference": 19,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.90258600118918, -9.461342195426418],
                  [-35.90481759908957, -9.455585055691468],
                  [-35.906190890105194, -9.461511521606583]]]),
            {
              "reference": 19,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.925416964323944, -9.457447670269104],
                  [-35.92902185323996, -9.452367788578172],
                  [-35.932884234221405, -9.45287578012222],
                  [-35.92679025533957, -9.458209646052893]]]),
            {
              "reference": 19,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.938214028457644, -9.444735699540642],
                  [-35.928944314102175, -9.445836371339093],
                  [-35.93151923475647, -9.443127019046646]]]),
            {
              "reference": 19,
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.90207930860901, -9.430849999520017],
                  [-35.90439673719788, -9.428225200698398],
                  [-35.90740081129456, -9.433813458055393]]]),
            {
              "reference": 19,
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.812136255431234, -9.426748558908432],
                  [-35.81823023431307, -9.428357315827201],
                  [-35.81170710198885, -9.431574807160748]]]),
            {
              "reference": 19,
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.76827677361971, -9.420821495030157],
                  [-35.76707514398104, -9.423954384330745],
                  [-35.76450022332674, -9.420990841124524]]]),
            {
              "reference": 19,
              "system:index": "53"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.7753580803828, -9.486320494115771],
                  [-35.773040651793934, -9.481495013903036],
                  [-35.776988863463856, -9.485135294739479]]]),
            {
              "reference": 19,
              "system:index": "54"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-36.007554782085904, -9.282536189853731],
                  [-36.007812274151334, -9.28482326408612],
                  [-36.005323184185514, -9.282536189853731]]]),
            {
              "reference": 19,
              "system:index": "55"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.95837117474503, -9.221970876956215],
                  [-35.960774434022376, -9.223495857364444],
                  [-35.95948697369523, -9.225783315618314]]]),
            {
              "reference": 19,
              "system:index": "56"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.99356175702042, -9.204517854386806],
                  [-35.990729344300696, -9.208923553086503],
                  [-35.992274296693274, -9.202823340267958]]]),
            {
              "reference": 19,
              "system:index": "57"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.62078674119791, -9.23746445161768],
                  [-35.617439344347325, -9.231280012973695],
                  [-35.6241341380485, -9.235007632821226]]]),
            {
              "reference": 19,
              "system:index": "58"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.603388259489144, -9.25308820892544],
                  [-35.608623931486214, -9.252918781216819],
                  [-35.60544819601258, -9.256392032927765]]]),
            {
              "reference": 19,
              "system:index": "59"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.51498555588559, -9.156800743984267],
                  [-35.51893376755551, -9.156207585135657],
                  [-35.51773213791684, -9.159512314686072]]]),
            {
              "reference": 19,
              "system:index": "60"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.55101201354139, -9.161162480060167],
                  [-35.551612828360724, -9.156501976778403],
                  [-35.55298611937635, -9.160823536428001]]]),
            {
              "reference": 19,
              "system:index": "61"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.42531632684822, -9.101023828344672],
                  [-35.422398083440015, -9.103057826502981],
                  [-35.422398083440015, -9.101023828344672]]]),
            {
              "reference": 19,
              "system:index": "62"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.4897472811477, -9.058960800580568],
                  [-35.49069141872094, -9.05641798833522],
                  [-35.492322201802, -9.05963888080741]]]),
            {
              "reference": 19,
              "system:index": "63"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.27792572114241, -8.905891384971444],
                  [-35.28170227143538, -8.902584329542341],
                  [-35.279556504223464, -8.906908934471028]]]),
            {
              "reference": 19,
              "system:index": "64"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.46956454249252, -8.768013203082152],
                  [-35.474456891735684, -8.762414536676943],
                  [-35.47274027796615, -8.7676738923681]]]),
            {
              "reference": 19,
              "system:index": "65"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.275158124920615, -8.56831269820345],
                  [-35.27807636832882, -8.567973207147288],
                  [-35.27884884452511, -8.572047079815222]]]),
            {
              "reference": 19,
              "system:index": "66"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.139298879287566, -8.564029634476327],
                  [-35.13826891102585, -8.562671653143344],
                  [-35.14273210682663, -8.56029517414987]]]),
            {
              "reference": 19,
              "system:index": "67"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.1041118238226, -8.556213067388716],
                  [-35.10454097726498, -8.553497044111813],
                  [-35.10728755929623, -8.55307266372539]]]),
            {
              "reference": 19,
              "system:index": "68"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.07872508764765, -8.561990484434096],
                  [-35.07537769079706, -8.563518215827765],
                  [-35.078295934205265, -8.559614001187304]]]),
            {
              "reference": 19,
              "system:index": "69"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.05960860092374, -8.507025595005546],
                  [-35.056947849580965, -8.507195367680335],
                  [-35.05952277023526, -8.50447899585526]]]),
            {
              "reference": 19,
              "system:index": "70"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.09826436845115, -8.493646859380082],
                  [-35.098092707074194, -8.492458407078042],
                  [-35.101783426678686, -8.492203738248701]]]),
            {
              "reference": 19,
              "system:index": "71"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.122039469159155, -8.490845501637875],
                  [-35.12367025224021, -8.486855653797786],
                  [-35.124528559124975, -8.491185061241247]]]),
            {
              "reference": 19,
              "system:index": "72"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.06373003658557, -8.418346526214092],
                  [-35.0614126079967, -8.420978600357682],
                  [-35.05892351803088, -8.420978600357682],
                  [-35.06038263973498, -8.419025772867698]]]),
            {
              "reference": 19,
              "system:index": "73"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.12942776490912, -8.400992075399262],
                  [-35.13268933107123, -8.40396390380654],
                  [-35.1283977966474, -8.401501533314638]]]),
            {
              "reference": 19,
              "system:index": "74"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.0639414676501, -8.397327491066399],
                  [-35.064370621092486, -8.400554077039919],
                  [-35.06179570043819, -8.400469167226463]]]),
            {
              "reference": 19,
              "system:index": "75"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.10656489993774, -8.34278632660695],
                  [-35.10793819095336, -8.350259426626014],
                  [-35.105105778233636, -8.344484770985677]]]),
            {
              "reference": 19,
              "system:index": "76"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.01792354123759, -7.854361534762409],
                  [-35.01500529782939, -7.85861278694966],
                  [-35.01382076840562, -7.865615545062593],
                  [-34.998542905856795, -7.853031924591617],
                  [-35.013734937717146, -7.8496308806257415]]]),
            {
              "reference": 19,
              "system:index": "77"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.03235470333607, -7.713064588516691],
                  [-35.022484174161264, -7.710172737675636],
                  [-35.031925549893685, -7.708641749818081]]]),
            {
              "reference": 19,
              "system:index": "78"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.966007581143685, -7.7122140462034015],
                  [-34.96308933773548, -7.707791198615535],
                  [-34.967552533536264, -7.705239534755216],
                  [-34.96944080868275, -7.71051295644744]]]),
            {
              "reference": 19,
              "system:index": "79"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.99376835799134, -7.6196522725282785],
                  [-34.98406949019349, -7.618801543546784],
                  [-34.9942833421222, -7.616249346465175]]]),
            {
              "reference": 19,
              "system:index": "80"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.954020474118714, -7.606519766387587],
                  [-34.96414849535895, -7.609412320914825],
                  [-34.95393464343024, -7.609242171188486]]]),
            {
              "reference": 19,
              "system:index": "81"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.9028813186154, -7.491737041947919],
                  [-34.89541404871794, -7.490035078427431],
                  [-34.897731477306806, -7.487992713428952]]]),
            {
              "reference": 19,
              "system:index": "82"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.93309372095915, -7.498885216115596],
                  [-34.92966049342009, -7.492758216869042],
                  [-34.9329220595822, -7.490035078427431]]]),
            {
              "reference": 19,
              "system:index": "83"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.93001402435787, -7.410633465664013],
                  [-34.924778352360796, -7.40646287141415],
                  [-34.92795408783443, -7.406037298353079]]]),
            {
              "reference": 19,
              "system:index": "84"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.91752565918453, -7.421868339371906],
                  [-34.91877020416744, -7.418038301007669],
                  [-34.92246092377193, -7.417612739131438],
                  [-34.92052973328121, -7.422591787318666]]]),
            {
              "reference": 19,
              "system:index": "85"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.98716235225079, -7.363819898572242],
                  [-34.981583357499815, -7.361862070258946],
                  [-34.986304045366026, -7.360414974210968]]]),
            {
              "reference": 19,
              "system:index": "86"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.93429064814923, -7.356839775500737],
                  [-34.92622256343243, -7.358116635490201],
                  [-34.93308901851056, -7.353349672786217]]]),
            {
              "reference": 19,
              "system:index": "87"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.87221025518132, -7.299097872718731],
                  [-34.87457059911443, -7.297310030899423],
                  [-34.873626461541186, -7.300630302876615]]]),
            {
              "reference": 19,
              "system:index": "88"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.044911882285206, -7.208057808091363],
                  [-35.036929628256885, -7.208398417459899],
                  [-35.044654390219776, -7.201756488594451]]]),
            {
              "reference": 19,
              "system:index": "89"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.06868698299321, -7.197669099389705],
                  [-35.05898811519536, -7.194007448622826],
                  [-35.06499626338872, -7.193155897698969]]]),
            {
              "reference": 19,
              "system:index": "90"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.00312621458362, -7.0373720088784015],
                  [-35.01119429930041, -7.030897973763486],
                  [-35.0160008178551, -7.045549608359009]]]),
            {
              "reference": 19,
              "system:index": "91"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.06715590818713, -7.034646110358054],
                  [-35.05599791868518, -7.038734952135443],
                  [-35.06046111448596, -7.0307276031996455]]]),
            {
              "reference": 19,
              "system:index": "92"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.012573819391456, -6.9874594355425],
                  [-35.01652203106138, -6.994104458441581],
                  [-35.010857205621924, -6.997341743045298],
                  [-35.0094839146063, -6.993422921981116]]]),
            {
              "reference": 19,
              "system:index": "93"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.99319061331494, -6.9331120642812785],
                  [-34.997997131869624, -6.926466177749596],
                  [-34.99679550223095, -6.933282470396049]]]),
            {
              "reference": 19,
              "system:index": "94"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.953536835238765, -6.909936259164818],
                  [-34.949760284945796, -6.917264026428754],
                  [-34.951820221469234, -6.907720865301816]]]),
            {
              "reference": 19,
              "system:index": "95"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.93002701183712, -6.89971514228225],
                  [-34.9344902076379, -6.90158973871408],
                  [-34.9289970435754, -6.903293910846406]]]),
            {
              "reference": 19,
              "system:index": "96"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.95858374768701, -6.871383523075464],
                  [-34.952403938116696, -6.877348478637707],
                  [-34.95377722913232, -6.872065236071369]]]),
            {
              "reference": 19,
              "system:index": "97"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.97231665784326, -6.844284640845307],
                  [-34.970428382696774, -6.850761243392659],
                  [-34.968368446173336, -6.844455078880595]]]),
            {
              "reference": 19,
              "system:index": "98"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.96527854138818, -6.823889259308706],
                  [-34.96871176892724, -6.827468598003893],
                  [-34.96510688001123, -6.827979929918065]]]),
            {
              "reference": 19,
              "system:index": "99"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.02518836194482, -6.8726341383598415],
                  [-35.02570334607568, -6.866328263403732],
                  [-35.03102484876123, -6.8726341383598415]]]),
            {
              "reference": 19,
              "system:index": "100"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.039686506439125, -6.737628122916006],
                  [-35.03487998788444, -6.739247640800957],
                  [-35.034965818572914, -6.736775742909519]]]),
            {
              "reference": 19,
              "system:index": "101"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.0247519666442, -6.724676694435445],
                  [-35.02724105661002, -6.7233980897560315],
                  [-35.02852851693717, -6.726637215076066]]]),
            {
              "reference": 19,
              "system:index": "102"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-34.983982389617836, -6.719562255538117],
                  [-34.98063499276725, -6.719221291032013],
                  [-34.98389655892936, -6.7179426720051945]]]),
            {
              "reference": 19,
              "system:index": "103"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.07991886848439, -6.682657815231381],
                  [-35.07519818061818, -6.682743062771666],
                  [-35.07991886848439, -6.680015134112401]]]),
            {
              "reference": 19,
              "system:index": "104"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.10717038299135, -6.303378485571161],
                  [-35.107513705745255, -6.293823476277777],
                  [-35.11781338836244, -6.303719732649334]]]),
            {
              "reference": 19,
              "system:index": "105"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.19863218991589, -7.60812910821185],
                  [-35.199275920079465, -7.605874612115972],
                  [-35.19961924283337, -7.608767170993446]]]),
            {
              "reference": 19,
              "system:index": "106"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.207139597009466, -7.615816036630059],
                  [-35.208899126123235, -7.614072024784108],
                  [-35.20821248061542, -7.6165391614114215]]]),
            {
              "reference": 19,
              "system:index": "107"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.23739401598325, -7.631910666716807],
                  [-35.23490492601743, -7.63284643983751],
                  [-35.2361065556561, -7.631485314621287]]]),
            {
              "reference": 19,
              "system:index": "108"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.235763232902194, -7.625615412506516],
                  [-35.23430411119809, -7.6277421979393765],
                  [-35.23293082018247, -7.624849767163119]]]),
            {
              "reference": 19,
              "system:index": "109"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.17051673112758, -7.629188405994973],
                  [-35.17051673112758, -7.627486984245602],
                  [-35.17326331315883, -7.629613760374933]]]),
            {
              "reference": 19,
              "system:index": "110"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.1355808265191, -7.624495477875933],
                  [-35.137039948223205, -7.623814902524185],
                  [-35.1381557471734, -7.626537197437861]]]),
            {
              "reference": 19,
              "system:index": "111"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.13220078791114, -7.605474624542307],
                  [-35.13443238581153, -7.60504924619544],
                  [-35.13340241754981, -7.607856735491343]]]),
            {
              "reference": 19,
              "system:index": "112"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-35.11997135786999, -7.5636750143287195],
                  [-35.11984261183728, -7.565525585010963],
                  [-35.11881264357556, -7.564419497741393]]]),
            {
              "reference": 19,
              "system:index": "113"
            })]),
    rev01_2000_agric = /* color: #00ffff */ee.FeatureCollection([]),
    rev01_2010_agric = /* color: #bf04c2 */ee.FeatureCollection([]),
    geometry = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-56.05851880152852, -30.04613371617718],
          [-49.20305005152852, -30.841736663987348],
          [-41.46867505152852, -23.861579784474333],
          [-34.17375317652852, -8.163484389272043],
          [-34.26164380152852, -4.801825741437062],
          [-35.66789380152852, -4.582835761516412],
          [-49.07121411402852, -16.947367124654484],
          [-56.10246411402852, -21.01873071079243]]]);

// Set the collection flag to true if you want to collect data, false otherwise
var coleta = false;

// Set the region ID for the analysis
var regiaoID = 'agric_NE';

// Define the years to process
var anos = [2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023];

// If collecting data, only process the current year
if (coleta) {
  var anos = [2023];
}

// Set the number of trees for the Random Forest classifier
var RFtrees = 100;

// If collecting data, use a smaller number of trees
if (coleta) {
  var RFtrees = 20;
}

// Define the output version and other parameters
var versao_out = 1;
var versao_pt = 'S2_v1';
var versao_estavel = '3';
var dir_pt_in = 'projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/';

// Load the biomes data
var bioma250mil = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil');
var bioma250mil_MA_vetor = bioma250mil.filterMetadata('Bioma', 'equals', 'Mata Atl√¢ntica');
var biomes = ee.Image('projects/mapbiomas-workspace/AUXILIAR/biomas-raster-41');
var bioma250mil_MA = biomes.mask(biomes.eq(2));
// Add the bioma layer to the map
Map.addLayer(bioma250mil_MA, {}, 'layer bioma', false);

// Load the palettes and define visualization parameters
var palettes = require('users/mapbiomas/modules:Palettes.js');
var vis = {
  'min': 0,
  'max': 69,
  'palette': palettes.get('classification9')
};

// Load the regions collection and define visualization parameters
var regioesCollection = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/Mata_Atlantica_col6_PLANET');
var visParMedian2 = {bands: ['swir1_median', 'nir_median', 'red_median'], gain: [0.08, 0.06, 0.2], gamma: 0.85};

// Define the bioma and output directory
var bioma = "MATAATLANTICA";
var dirout = 'projects/mapbiomas-workspace/COLECAO7/classificacao-ma/';

// Load the S2 cluster image
var S2_cluster = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/mosaicos_MA_S2_clusters_2106_2023');

// Define the limit for the analysis
//var limite = regioesCollection.filterMetadata('reg_id', "equals", regiaoID);
var limite = rev_agric;

// Load the stable map from collection 6 and add it to the map
var mapa_estavel_col6 = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/col7/MATA_ATLANTICA/MA_amostras_estaveis85a20_col6_v1');
Map.addLayer(mapa_estavel_col6, vis, 'mapa_estavel_col6', false);

// Create a blank image and outline the limit
var blank = ee.Image(0).mask(0);
var outline = blank.paint(limite, 'AA0000', 2);
var visPar = {'palette': '000000', 'opacity': 0.6};
Map.addLayer(outline, visPar, regiaoID, false);

// Define a function to shuffle a feature collection
var shuffle = function (collection, seed) {
  // Add a random column to the collection
  collection = collection.randomColumn('random', seed || 1)
    // Sort the collection by the random column
    .sort('random', true)
    // Map over the collection and set a new ID based on the random value
    .map(function (feature) {
      var rescaled = ee.Number(feature.get('random')).multiply(1000000000).round();
      return feature.set('new_id', rescaled);
    });
  // Get the list of new IDs
  var randomIdList = ee.List(collection.reduceColumns(ee.Reducer.toList(), ['new_id']).get('list'));
  // Create a sequential list of IDs
  var sequentialIdList = ee.List.sequence(1, collection.size());
  // Remap the collection using the new and sequential IDs
  var shuffled = collection.remap(randomIdList, sequentialIdList, 'new_id');
  // Return the shuffled collection
  return shuffled;
};

// Define visualization parameters for hand-labeled data
var vis_hand = {
  'min': 0,
  'max': 60,
  'palette': 'blue,white,green,orange,red,brown'
};

// Loop through the years
for (var i_ano = 0; i_ano < anos.length; i_ano++) {
  // Get the current year
  var ano = anos[i_ano];

  // Load the Sentinel 2 mosaics
  var asset = 'projects/mapbiomas-mosaics/assets/SENTINEL/BRAZIL/mosaics-3';

  // Define the band names to use for classification
  var bandNames = ee.List([
    // 60 most important bands for this region
    'green_median_texture_' + ano, 'ndvi_median', 'longitude', 'red_edge_1_median', 'ndvi_median_dry_' + ano, 'green_median_dry', 'green_median', 'blue_median', 'afvi_median_wet', 'nddi_median_wet', 'ui_median_wet', 'ndvi_median_wet_' + ano, 'blue_median_wet', 'ndwi_median_wet', 'gli_median_dry', 'ri_median', 'dswi5_median_wet', 'afvi_median', 'swir1_median_wet', 'blue_median_dry', 'brba_median_wet', 'green_median_texture', 'lai_median', 'swir2_median_wet', 'red_median', 'brba_median', 'red_median_dry', 'red_edge_1_median_dry', 'evi_median_dry', 'red_median_wet', 'brightness_median_dry', 'brba_median_dry', 'msi_median_wet', 'green_min', 'wetness_median_wet', 'mbi_median_wet', 'ui_median', 'red_edge_4_median_wet', 'gcvi_median', 'latitude', 'green_median_wet', 'awei_median_dry', 'osavi_median_dry', 'gli_median_wet', 'swir2_median_dry', 'ri_median_dry', 'msi_median', 'awei_median_wet', 'bsi_median', 'iia_median_dry', 'gvmi_median_wet_1', 'swir1_stdDev', 'gvmi_median_dry', 'red_edge_4_stdDev', 'spri_median_1', 'red_edge_2_median_wet', 'dswi5_median_dry', 'red_edge_1_median_wet', 'ndwi_median', 'nddi_median_dry', 'afvi_median_dry', 'iia_median',
    // All 143 bands for feature importance
    //      'blue_median','afvi_median','afvi_median_dry','afvi_median_wet','avi_median','avi_median_dry','avi_median_wet','awei_median','awei_median_dry','awei_median_wet','blue_median_dry','blue_median_wet','blue_stdDev','brba_median','brba_median_dry','brba_median_wet','brightness_median','brightness_median_dry','brightness_median_wet','bsi_median','bsi_median_1','bsi_median_2','clusters_2023','co2flux_median','cvi_median','cvi_median_dry','cvi_median_wet','dswi5_median','dswi5_median_dry','dswi5_median_wet','evi_median','evi_median_dry','evi_median_wet','gcvi_median','gcvi_median_dry','gcvi_median_wet','gemi_median','gemi_median_dry','gemi_median_wet','gli_median','gli_median_dry','gli_median_wet','green_median','green_median_dry','green_median_texture','green_median_texture_2023','green_median_wet','green_min','green_stdDev','gvmi_median','gvmi_median_1','gvmi_median_dry','gvmi_median_dry_1','gvmi_median_wet','gvmi_median_wet_1','iia_median','iia_median_dry','iia_median_wet','lai_median','latitude','longitude','lswi_median','lswi_median_dry','lswi_median_wet','mbi_median','mbi_median_dry','mbi_median_wet','msi_median','msi_median_dry','msi_median_wet','nddi_median','nddi_median_dry','nddi_median_wet','ndvi_median','ndvi_median_dry','ndvi_median_dry_2023','ndvi_median_wet','ndvi_median_wet_2023','ndwi_median','ndwi_median_2023','ndwi_median_dry','ndwi_median_wet','nir_median','nir_median_contrast','nir_median_dry','nir_median_dry_contrast','nir_median_wet','nir_stdDev','osavi_median','osavi_median_dry','osavi_median_wet','ratio_median','ratio_median_dry','ratio_median_wet','red_edge_1_median','red_edge_1_median_dry','red_edge_1_median_wet','red_edge_1_stdDev','red_edge_2_median','red_edge_2_median_dry','red_edge_2_median_wet','red_edge_2_stdDev','red_edge_3_median','red_edge_3_median_dry','red_edge_3_median_wet','red_edge_3_stdDev','red_edge_4_median','red_edge_4_median_dry','red_edge_4_median_wet','red_edge_4_stdDev','red_median','red_median_contrast','red_median_dry','red_median_dry_contrast','red_median_wet','red_min','red_stdDev','ri_median','ri_median_dry','ri_median_wet','rvi_median','rvi_median_1','rvi_median_wet','shape_median','shape_median_dry','shape_median_wet','spri_median','spri_median_1','spri_median_wet','swir1_median','swir1_median_dry','swir1_median_wet','swir1_stdDev','swir2_median','swir2_median_dry','swir2_median_wet','swir2_stdDev','ui_median','ui_median_dry','ui_median_wet','wetness_median','wetness_median_dry','wetness_median_wet',
  ]);

  // Filter the Sentinel 2 collection
  var collection = ee.ImageCollection(asset)
    .filter(ee.Filter.eq('version', '3'))
    .filter(ee.Filter.eq('year', ano))
    .filter(ee.Filter.inList('biome', [
      'MATAATLANTICA',
    ]));

  // Create a mosaic of the filtered collection
  var mosaicoTotal = collection.mosaic();

  // Add indices for the Caatinga region
  var addIndexCaatinga = require('users/marcosrosaUSP/MapBiomas_col9_MataAtlan:Mata_Atlantica_SENTINEL2/processa_Bandas_Sentinel2_CAATINGA');
  mosaicoTotal = addIndexCaatinga.get(mosaicoTotal);

  // Add bands from the S2 cluster image
  mosaicoTotal = mosaicoTotal.addBands(S2_cluster.select([
    'clusters_' + ano, 'ndvi_median_dry_' + ano, 'ndvi_median_wet_' + ano, 'ndwi_median_' + ano, 'green_median_texture_' + ano
  ]));

  // Add the mosaic to the map
  Map.addLayer(mosaicoTotal, {'bands': ['swir1_median', 'nir_median', 'red_median'],
    'gain': [0.08, 0.07, 0.2], 'gamma': 0.85}, 'Sentinel 2 ' + ano, false);

  // Load the training data
  //var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/REGIONs_' + regiaoID + '_' + ano);
  var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/pontos_train_v1_' + ano)
    //.filterMetadata('reg_id', 'equals', regiaoID)
    .filterBounds(limite);

  // Filter the training data by reference class
  var BDflo = BDamostras.filterMetadata("reference", "equals", 3);
  BDflo = shuffle(BDflo, 2).limit(2000);
  var BDsav = BDamostras.filterMetadata("reference", "equals", 4);//.limit(100);
  var BDreflo = BDamostras.filterMetadata("reference", "equals", 9);
  var BDvarzea = BDamostras.filterMetadata("reference", "equals", 11);
  var BDcampo = BDamostras.filterMetadata("reference", "equals", 12);
  var BDOutroNFlo = BDamostras.filterMetadata("reference", "equals", 13);
  var BDagro = BDamostras.filterMetadata("reference", "equals", 21);
  BDagro = shuffle(BDagro, 2).limit(2500);
  var BDNaoVeg = BDamostras.filterMetadata("reference", "equals", 22);
  var BDAflora = BDamostras.filterMetadata("reference", "equals", 29);
  var BDagua = BDamostras.filterMetadata("reference", "equals", 33);

  // Set the number of agriculture samples
  var num_agric = 1500;

  // Load the complementary samples
  var amostraTotal = rev01_1985_agric;
  //if (ano >= 2000) {
  //  amostraTotal = rev01_1985_agric.merge(rev01_2000_agric);
  //}

  // Convert the complementary samples to an image
  var amostraTotalimg = amostraTotal.reduceToImage({properties: ['reference'], reducer: ee.Reducer.first()});
  amostraTotalimg = amostraTotalimg.select([0], ['reference']);

  // Sample the mosaic using the complementary samples
  //var training_flo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': flo.filterBounds(limite), 'scale': 30, 'seed': 1});
  //var training_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': aflora.filterBounds(limite), 'scale': 30, 'seed': 1});
  //var training_sav = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 500, 'region': sav.filterBounds(limite), 'scale': 30, 'seed': 1});
  ////  var training_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': sampleComplementar, 'region': aflora_r23.filterBounds(limite), 'scale': 30, 'seed': 1});
  //var training_cam = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 500, 'region': campo.filterBounds(limite), 'scale': 30, 'seed': 1});
  var training_agr = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': num_agric, 'region': rev01_1985_agric.filterBounds(limite), 'scale': 30, 'seed': 1});

  // Print the number of samples if collecting data
  if (coleta) {
    //print('BDflo', BDflo.size());
    //print('BDsav', BDsav.size());
    //print('BDvar', BDvarzea.size());
    //print('BDcam', BDcampo.size());
    //print('BDOut', BDOutroNFlo.size());
    //print('BDAfl', BDAflora.size());
    //print('BDagr', BDagro.size());
    //print('BDNao', BDNaoVeg.size());
    //print('BDagu', BDagua.size());
    ////  print('training_agr',training_agr.size())
    ////  print('training_cam',training_cam.size())
    //print('training_flo', training_flo.size());
    //print('training_sav', training_sav.size());
    ////print(training_afl.size())
    ////print(training_cam.size())
    print("rev01_1985_agric", training_agr.size());
  }

  // Merge the training data
  var training = BDflo//.merge(BDreflo).merge(BDcampo)//.merge(BDsav).merge(BDOutroNFlo).merge(BDAflora)
    .merge(BDagro).merge(BDAflora).merge(BDagua)//.merge(BDNaoVeg)
    // Complementary samples
    .merge(training_agr);//.merge(training_agr).merge(training_afl).merge(training_sav).merge(training_flo);

  // Train the Random Forest classifier
  var classifier = ee.Classifier.smileRandomForest({numberOfTrees: RFtrees, variablesPerSplit: 1}).train(training, 'reference', bandNames);
  //print(classifier.explain());

  // Classify the mosaic using the trained classifier
  var classifiedRF = mosaicoTotal.classify(classifier).mask(mosaicoTotal.select('green_median'));
  classifiedRF = classifiedRF.select(['classification'], ['classification_' + ano]).clip(limite).toInt8();

  // Add the classified image to the map if collecting data
  if (coleta) {
    Map.addLayer(classifiedRF, vis, 'RF' + ano + "_" + regiaoID, false);
  }

  // Calculate the probability of each class
  //var classifier_prob = classifier.setOutputMode('MULTIPROBABILITY');
  //var classified_prob = mosaicoTotal.classify(classifier_prob);
  //var max_prob = classified_prob.arrayReduce(ee.Reducer.max(), [0]);
  //var img_max_prop = max_prob.arrayFlatten([['prob_' + ano]]).multiply(100);

  // Combine the classified images for all years
  if (i_ano == 0) {
    var classified16a23RF = classifiedRF;
  } else {
    classified16a23RF = classified16a23RF.addBands(classifiedRF);
  }
}

// Export the classified image if not collecting data
if (coleta) {
} else {
  classified16a23RF = classified16a23RF
    .set('territory', 'BRAZIL')
    .set('biome', 'MATA AT√ÇNTICA')
    .set('source', 'arcplan')
    .set('version', '1')
    .set('collection_id', versao_out);

  // Export the classified image to an asset
  Export.image.toAsset({
    "image": classified16a23RF.toInt8(),
    "description": regiaoID + '-' + 'RF_SENTINEL2_v' + versao_out,
    "assetId": dirout + regiaoID + '-' + 'RF_SENTINEL2_v' + versao_out,
    "scale": 10,
    "pyramidingPolicy": {
      '.default': 'mode'
    },
    "maxPixels": 1e13,
    "region": limite
  });
}
