var varzea = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.58435290746985, -24.682647813247808],
                  [-47.58890193395911, -24.676720528054684],
                  [-47.58589785986243, -24.683739650838554]]]),
            {
              "reference": 11,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.5845245688468, -24.670714964938465],
                  [-47.59465259008704, -24.67040297973261],
                  [-47.58538287573157, -24.67204089335789]]]),
            {
              "reference": 11,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.57293742590247, -24.69169417891804],
                  [-47.578001436522584, -24.696451056049405],
                  [-47.573967394164185, -24.69707489531772]]]),
            {
              "reference": 11,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.673101839354615, -24.66096505847299],
                  [-47.67421763830481, -24.66541111032239],
                  [-47.671385225585084, -24.66541111032239]]]),
            {
              "reference": 11,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.725441321910424, -24.6291391651308],
                  [-47.729647025645775, -24.631635849949483],
                  [-47.729904517711205, -24.633508330829006],
                  [-47.726986274303, -24.631479808609644]]]),
            {
              "reference": 11,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.684179861836, -24.585135553401564],
                  [-47.67774256020026, -24.586306292350148],
                  [-47.68100412636237, -24.584667254757523]]]),
            {
              "reference": 11,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.697826941303774, -24.55821853547409],
                  [-47.69937189369635, -24.563136621924183],
                  [-47.697569449238344, -24.561106958833406]]]),
            {
              "reference": 11,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.73784693697889, -24.611404552996646],
                  [-47.7385335824867, -24.613745528522855],
                  [-47.73767527560194, -24.615618277395352],
                  [-47.73613032320936, -24.610468150517946]]]),
            {
              "reference": 11,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.7692565798999, -24.667507838895542],
                  [-47.765480029606934, -24.667351842379695],
                  [-47.759729373479004, -24.666805853038152],
                  [-47.76161764862549, -24.66571386718685],
                  [-47.76530836822998, -24.66641585918843],
                  [-47.76856993439209, -24.666259861307207]]]),
            {
              "reference": 11,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.680641423189755, -24.65292132127848],
                  [-47.67832399460089, -24.65175120590206],
                  [-47.681671391451474, -24.651049131412062]]]),
            {
              "reference": 11,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.64255703903104, -24.469829958701343],
                  [-47.64324368453885, -24.482484978617077],
                  [-47.640153779753696, -24.47357972688054]]]),
            {
              "reference": 11,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.57509411788846, -24.46686131301798],
                  [-47.58178891158963, -24.468892499205182],
                  [-47.569772615202915, -24.467330051200236]]]),
            {
              "reference": 11,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.44188488937284, -24.4301380688531],
                  [-47.442657365569126, -24.42638700776434],
                  [-47.44360150314237, -24.431779123002745]]]),
            {
              "reference": 11,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.47003735519315, -24.442640800100605],
                  [-47.46780575729276, -24.440843608781275],
                  [-47.47450055099393, -24.443578454965618]]]),
            {
              "reference": 11,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.50943364120389, -24.417243329103503],
                  [-47.50823201156522, -24.42208877981142],
                  [-47.50745953536893, -24.41990053478852]]]),
            {
              "reference": 11,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.76908762475912, -24.442838624331124],
                  [-47.77363665124838, -24.44807376653147],
                  [-47.77020342370932, -24.44572969989247]]]),
            {
              "reference": 11,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.773035836429045, -24.454715051902095],
                  [-47.765568566531584, -24.454246266770067],
                  [-47.770546746463225, -24.453699348578162]]]),
            {
              "reference": 11,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.832264997029526, -24.37937555713857],
                  [-47.829046346211655, -24.38086091832505],
                  [-47.82986173775218, -24.379766443353297]]]),
            {
              "reference": 11,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.87367312410417, -24.359162154517204],
                  [-47.87066905000749, -24.36236789808471],
                  [-47.871870679646165, -24.36041318605987]]]),
            {
              "reference": 11,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.866077108174, -24.354666157826667],
                  [-47.864103002339036, -24.35802839649885],
                  [-47.86324469545427, -24.357324679516644]]]),
            {
              "reference": 11,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.991386293909265, -24.41769052184985],
                  [-47.98546397640438, -24.417651445016677],
                  [-47.989111780664636, -24.416596365947747]]]),
            {
              "reference": 11,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.10494945016258, -24.356932502833235],
                  [-48.10288951363914, -24.358261746855913],
                  [-48.1013874765908, -24.357010694044554]]]),
            {
              "reference": 11,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.09516479403471, -24.310914532246862],
                  [-48.09533645541166, -24.31506010546022],
                  [-48.09366275698637, -24.31459080208745],
                  [-48.094006079740275, -24.312713571228414]]]),
            {
              "reference": 11,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.849522149611005, -24.255092546509548],
                  [-47.85046628718425, -24.26150921508341],
                  [-47.84883550410319, -24.259474696695158]]]),
            {
              "reference": 11,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.89012006526042, -24.234744871265818],
                  [-47.88428357844401, -24.234040470392348],
                  [-47.88582853083659, -24.23325779818325]]]),
            {
              "reference": 11,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.8711514831071, -24.215634654663198],
                  [-47.873726403761395, -24.217748151062604],
                  [-47.87364057307292, -24.2197833366759]]]),
            {
              "reference": 11,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.72679886101129, -24.27774602133611],
                  [-47.71504005669, -24.274225168787513],
                  [-47.723880617603086, -24.275164072341568]]]),
            {
              "reference": 11,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.738128511890196, -24.269687037130623],
                  [-47.74053177116754, -24.266087714020927],
                  [-47.7399309563482, -24.271095440162544]]]),
            {
              "reference": 11,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.93728827484925, -24.20520224943275],
                  [-46.93951987274964, -24.203166830912476],
                  [-46.936944952095345, -24.2094295532682]]]),
            {
              "reference": 11,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.94878958710511, -24.18977923014389],
                  [-46.94973372467835, -24.184376817833122],
                  [-46.9510211850055, -24.189466053068887]]]),
            {
              "reference": 11,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.70866401096898, -25.73743526632344],
                  [-48.710809778180895, -25.744238855403992],
                  [-48.70789153477269, -25.744161544079823]]]),
            {
              "reference": 11,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.711839746442614, -25.75196973376487],
                  [-48.70814902683812, -25.75591228799637],
                  [-48.709779809919176, -25.75227895843443]]]),
            {
              "reference": 11,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.7168865677235, -25.31913573623712],
                  [-48.71242337192272, -25.321928791846904],
                  [-48.713968324315296, -25.318670220705847]]]),
            {
              "reference": 11,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.41848933767425, -25.1872924192789],
                  [-48.41857516836273, -25.186438045928693],
                  [-48.419690967312924, -25.18651571648084],
                  [-48.42029178213226, -25.186826398194253],
                  [-48.419905544034116, -25.187331254288825]]]),
            {
              "reference": 11,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.31337874684685, -24.561045452933108],
                  [-47.309773857930836, -24.56112351754407],
                  [-47.31140464101189, -24.55870349200195]]]),
            {
              "reference": 11,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.319558556417164, -24.567914952609314],
                  [-47.321275170186695, -24.571505677601497],
                  [-47.31818526540154, -24.570256741447377]]]),
            {
              "reference": 11,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.979052832788696, -24.17573835773873],
                  [-46.978044322199096, -24.176286476084933],
                  [-46.97791557616638, -24.17450508285341]]]),
            {
              "reference": 11,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.977642152218976, -24.163248027759654],
                  [-46.97622594585911, -24.163385070973543],
                  [-46.97661218395726, -24.159645696258785]]]),
            {
              "reference": 11,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.98329632499594, -24.1583236873008],
                  [-46.98080723503012, -24.157853805620995],
                  [-46.9812363884725, -24.15675740831316]]]),
            {
              "reference": 11,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.989905288008636, -24.157070665647048],
                  [-46.98883240440268, -24.156365835565573],
                  [-46.98999111869711, -24.1556218440385]]]),
            {
              "reference": 11,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.98260967948813, -24.152371724984906],
                  [-46.981665541914886, -24.153429001701962],
                  [-46.98054974296469, -24.15174518650573]]]),
            {
              "reference": 11,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.13571363576789, -24.429251489480734],
                  [-47.13498407491584, -24.42975944066478],
                  [-47.13380390294929, -24.428235580976136]]]),
            {
              "reference": 11,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.12625080236335, -24.427766697368284],
                  [-47.1246200192823, -24.42999387898287],
                  [-47.12431961187263, -24.42942731896823],
                  [-47.12635809072395, -24.42708290564938]]]),
            {
              "reference": 11,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.15448402790919, -24.43483554998023],
                  [-47.15203785328761, -24.43346803948032],
                  [-47.154913181351574, -24.432295875820614]]]),
            {
              "reference": 11,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.16901474744314, -24.442555466587137],
                  [-47.1675127103948, -24.445290275632512],
                  [-47.16704064160818, -24.44368846610479]]]),
            {
              "reference": 11,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.739770118963975, -24.7866527102887],
                  [-47.73768872476842, -24.785776067247195],
                  [-47.7381178782108, -24.78452927536429]]]),
            {
              "reference": 11,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.74187297083165, -24.785776067247195],
                  [-47.74060696817662, -24.786126725207037],
                  [-47.740499679816025, -24.783944837356703]]]),
            {
              "reference": 11,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.74864275911921, -24.78827663472724],
                  [-47.74662573794001, -24.789990918559226],
                  [-47.74731238344782, -24.787672733644392]]]),
            {
              "reference": 11,
              "system:index": "47"
            })]),
    rest = /* color: #d63000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.178603346099656, -25.380917931333748],
                  [-48.21825712417583, -25.429762118045723],
                  [-48.19954603408794, -25.421080152686823]]]),
            {
              "reference": 13,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.90455591589955, -25.08468323843842],
                  [-47.907474154318884, -25.083634013758097],
                  [-47.91434060939701, -25.091485096955136],
                  [-47.90730249294193, -25.09785887322025]]]),
            {
              "reference": 13,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.905371308933724, -25.070262665051793],
                  [-47.90607944127153, -25.06598662633648],
                  [-47.90798913844974, -25.064198473722005],
                  [-47.91056405910404, -25.066997381586898],
                  [-47.90738832363041, -25.069485246002614]]]),
            {
              "reference": 13,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.888597826863226, -25.049445349927932],
                  [-47.886623721028265, -25.03451496475954],
                  [-47.89297519197553, -25.049445349927932]]]),
            {
              "reference": 13,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.8228415196091, -24.949810945872677],
                  [-47.83151041914523, -24.957670592388194],
                  [-47.825416440263396, -24.954168831651547],
                  [-47.820180768266326, -24.948176698946295]]]),
            {
              "reference": 13,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.7657378351041, -24.89387046831644],
                  [-47.78616553896152, -24.911542532870456],
                  [-47.78419143312656, -24.912398824134165],
                  [-47.76050216310703, -24.891690478892933]]]),
            {
              "reference": 13,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.71432618245362, -24.846065652183214],
                  [-47.69999245747803, -24.839133586643477],
                  [-47.710892954914556, -24.842794388738266]]]),
            {
              "reference": 13,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.67063836201905, -24.817400213638678],
                  [-47.689950266926274, -24.832123237911805],
                  [-47.68385628804444, -24.828540017490198]]]),
            {
              "reference": 13,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.66342858418702, -24.818257157193404],
                  [-47.67458657368897, -24.827527349448804],
                  [-47.66737679585694, -24.824177696165712],
                  [-47.661969462482915, -24.82043844131403]]]),
            {
              "reference": 13,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.60071508246844, -24.77231064221074],
                  [-47.61419050055926, -24.780805000139985],
                  [-47.60174505073016, -24.77620720883629]]]),
            {
              "reference": 13,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.58413356244387, -24.75717609756694],
                  [-47.592888292668476, -24.762787798612422],
                  [-47.582931932805195, -24.760761380254973]]]),
            {
              "reference": 13,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.50066231146788, -24.7159970511557],
                  [-47.49559830084776, -24.71467159038479],
                  [-47.496542438421, -24.711708744689933]]]),
            {
              "reference": 13,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.43864980522167, -24.68780862866792],
                  [-47.42689100090038, -24.684221243488],
                  [-47.43521657768261, -24.679697871548864]]]),
            {
              "reference": 13,
              "system:index": "12"
            })]),
    aflora = /* color: #edff26 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.85882797432935, -25.253171512451708],
                  [-48.860716249475836, -25.258760598490575],
                  [-48.85590973092115, -25.25518982319086],
                  [-48.84561004830396, -25.256121339912458],
                  [-48.860716249475836, -25.249445312210145]]]),
            {
              "reference": 29,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.81986084176099, -25.220252790446782],
                  [-48.81797256661451, -25.22429047175549],
                  [-48.81694259835279, -25.221961056588253]]]),
            {
              "reference": 29,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.91292179270821, -25.448164390846443],
                  [-48.91575420542794, -25.449946944681063],
                  [-48.912320977888875, -25.44847440210476]]]),
            {
              "reference": 29,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.675857431135945, -25.573343883028183],
                  [-48.674398309431844, -25.574505209677838],
                  [-48.67242420359688, -25.575124579284914],
                  [-48.673625833235555, -25.574118102046263]]]),
            {
              "reference": 29,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.010893412621215, -25.897752165870376],
                  [-49.00222451308508, -25.904160515995233],
                  [-49.00222451308508, -25.90215311845417]]]),
            {
              "reference": 29,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.998877116234496, -25.89813822091032],
                  [-48.9963021955802, -25.900145686758577],
                  [-48.988405772240355, -25.895049745228725]]]),
            {
              "reference": 29,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.02222306350012, -25.924961428266396],
                  [-49.02282387831946, -25.927277205201804],
                  [-49.01501328566809, -25.92156487312331]]]),
            {
              "reference": 29,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.963686533959105, -25.879254125783362],
                  [-48.962227412255004, -25.886281230936557],
                  [-48.95990998366614, -25.88226579348189],
                  [-48.96214158156653, -25.880103578294985]]]),
            {
              "reference": 29,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.996903010399535, -25.948194327747764],
                  [-48.99501473525305, -25.951435763354436],
                  [-48.991924830467894, -25.951590115204922]]]),
            {
              "reference": 29,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.99827630141516, -25.919403377984967],
                  [-48.99304062941809, -25.922105240715442],
                  [-48.9948430738761, -25.919171786869605]]]),
            {
              "reference": 29,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.955446787865355, -25.98895171271887],
                  [-48.96257073500891, -25.992423472895265],
                  [-48.96025330642004, -25.99319496122843],
                  [-48.950468607933715, -25.9895689220237]]]),
            {
              "reference": 29,
              "system:index": "10"
            })]),
    agro = /* color: #9999ff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.80609102737619, -24.60825788445824],
                  [-48.804245667573944, -24.608004269766063],
                  [-48.80415983688547, -24.60743851206151],
                  [-48.80488939773752, -24.607262931563994],
                  [-48.80628414642526, -24.607848198930704]]]),
            {
              "reference": 21,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.81355829727365, -24.610754986279943],
                  [-48.81214209091379, -24.610423342814865],
                  [-48.811948971864716, -24.609779561813724],
                  [-48.81252832901193, -24.609330864005052],
                  [-48.813451008913056, -24.609877104602635]]]),
            {
              "reference": 21,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.79191489523488, -24.614984205638812],
                  [-48.79197926825124, -24.613735703176385],
                  [-48.79264445608693, -24.613950290424125],
                  [-48.7923869640215, -24.61519879074432]]]),
            {
              "reference": 21,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.780842736421405, -24.61160931873048],
                  [-48.78189416235524, -24.610536358727767],
                  [-48.782602265535175, -24.61137521915126],
                  [-48.78215165442067, -24.61196046727779]]]),
            {
              "reference": 21,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.776198614022924, -24.604679475632892],
                  [-48.775447595498754, -24.605889050150093],
                  [-48.77510427274485, -24.60696205001428],
                  [-48.77407430448313, -24.60702057701493],
                  [-48.77405284681101, -24.606201196514288],
                  [-48.77534030713816, -24.605108680832362],
                  [-48.775683629892065, -24.604445363085333]]]),
            {
              "reference": 21,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.778408754251195, -24.603957627204323],
                  [-48.77725003995676, -24.602279801254365],
                  [-48.77881645002146, -24.602982149738576]]]),
            {
              "reference": 21,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.85307511818555, -24.590614443527596],
                  [-48.854190917135746, -24.58936569789193],
                  [-48.854212374807865, -24.591063208448162]]]),
            {
              "reference": 21,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.86586790991891, -24.59547272601805],
                  [-48.867026624213345, -24.594906911653833],
                  [-48.86724120093454, -24.595726366109698]]]),
            {
              "reference": 21,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.87638216925729, -24.58870229670722],
                  [-48.87582426978219, -24.58864376113984],
                  [-48.875051793585904, -24.5876876763319],
                  [-48.87518053961862, -24.587277923465138],
                  [-48.87558823538888, -24.587180363061147],
                  [-48.876253423224576, -24.588155963680606]]]),
            {
              "reference": 21,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.219308446245904, -24.501193459908002],
                  [-49.21887929280352, -24.5002562340832],
                  [-49.22033841450762, -24.500178131615748],
                  [-49.22162587483477, -24.5011153580228]]]),
            {
              "reference": 21,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.78672141059084, -24.634364185694047],
                  [-48.791184606391624, -24.633310925866212],
                  [-48.78938216193362, -24.635573473065893],
                  [-48.785906019050316, -24.635534463978523]]]),
            {
              "reference": 21,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.75217074124768, -24.621607066082934],
                  [-48.74963873593762, -24.62227029281651],
                  [-48.748565852331666, -24.622075226495397],
                  [-48.74903792111829, -24.621060876719312],
                  [-48.75126951901868, -24.62098284947258]]]),
            {
              "reference": 21,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.78916376798108, -24.618407923012164],
                  [-48.789807498144654, -24.61602801958499],
                  [-48.79199618070081, -24.615676882458086],
                  [-48.790279566931275, -24.617744675790043]]]),
            {
              "reference": 21,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.77300010229013, -25.836104528878685],
                  [-48.770682673701266, -25.83838342396892],
                  [-48.77089725042246, -25.834482237835083]]]),
            {
              "reference": 21,
              "system:index": "13"
            })]),
    flo = /* color: #d926ff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.90361195517648, -24.614806431254735],
                  [-48.904470262061245, -24.613011702494564],
                  [-48.90477066947091, -24.614884462355715]]]),
            {
              "reference": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.90507107688058, -24.609695288110025],
                  [-48.906444367896206, -24.611997279194245],
                  [-48.90288239432443, -24.61223137760919]]]),
            {
              "reference": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.670983729444025, -24.8230053141239],
                  [-47.66866630085516, -24.82230420580131],
                  [-47.669009623609064, -24.820746173099508],
                  [-47.67064040669012, -24.821603093510483]]]),
            {
              "reference": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.23424742001528, -24.556113381649183],
                  [-47.23364660519594, -24.557908926032777],
                  [-47.2330243319213, -24.5578650134408],
                  [-47.23304579037661, -24.557255116652257],
                  [-47.23323890942568, -24.556406135205116]]]),
            {
              "reference": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.26826861467191, -24.41243202833697],
                  [-47.26708844270536, -24.41239294987576],
                  [-47.26661637391874, -24.4120803217507],
                  [-47.2675819691641, -24.411845850148836],
                  [-47.26852610673734, -24.41223663591002]]]),
            {
              "reference": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.217629199476185, -24.703078623939305],
                  [-49.21880937144274, -24.704306739177312],
                  [-49.21395993754381, -24.703819393309914],
                  [-49.21331620738024, -24.70263026139046],
                  [-49.216663604230824, -24.70253279105756]]]),
            {
              "reference": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.22816491648668, -24.69964763466163],
                  [-49.22192073390001, -24.700583368382357],
                  [-49.2222425989818, -24.699355216432416],
                  [-49.227113490552846, -24.698828861890092]]]),
            {
              "reference": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.20355296656603, -24.703643948330832],
                  [-49.20196509882921, -24.703604960524146],
                  [-49.20157886073107, -24.70243532064841],
                  [-49.20376754328722, -24.702864189878177]]]),
            {
              "reference": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.79110434575555, -24.61787622085214],
                  [-48.79039624257562, -24.618812567864026],
                  [-48.79033186955926, -24.617778684301836],
                  [-48.79067519231317, -24.617505581556234]]]),
            {
              "reference": 3,
              "system:index": "8"
            })]);

// Define the region ID (reg_20)
var regiaoID = 'reg_20'; // old 11

// Define whether to collect data (false)
var coleta = false;   // true or false

// Define the years to process (2016-2023)
var anos = [2016,2017,2018,2019,2020,2021,2022,2023]

// If collecting data, only process 2023
if (coleta) {var anos = [2023]}

// Define the number of trees for the Random Forest classifier (100)
var RFtrees = 100;

// If collecting data, use 200 trees
if (coleta) {var RFtrees = 200}

// Define the output version (1)
var versao_out = 1;

// Define the version of the point data (S2_v1)
var versao_pt = 'S2_v1';

// Define the stable version (3)
var versao_estavel = '3'

// Define the input directory for point data
var dir_pt_in = 'projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/';

// Load the 250k biome collection
var bioma250mil = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil');

// Filter the collection to only include the Mata Atlântica biome
var bioma250mil_MA_vetor = bioma250mil.filterMetadata('Bioma','equals', 'Mata Atlântica');

// Load the biome raster
var biomes = ee.Image('projects/mapbiomas-workspace/AUXILIAR/biomas-raster-41');

// Mask the biome raster to only include the Mata Atlântica biome
var bioma250mil_MA = biomes.mask(biomes.eq(2));

// Add the Mata Atlântica biome layer to the map
Map.addLayer(bioma250mil_MA,{},'layer bioma',false)

// Import the palettes module
var palettes = require('users/mapbiomas/modules:Palettes.js');

// Define the visualization parameters for the classification
var vis = {
    'min': 0,
    'max': 62,
    'palette': palettes.get('classification7')
};

// Load the Mata Atlântica regions collection
var regioesCollection = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/Mata_Atlantica_col6_PLANET');

// Define the visualization parameters for the median composite
var visParMedian2 = {bands: ['swir1_median', 'nir_median', 'red_median'],gain: [0.08, 0.06, 0.2],gamma: 0.85}

// Define the biome name (MATAATLANTICA)
var bioma = "MATAATLANTICA";

// Define the output directory
var dirout = 'projects/mapbiomas-workspace/COLECAO7/classificacao-ma/';

// Load the Sentinel-2 cluster image
var S2_cluster = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/mosaicos_MA_S2_clusters_2106_2023')

// Filter the regions collection to only include the specified region ID
var limite = regioesCollection.filterMetadata('reg_id', "equals", regiaoID);
//var limite = reg_04_rev

// Load the stable map from collection 6
var mapa_estavel_col6 = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/col7/MATA_ATLANTICA/MA_amostras_estaveis85a20_col6_v1')

// Add the stable map layer to the map
Map.addLayer(mapa_estavel_col6, vis, 'mapa_estavel_col6', false);

// Create a blank image
var blank = ee.Image(0).mask(0);
// Outline the region boundary
var outline = blank.paint(limite, 'AA0000', 2); 
// Define the visualization parameters for the outline
var visPar = {'palette':'000000','opacity': 0.6};
// Add the outline layer to the map
Map.addLayer(outline, visPar, regiaoID, false);

// Define a function to shuffle a feature collection
var shuffle = function (collection, seed) {
    // Add a random column to the collection
    collection = collection.randomColumn('random', seed || 1)
        // Sort the collection by the random column
        .sort('random', true)
        // Map over the collection and set a new ID based on the random value
        .map(function (feature) {
                var rescaled = ee.Number(feature.get('random')).multiply(1000000000).round();
                return feature.set('new_id', rescaled)});
    // Get a list of the new IDs
    var randomIdList = ee.List(collection.reduceColumns(ee.Reducer.toList(), ['new_id']).get('list'));
    // Create a sequential list of IDs
    var sequentialIdList = ee.List.sequence(1, collection.size());
    // Remap the collection using the new and sequential IDs
    var shuffled = collection.remap(randomIdList, sequentialIdList, 'new_id');
    // Return the shuffled collection
    return shuffled;
};

// Define the visualization parameters for the hand-labeled data
var vis_hand = {
    'min': 0,
    'max': 60,
    'palette': 'blue,white,green,orange,red,brown'
};

// Loop through the years
for (var i_ano=0;i_ano<anos.length; i_ano++){
  // Get the current year
  var ano = anos[i_ano];
  // Define the asset path for the Sentinel-2 mosaics
  var asset = 'projects/mapbiomas-mosaics/assets/SENTINEL/BRAZIL/mosaics-3';
  // Define the band names to use for classification
  var bandNames = ee.List([
  //  THE 60 MOST IMPORTANT BANDS FOR THIS REGION
  'latitude','blue_median','green_median_texture_'+ano,'longitude','nddi_median_wet','dswi5_median_wet','green_median','blue_median_dry','rvi_median','cvi_median','red_edge_1_median_dry','red_edge_1_median_wet','red_median_wet','avi_median','osavi_median','swir2_median_wet','cvi_median_wet','iia_median','blue_median_wet','brba_median_dry','afvi_median_wet','osavi_median_wet','wetness_median_wet','osavi_median_dry','ndwi_median_'+ano,'red_edge_3_median','rvi_median_1','red_edge_2_median_wet','gvmi_median','ri_median_dry','red_edge_2_median','shape_median_wet','red_edge_3_stdDev','swir1_stdDev','red_edge_1_median','nddi_median','bsi_median_2','ui_median','spri_median_wet','awei_median_wet','gemi_median_dry','swir2_median','gli_median_wet','awei_median_dry','green_median_wet','gvmi_median_dry','brightness_median_dry','ndvi_median','co2flux_median','red_edge_2_stdDev','ndvi_median_wet_'+ano,'ui_median_wet','red_min','red_stdDev','nir_median_dry','red_edge_4_median_wet','nir_median','brightness_median','evi_median_dry','bsi_median',

  // ALL 143 BANDS TO FEATURE IMPORTANCE
  //    'blue_median','afvi_median','afvi_median_dry','afvi_median_wet','avi_median','avi_median_dry','avi_median_wet','awei_median','awei_median_dry','awei_median_wet','blue_median_dry','blue_median_wet','blue_stdDev','brba_median','brba_median_dry','brba_median_wet','brightness_median','brightness_median_dry','brightness_median_wet','bsi_median','bsi_median_1','bsi_median_2','clusters_2023','co2flux_median','cvi_median','cvi_median_dry','cvi_median_wet','dswi5_median','dswi5_median_dry','dswi5_median_wet','evi_median','evi_median_dry','evi_median_wet','gcvi_median','gcvi_median_dry','gcvi_median_wet','gemi_median','gemi_median_dry','gemi_median_wet','gli_median','gli_median_dry','gli_median_wet','green_median','green_median_dry','green_median_texture','green_median_texture_2023','green_median_wet','green_min','green_stdDev','gvmi_median','gvmi_median_1','gvmi_median_dry','gvmi_median_dry_1','gvmi_median_wet','gvmi_median_wet_1','iia_median','iia_median_dry','iia_median_wet','lai_median','latitude','longitude','lswi_median','lswi_median_dry','lswi_median_wet','mbi_median','mbi_median_dry','mbi_median_wet','msi_median','msi_median_dry','msi_median_wet','nddi_median','nddi_median_dry','nddi_median_wet','ndvi_median','ndvi_median_dry','ndvi_median_dry_2023','ndvi_median_wet','ndvi_median_wet_2023','ndwi_median','ndwi_median_2023','ndwi_median_dry','ndwi_median_wet','nir_median','nir_median_contrast','nir_median_dry','nir_median_dry_contrast','nir_median_wet','nir_stdDev','osavi_median','osavi_median_dry','osavi_median_wet','ratio_median','ratio_median_dry','ratio_median_wet','red_edge_1_median','red_edge_1_median_dry','red_edge_1_median_wet','red_edge_1_stdDev','red_edge_2_median','red_edge_2_median_dry','red_edge_2_median_wet','red_edge_2_stdDev','red_edge_3_median','red_edge_3_median_dry','red_edge_3_median_wet','red_edge_3_stdDev','red_edge_4_median','red_edge_4_median_dry','red_edge_4_median_wet','red_edge_4_stdDev','red_median','red_median_contrast','red_median_dry','red_median_dry_contrast','red_median_wet','red_min','red_stdDev','ri_median','ri_median_dry','ri_median_wet','rvi_median','rvi_median_1','rvi_median_wet','shape_median','shape_median_dry','shape_median_wet','spri_median','spri_median_1','spri_median_wet','swir1_median','swir1_median_dry','swir1_median_wet','swir1_stdDev','swir2_median','swir2_median_dry','swir2_median_wet','swir2_stdDev','ui_median','ui_median_dry','ui_median_wet','wetness_median','wetness_median_dry','wetness_median_wet',
  ])

  // Load the Sentinel-2 image collection
  var collection = ee.ImageCollection(asset)
        // Filter the collection by version and year
        .filter(ee.Filter.eq('version', '3'))
        .filter(ee.Filter.eq('year', ano))
        // Filter the collection by biome
        .filter(ee.Filter.inList('biome', [
            'MATAATLANTICA',
        ])); 

  // Create a mosaic of the image collection
  var mosaicoTotal = collection.mosaic()

  // Import the function to add indices for the Caatinga biome
  var addIndexCaatinga = require('users/marcosrosaUSP/MapBiomas_col9_MataAtlan:Mata_Atlantica_SENTINEL2/processa_Bandas_Sentinel2_CAATINGA');

  // Add the Caatinga indices to the mosaic
  mosaicoTotal = addIndexCaatinga.get(mosaicoTotal);

  // Add the Sentinel-2 cluster bands to the mosaic
  mosaicoTotal = mosaicoTotal.addBands(S2_cluster.select([
    'clusters_'+ano, 'ndvi_median_dry_'+ano,'ndvi_median_wet_'+ano,'ndwi_median_'+ano, 'green_median_texture_'+ano
    ]))
    
  // Add the Sentinel-2 mosaic layer to the map
  Map.addLayer(mosaicoTotal, {'bands': ['swir1_median', 'nir_median', 'red_median'],
    'gain': [0.08, 0.07, 0.2],'gamma': 0.85}, 'Sentinel 2 '+ano, false);
  //print(mosaicoTotal)
  //var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/REGIONs_'+regiaoID+'_'+ano)

  // Load the training points
  var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/pontos_train_v1_'+ano)
                    // Filter the points by region ID
                    .filterMetadata('reg_id', 'equals', regiaoID)
          
    // Filter the training points by reference class
    var BDflo = BDamostras.filterMetadata("reference", "equals", 3)
    var BDsav = BDamostras.filterMetadata("reference", "equals", 4)//.limit(100)
    var BDreflo = BDamostras.filterMetadata("reference", "equals", 9)
    var BDvarzea = BDamostras.filterMetadata("reference", "equals", 11)
    var BDcampo = BDamostras.filterMetadata("reference", "equals", 12)
    var BDOutroNFlo = BDamostras.filterMetadata("reference", "equals", 13)
    var BDagro = BDamostras.filterMetadata("reference", "equals", 21)
    // Shuffle the agriculture points and limit to 2500
    BDagro = shuffle(BDagro, 2).limit(2500)
    var BDNaoVeg = BDamostras.filterMetadata("reference", "equals", 22)
    var BDAflora = BDamostras.filterMetadata("reference", "equals", 29)
    var BDagua = BDamostras.filterMetadata("reference", "equals", 33)

  // Complementary samples
  // Merge the complementary samples
  var amostraTotal = varzea.merge(restinga).merge(flo).merge(agro)//.merge(agua)
  
  // Reduce the complementary samples to an image
  var amostraTotalimg = amostraTotal.reduceToImage({properties: ['reference'],reducer: ee.Reducer.first()})

  // Rename the band
  amostraTotalimg = amostraTotalimg.select([0],['reference'])

   // Sample the mosaic using the forest points
  var training_flo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 200, 'region': flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': nao_flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_sav = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1500, 'region': sav.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': aflora.filterBounds(limite), 'scale': 10, 'seed': 1});

  // Sample the mosaic using the varzea points
  var training_var = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1600, 'region': varzea.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_agu = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 100, 'region': agua.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_cam = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 800, 'region': campo.filterBounds(limite), 'scale': 10, 'seed': 1});

  // Sample the mosaic using the restinga points
  var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': restinga.filterBounds(limite), 'scale': 10, 'seed': 1});

  // Sample the mosaic using the agriculture points
  var training_agr = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 400, 'region': agro.filterBounds(limite), 'scale': 10, 'seed': 1});

// If collecting data, print the number of samples for each class
if (coleta) {
// print('BDflo',BDflo.size())
// print('BDsav',BDsav.size())
// print('BDvar',BDvarzea.size())
// print('BDcam',BDcampo.size())
// print('BDOut',BDOutroNFlo.size())
// print('BDAfl',BDAflora.size())
// print('BDagr',BDagro.size())
// print('BDNao',BDNaoVeg.size())
// print('BDagu',BDagua.size())
// Print the number of samples for each class
print('training_flo',training_flo.size())
//print('training_var',training_var.size())
//print('training_nflo',training_nflo.size())
//print('training_cam',training_cam.size())
//print('training_sav',training_sav.size())
//print('training_afl',training_afl.size())
//print('training_cam',training_cam.size())
print('training_agr',training_agr.size())
}

  // Merge the training samples
  var training = BDflo.merge(BDreflo).merge(BDcampo)//.merge(BDsav).merge(BDOutroNFlo).merge(BDAflora)
                      .merge(BDagro).merge(BDNaoVeg).merge(BDagua)
                      //complementares
                      // .merge(training_afl)
                      .merge(training_var)
                      .merge(training_nflo).merge(training_agr).merge(training_flo)
                      // //.merge(training_agu).merge(training_agr)

  // Train the Random Forest classifier
  var classifierRF = ee.Classifier.smileRandomForest({numberOfTrees: RFtrees, variablesPerSplit:1}).train(training, 'reference', bandNames);

  // If collecting data, print the classifier explanation
  if (coleta) {print(classifierRF.explain())}

  // Train the Gradient Tree Boost classifier
  var classifierGTB = ee.Classifier.smileGradientTreeBoost({numberOfTrees: 30, shrinkage: 0.1, samplingRate: 0.8, loss: 'LeastSquares'}).train(training, 'reference', bandNames);

  // print(classifier.explain())

  // Classify the mosaic using the Random Forest classifier
  var classifiedRF = mosaicoTotal.classify(classifierRF).mask(mosaicoTotal.select('blue_median'));

  // Classify the mosaic using the Gradient Tree Boost classifier
  var classifiedGTB = mosaicoTotal.classify(classifierGTB).mask(mosaicoTotal.select('blue_median'));

  // Rename the classification band and clip the image to the region boundary
  classifiedRF = classifiedRF.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()
  // classifiedGTB = classifiedGTB.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()

  // If collecting data, add the classification layers to the map
  if (coleta) {  
    Map.addLayer(classifiedRF, vis, 'RF'+ano+"_"+regiaoID, false);
    // Map.addLayer(classifiedGTB, vis, 'GTB'+ano+"_"+regiaoID, false);
  }

  // If it's the first year, initialize the combined classification image
  if (i_ano == 0){ var classified16a23RF = classifiedRF;}//  var classified16a23GTB = classifiedGTB}  
  // Otherwise, add the current year's classification to the combined image
  else {classified16a23RF = classified16a23RF.addBands(classifiedRF);}// classified16a23GTB = classified16a23GTB.addBands(classifiedGTB)}
}

// If collecting data, do nothing
if (coleta) {}
// Otherwise, export the classification image to an asset
   else 
   {
     // Set the metadata for the classification image
     classified16a23RF = classified16a23RF
     .set('territory', 'BRAZIL')
     .set('biome', 'MATA ATÂNTICA')
     .set('source', 'arcplan')
     .set('version', '1')
     .set('collection_id',versao_out)

//     classified16a23GTB = classified16a23GTB
//     .set('territory', 'BRAZIL')
//     .set('biome', 'MATA ATÂNTICA')
//     .set('source', 'arcplan')
//     .set('version', '1')
//     .set('collection_id',versao_out)
     
    // Export the Random Forest classification image to an asset
    Export.image.toAsset({
       "image": classified16a23RF.toInt8(),
       "description": regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "assetId": dirout + regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "scale": 10,
       "pyramidingPolicy": {
           '.default': 'mode'
       },
       "maxPixels": 1e13,
       "region": limite
     });    
     
//    Export.image.toAsset({
//       "image": classified16a23GTB.toInt8(),
//       "description": regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "assetId": dirout + regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "scale": 10,
//       "pyramidingPolicy": {
//           '.default': 'mode'
//       },
//       "maxPixels": 1e13,
//       "region": limite
//     });    
}
