var varzea = /* color: #0b4a8b */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.74662801066815, -25.94554481245618],
                  [-49.72379704753338, -25.936591611029993],
                  [-49.72551366130291, -25.934584765623963],
                  [-49.73203679362713, -25.938444053369196],
                  [-49.74353810588299, -25.942611942119665]]]),
            {
              "reference": 11,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.64370695690094, -25.902933838626115],
                  [-49.650916734732974, -25.90895588892433],
                  [-49.65126005748688, -25.912198404050407],
                  [-49.64302031139313, -25.90571328465645]]]),
            {
              "reference": 11,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.5947834644693, -25.853356059518976],
                  [-49.592723527945864, -25.858453800110752],
                  [-49.58826033214508, -25.860152998127276],
                  [-49.59135023693024, -25.857990378230884],
                  [-49.592723527945864, -25.85644562551102],
                  [-49.593238512076724, -25.853047098479486]]]),
            {
              "reference": 11,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.479336479127326, -25.908175376313],
                  [-49.47598908227674, -25.909796655747975],
                  [-49.47847817224256, -25.90539598829269]]]),
            {
              "reference": 11,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.3747467528651, -25.8109713515088],
                  [-49.37680668938854, -25.812516697936857],
                  [-49.37654919732311, -25.813212097252357],
                  [-49.37543339837291, -25.81259396472907],
                  [-49.37448926079967, -25.81189856178478]]]),
            {
              "reference": 11,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.200897092994005, -25.84035151081994],
                  [-49.205875272925645, -25.84066050502491],
                  [-49.199867124732286, -25.84266894768564]]]),
            {
              "reference": 11,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.21308505075768, -25.834325962529036],
                  [-49.21119677561119, -25.84066050502491],
                  [-49.21068179148033, -25.837261524385486]]]),
            {
              "reference": 11,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.115238065894395, -25.84884855737565],
                  [-49.111976499732286, -25.853792012654807],
                  [-49.11214816110924, -25.85101134448894]]]),
            {
              "reference": 11,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.34341509138304, -25.63154289492514],
                  [-49.337235281812724, -25.629530881549808],
                  [-49.3387802342053, -25.62829270262422]]]),
            {
              "reference": 11,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.391651938306865, -25.631388125869],
                  [-49.39422685896116, -25.63572158361635],
                  [-49.388905356275615, -25.632161969143844]]]),
            {
              "reference": 11,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.24752722870322, -25.583134256164772],
                  [-49.24546729217978, -25.58561153676646],
                  [-49.24529563080283, -25.58266976034289]]]),
            {
              "reference": 11,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.23053275238486, -25.573534309504808],
                  [-49.23070441376181, -25.571366473067783],
                  [-49.232936011662204, -25.57477305556033]]]),
            {
              "reference": 11,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.134200373733705, -25.43027992729637],
                  [-49.130938807571596, -25.429659810319084],
                  [-49.133170405471986, -25.42872962886975]]]),
            {
              "reference": 11,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.46601619231077, -25.467820776915136],
                  [-49.466874499195534, -25.472315127864483],
                  [-49.46498622404905, -25.47479469788076],
                  [-49.46447123991819, -25.46735583447406]]]),
            {
              "reference": 11,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.59689502816849, -25.61303989880281],
                  [-49.58642368417435, -25.61830274248403],
                  [-49.59346180062943, -25.61303989880281]]]),
            {
              "reference": 11,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.89930907089486, -25.580965815600717],
                  [-49.89656248886361, -25.582978646466163],
                  [-49.89724913437142, -25.580501311362916]]]),
            {
              "reference": 11,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.087479738775194, -25.660509486054515],
                  [-50.08885302979082, -25.664377708173003],
                  [-50.0849048181209, -25.664841886395095]]]),
            {
              "reference": 11,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.153397707525194, -25.689595439558808],
                  [-50.15545764404863, -25.69454553310202],
                  [-50.152367739263475, -25.696092395138145]]]),
            {
              "reference": 11,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.178557883863455, -25.773619006955503],
                  [-50.17890120661736, -25.783666563843763],
                  [-50.17495299494744, -25.78042052313301]]]),
            {
              "reference": 11,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.48761084178784, -26.00523456453321],
                  [-50.48692419628003, -26.009091534895628],
                  [-50.48211767772534, -26.002766037025076]]]),
            {
              "reference": 11,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.6202072784614, -26.058882907350412],
                  [-50.622610537738744, -26.060579213939242],
                  [-50.61797568056101, -26.05980816853432]]]),
            {
              "reference": 11,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.40279880069249, -25.154016048785426],
                  [-50.403828768954206, -25.163027899044195],
                  [-50.39970889590733, -25.164892336663154]]]),
            {
              "reference": 11,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.40623202823155, -25.17499087838358],
                  [-50.41224017642491, -25.181515645072746],
                  [-50.40314212344639, -25.177010486350976]]]),
            {
              "reference": 11,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.4254581024503, -25.180738905450436],
                  [-50.421853213534284, -25.188661417289154],
                  [-50.422883181796, -25.182137033205944]]]),
            {
              "reference": 11,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.4575795989935, -25.256073803745508],
                  [-50.46084116515561, -25.259489305267536],
                  [-50.458609567255216, -25.266320020108925]]]),
            {
              "reference": 11,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.5703611236517, -25.284326425872084],
                  [-50.57619761046811, -25.284326425872084],
                  [-50.56915949401303, -25.28991407739924]]]),
            {
              "reference": 11,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.54959009704037, -25.392590916503508],
                  [-50.54770182189389, -25.396777930990417],
                  [-50.54718683776303, -25.39104013353736]]]),
            {
              "reference": 11,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.42788218078061, -25.37196387373206],
                  [-50.42685221251889, -25.381579926046008],
                  [-50.426165567011076, -25.373980206192545]]]),
            {
              "reference": 11,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.43200205382748, -25.509182336314424],
                  [-50.429942117304044, -25.50685840602088],
                  [-50.43097208556576, -25.504999229404593],
                  [-50.429427133173185, -25.503914696420026],
                  [-50.431143746942716, -25.5026752181599]]]),
            {
              "reference": 11,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.301948836927224, -25.84243037035703],
                  [-50.30933027613621, -25.847837557398307],
                  [-50.31036024439793, -25.852626573770156],
                  [-50.3034937893198, -25.847683069770348]]]),
            {
              "reference": 11,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.42090279828221, -25.932270537467847],
                  [-50.41712624798924, -25.930109238657884],
                  [-50.418671200381816, -25.928411047497313]]]),
            {
              "reference": 11,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.518557243724025, -23.82200676454994],
                  [-49.516840629954494, -23.823498603842868],
                  [-49.51799934424893, -23.821731950177984]]]),
            {
              "reference": 11,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.547267609019435, -23.817845227459706],
                  [-49.54842632331387, -23.81949415434361],
                  [-49.54645221747891, -23.817609664766238]]]),
            {
              "reference": 11,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.5376535272974, -23.80852513974149],
                  [-49.53761061195316, -23.80762208226873],
                  [-49.53859766487064, -23.808839245216465]]]),
            {
              "reference": 11,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.541289275936876, -23.820409061681207],
                  [-49.5406455457733, -23.821547586182046],
                  [-49.540817207150255, -23.820094984199145]]]),
            {
              "reference": 11,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.53995890026549, -23.828496295046673],
                  [-49.539830154232774, -23.826572678430175],
                  [-49.54047388439635, -23.82853555223166]]]),
            {
              "reference": 11,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.545795387081895, -23.815658558577358],
                  [-49.545280402951036, -23.816365255997752],
                  [-49.54510874157408, -23.815462253055582]]]),
            {
              "reference": 11,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.46524392373283, -23.832742770822918],
                  [-49.465329754421305, -23.833763420358775],
                  [-49.46485768563468, -23.833017561872655]]]),
            {
              "reference": 11,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.46468602425773, -23.831290294174735],
                  [-49.46485768563468, -23.832428723196063],
                  [-49.46421395547111, -23.831447319461365]]]),
            {
              "reference": 11,
              "system:index": "38"
            })]),
    agro = /* color: #00ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.54665635689521, -23.854959175784394],
                  [-50.54790090187812, -23.85397794259334],
                  [-50.54824422463203, -23.854959175784394],
                  [-50.547557579124216, -23.855626410109842]]]),
            {
              "reference": 21,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.5454118119123, -23.85295745219229],
                  [-50.54472516640449, -23.851819203417712],
                  [-50.546870933616404, -23.851976203843105],
                  [-50.54644178017402, -23.85303595173924]]]),
            {
              "reference": 21,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.60829244137586, -23.848063263122572],
                  [-50.61005197048963, -23.84892678813408],
                  [-50.60829244137586, -23.84931929760104]]]),
            {
              "reference": 21,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.609833065400515, -23.880923715466526],
                  [-50.61103469503919, -23.880413577432854],
                  [-50.61142093313733, -23.87951102060098],
                  [-50.612107578645144, -23.880217369961365],
                  [-50.61176425589124, -23.88111992186711],
                  [-50.61039096487561, -23.88166929820611]]]),
            {
              "reference": 21,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.618845287690554, -23.936477474060098],
                  [-50.61571246756116, -23.936987390849858],
                  [-50.61639911306897, -23.93561453336515]]]),
            {
              "reference": 21,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.60763816869603, -23.929588569773838],
                  [-50.606736946467024, -23.92868635622176],
                  [-50.60665111577855, -23.927980271653166],
                  [-50.60858230626927, -23.928215633605046]]]),
            {
              "reference": 21,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.64896564519749, -23.93331503721145],
                  [-50.648922729853254, -23.931471429922805],
                  [-50.649866867426496, -23.932412849700125]]]),
            {
              "reference": 21,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.66064270521134, -23.994250198956745],
                  [-50.65935524488419, -23.995583225609845],
                  [-50.65875443006485, -23.993936543620368]]]),
            {
              "reference": 21,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.68154247785538, -24.00044473523653],
                  [-50.68051250959366, -24.001307241956663],
                  [-50.68004044080704, -24.00005268481632],
                  [-50.68124207044571, -23.998523676765192]]]),
            {
              "reference": 21,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.32838764946234, -24.45924612074729],
                  [-50.33345166008246, -24.457917939448134],
                  [-50.32795849601996, -24.461199303099015]]]),
            {
              "reference": 21,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.29645863334906, -24.450417358708886],
                  [-50.3014368132807, -24.448854681520814],
                  [-50.29817524711859, -24.451901884088343]]]),
            {
              "reference": 21,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.33345166008246, -24.43814982184312],
                  [-50.33370915214789, -24.4362744243869],
                  [-50.33516827385199, -24.436821418193],
                  [-50.33542576591742, -24.440650308393078]]]),
            {
              "reference": 21,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.873576444878495, -24.49759065678499],
                  [-50.87786797930232, -24.497043926903125],
                  [-50.8779538099908, -24.500324270534634]]]),
            {
              "reference": 21,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.91159943987361, -24.521332060548133],
                  [-50.915290159478104, -24.522191040405854],
                  [-50.91082696367732, -24.52437750807957]]]),
            {
              "reference": 21,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.81892398068123, -24.555237985583815],
                  [-50.82175639340095, -24.552739776668595],
                  [-50.82312968441658, -24.554457300643662],
                  [-50.82132723995857, -24.55555025819908]]]),
            {
              "reference": 21,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.824245483366774, -24.560468449312754],
                  [-50.82776454159431, -24.560624579204603],
                  [-50.827936202971266, -24.561561354472655],
                  [-50.82364466854744, -24.561405225747393]]]),
            {
              "reference": 21,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.85797694393806, -24.599807030512203],
                  [-50.85909274288826, -24.59824621114796],
                  [-50.863641769377516, -24.598324252578468],
                  [-50.861152679411695, -24.599807030512203]]]),
            {
              "reference": 21,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.849175320497686, -24.621303895361656],
                  [-50.85200773321741, -24.62083573206082],
                  [-50.85106359564417, -24.622864427036394]]]),
            {
              "reference": 21,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.915865765443975, -24.642837511699295],
                  [-50.91732488714808, -24.641667301828416],
                  [-50.91904150091761, -24.642993538853705],
                  [-50.916895733705694, -24.643773671701982]]]),
            {
              "reference": 21,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.92670268060106, -24.685336153352768],
                  [-50.924814405454576, -24.685648101198577],
                  [-50.92429942132372, -24.68447829275156],
                  [-50.925930200270095, -24.68451729058684]]]),
            {
              "reference": 21,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.861842137345, -24.79535447274916],
                  [-50.86064050770633, -24.797302409569877],
                  [-50.85806558705203, -24.797302409569877],
                  [-50.85789392567508, -24.795744062560928]]]),
            {
              "reference": 21,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.850512486466094, -24.804314728774],
                  [-50.85162828541629, -24.80556132177977],
                  [-50.847765904434844, -24.805483410084154]]]),
            {
              "reference": 21,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.88481303804478, -24.93724280265871],
                  [-50.88386890047154, -24.93521923969132],
                  [-50.88687297456822, -24.935764048374462]]]),
            {
              "reference": 21,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.855029789143416, -24.938643711400818],
                  [-50.853828159504744, -24.939577641713594],
                  [-50.852025715046736, -24.93942198715307],
                  [-50.85348483675084, -24.938410227716517]]]),
            {
              "reference": 21,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.851768222981306, -24.9236998637957],
                  [-50.85211154573521, -24.922298785200447],
                  [-50.853570667439314, -24.923232839366197],
                  [-50.85374232881627, -24.924945253626095]]]),
            {
              "reference": 21,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.82962390535435, -24.971249251815685],
                  [-50.82764979951939, -24.968837204555193],
                  [-50.829108921223494, -24.968059114707017]]]),
            {
              "reference": 21,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.88833209627232, -25.008279908926802],
                  [-50.88781711214146, -25.006568653877846],
                  [-50.88970538728795, -25.006179728950897]]]),
            {
              "reference": 21,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.95423741569732, -25.049516216597887],
                  [-48.953422024156794, -25.049905004200713],
                  [-48.95333619346832, -25.048855274843365]]]),
            {
              "reference": 21,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.9532074474356, -25.04796105385689],
                  [-48.95226330986236, -25.048622000432214],
                  [-48.952606632616266, -25.04772777774428]]]),
            {
              "reference": 21,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.95179124107574, -25.04679466885541],
                  [-48.95054669609283, -25.04784441585607],
                  [-48.95127625694488, -25.046483630981026]]]),
            {
              "reference": 21,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.95651192894195, -25.05387056731872],
                  [-48.954366161730036, -25.05445372754508],
                  [-48.95599694481109, -25.052898627442467]]]),
            {
              "reference": 21,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.9570053663358, -25.05921759347311],
                  [-48.956104144106796, -25.06127799062208],
                  [-48.9555462446317, -25.059256469211686]]]),
            {
              "reference": 21,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.97874272841261, -25.07163263581779],
                  [-48.97676862257765, -25.071282789071507],
                  [-48.97874272841261, -25.070621964713037]]]),
            {
              "reference": 21,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.094448650520015, -26.022232428183223],
                  [-49.09354742829101, -26.02126830539654],
                  [-49.095221126716304, -26.021114045015675]]]),
            {
              "reference": 21,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.09153040711181, -26.020535566781625],
                  [-49.09178789917724, -26.022155298651764],
                  [-49.09058626953857, -26.022425251790118]]]),
            {
              "reference": 21,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.08565100495117, -26.02963662717263],
                  [-49.0853505975415, -26.031333356968055],
                  [-49.08410605255859, -26.02867256522006],
                  [-49.08552225891845, -26.02716861275586]]]),
            {
              "reference": 21,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.07277640167968, -26.021306870460077],
                  [-49.07208975617187, -26.02377500816737],
                  [-49.07110270325439, -26.02296515620394]]]),
            {
              "reference": 21,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.08101614777343, -26.021846780018983],
                  [-49.07981451813476, -26.022425251790118],
                  [-49.07934244934814, -26.020689827922823]]]),
            {
              "reference": 21,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.07959994141357, -26.03650051925958],
                  [-49.07814081970947, -26.035497953329706],
                  [-49.07955702606933, -26.035112348767065]]]),
            {
              "reference": 21,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.08135947052734, -26.033916966566657],
                  [-49.079857433479, -26.034495378830012],
                  [-49.08024367157714, -26.033299990341906]]]),
            {
              "reference": 21,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.078441227119136, -26.028749690467787],
                  [-49.07754000489013, -26.030176498405748],
                  [-49.076982105415034, -26.028595439921617]]]),
            {
              "reference": 21,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.07934244934814, -26.027091486468812],
                  [-49.07775458161132, -26.028094124246035],
                  [-49.07706793610351, -26.02747711739708]]]),
            {
              "reference": 21,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.526837319888074, -25.946241765052644],
                  [-50.526837319888074, -25.949946317037696],
                  [-50.52091500238319, -25.946704840424808]]]),
            {
              "reference": 21,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.539282769717175, -25.951798549320582],
                  [-50.53816697076698, -25.954576843103712],
                  [-50.53250214532753, -25.951258317914967]]]),
            {
              "reference": 21,
              "system:index": "43"
            })]);
// Define the region ID (reg_15)
var regiaoID = 'reg_15'; // old 11

// Define whether to collect data (false)
var coleta = false;   // true or false

// Define the years to process (2016-2023)
var anos = [2016,2017,2018,2019,2020,2021,2022,2023]

// If collecting data, only process 2023
if (coleta) {var anos = [2023]}

// Define the number of trees for the Random Forest classifier (100)
var RFtrees = 100;

// If collecting data, use 200 trees
if (coleta) {var RFtrees = 200}

// Define the output version (1)
var versao_out = 1;

// Define the version of the point data (S2_v1)
var versao_pt = 'S2_v1';

// Define the stable version (3)
var versao_estavel = '3'

// Define the input directory for point data
var dir_pt_in = 'projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/';

// Load the 250,000 biomes feature collection
var bioma250mil = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil');

// Filter the collection to only include the Atlantic Forest biome
var bioma250mil_MA_vetor = bioma250mil.filterMetadata('Bioma','equals', 'Mata Atlântica');

// Load the biomes raster
var biomes = ee.Image('projects/mapbiomas-workspace/AUXILIAR/biomas-raster-41');

// Mask the biomes raster to only include the Atlantic Forest biome
var bioma250mil_MA = biomes.mask(biomes.eq(2));

// Add the Atlantic Forest biome layer to the map
Map.addLayer(bioma250mil_MA,{},'layer bioma',false)

// Import the palettes module
var palettes = require('users/mapbiomas/modules:Palettes.js');

// Define the visualization parameters for the classification
var vis = {
    'min': 0,
    'max': 62,
    'palette': palettes.get('classification7')
};

// Load the Atlantic Forest regions feature collection
var regioesCollection = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/Mata_Atlantica_col6_PLANET');

// Define the visualization parameters for the median composite
var visParMedian2 = {bands: ['swir1_median', 'nir_median', 'red_median'],gain: [0.08, 0.06, 0.2],gamma: 0.85}

// Define the biome name (MATAATLANTICA)
var bioma = "MATAATLANTICA";

// Define the output directory
var dirout = 'projects/mapbiomas-workspace/COLECAO7/classificacao-ma/';

// Load the S2 cluster image
var S2_cluster = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/mosaicos_MA_S2_clusters_2106_2023')

// Filter the regions collection to only include the specified region ID
var limite = regioesCollection.filterMetadata('reg_id', "equals", regiaoID);
//var limite = reg_04_rev

// Load the stable map from collection 6
var mapa_estavel_col6 = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/col7/MATA_ATLANTICA/MA_amostras_estaveis85a20_col6_v1')

// Add the stable map layer to the map
Map.addLayer(mapa_estavel_col6, vis, 'mapa_estavel_col6', false);

// Create a blank image
var blank = ee.Image(0).mask(0);
// Paint the outline of the region on the blank image
var outline = blank.paint(limite, 'AA0000', 2); 
// Define the visualization parameters for the outline
var visPar = {'palette':'000000','opacity': 0.6};
// Add the outline layer to the map
Map.addLayer(outline, visPar, regiaoID, false);

// Define a function to shuffle a feature collection
var shuffle = function (collection, seed) {
    // Add a random column to the collection
    collection = collection.randomColumn('random', seed || 1)
        // Sort the collection by the random column
        .sort('random', true)
        // Map over the collection and set a new ID based on the random column
        .map(function (feature) {
                var rescaled = ee.Number(feature.get('random')).multiply(1000000000).round();
                return feature.set('new_id', rescaled)});
    // Get a list of the new IDs
    var randomIdList = ee.List(collection.reduceColumns(ee.Reducer.toList(), ['new_id']).get('list'));
    // Create a sequential list of IDs
    var sequentialIdList = ee.List.sequence(1, collection.size());
    // Remap the collection using the random and sequential IDs
    var shuffled = collection.remap(randomIdList, sequentialIdList, 'new_id');
    // Return the shuffled collection
    return shuffled;
};

// Define the visualization parameters for the hand-labeled data
var vis_hand = {
    'min': 0,
    'max': 60,
    'palette': 'blue,white,green,orange,red,brown'
};

// Loop through the years
for (var i_ano=0;i_ano<anos.length; i_ano++){
  // Get the current year
  var ano = anos[i_ano];

  // Define the asset path for the Sentinel 2 mosaics
  var asset = 'projects/mapbiomas-mosaics/assets/SENTINEL/BRAZIL/mosaics-3';
  // Define the band names to use for classification
  var bandNames = ee.List([
  //  THE 60 MOST IMPORTANT BANDS FOR THIS REGION
  'green_median_texture_'+ano,'wetness_median_wet','ri_median','gli_median_dry','mbi_median_wet','gvmi_median_dry','blue_median','nir_median','gvmi_median_dry_1','green_median_texture','red_edge_4_stdDev','cvi_median_dry','ri_median_dry','longitude','ndvi_median','ndwi_median_dry','brightness_median_dry','rvi_median_1','ndvi_median_wet','swir2_median_wet','wetness_median_dry','mbi_median_dry','green_min','red_edge_1_median','lai_median','gvmi_median_wet_1','gemi_median_wet','ui_median','red_edge_3_median_wet','ndvi_median_wet_'+ano,'spri_median','blue_median_dry','rvi_median','gcvi_median_wet','green_median_wet','green_median','awei_median','ui_median_dry','brightness_median','ndwi_median_wet','rvi_median_wet','gvmi_median','afvi_median_dry','ratio_median_dry','dswi5_median_dry','avi_median_dry','red_stdDev','dswi5_median','iia_median','red_edge_3_stdDev','ri_median_wet','iia_median_dry','red_median_dry','nir_median_dry','bsi_median_2','ratio_median_wet','red_edge_1_median_wet','latitude','awei_median_dry','cvi_median',

  // ALL 143 BANDS TO FEATURE IMPORTANCE
  //    'blue_median','afvi_median','afvi_median_dry','afvi_median_wet','avi_median','avi_median_dry','avi_median_wet','awei_median','awei_median_dry','awei_median_wet','blue_median_dry','blue_median_wet','blue_stdDev','brba_median','brba_median_dry','brba_median_wet','brightness_median','brightness_median_dry','brightness_median_wet','bsi_median','bsi_median_1','bsi_median_2','clusters_2023','co2flux_median','cvi_median','cvi_median_dry','cvi_median_wet','dswi5_median','dswi5_median_dry','dswi5_median_wet','evi_median','evi_median_dry','evi_median_wet','gcvi_median','gcvi_median_dry','gcvi_median_wet','gemi_median','gemi_median_dry','gemi_median_wet','gli_median','gli_median_dry','gli_median_wet','green_median','green_median_dry','green_median_texture','green_median_texture_2023','green_median_wet','green_min','green_stdDev','gvmi_median','gvmi_median_1','gvmi_median_dry','gvmi_median_dry_1','gvmi_median_wet','gvmi_median_wet_1','iia_median','iia_median_dry','iia_median_wet','lai_median','latitude','longitude','lswi_median','lswi_median_dry','lswi_median_wet','mbi_median','mbi_median_dry','mbi_median_wet','msi_median','msi_median_dry','msi_median_wet','nddi_median','nddi_median_dry','nddi_median_wet','ndvi_median','ndvi_median_dry','ndvi_median_dry_2023','ndvi_median_wet','ndvi_median_wet_2023','ndwi_median','ndwi_median_2023','ndwi_median_dry','ndwi_median_wet','nir_median','nir_median_contrast','nir_median_dry','nir_median_dry_contrast','nir_median_wet','nir_stdDev','osavi_median','osavi_median_dry','osavi_median_wet','ratio_median','ratio_median_dry','ratio_median_wet','red_edge_1_median','red_edge_1_median_dry','red_edge_1_median_wet','red_edge_1_stdDev','red_edge_2_median','red_edge_2_median_dry','red_edge_2_median_wet','red_edge_2_stdDev','red_edge_3_median','red_edge_3_median_dry','red_edge_3_median_wet','red_edge_3_stdDev','red_edge_4_median','red_edge_4_median_dry','red_edge_4_median_wet','red_edge_4_stdDev','red_median','red_median_contrast','red_median_dry','red_median_dry_contrast','red_median_wet','red_min','red_stdDev','ri_median','ri_median_dry','ri_median_wet','rvi_median','rvi_median_1','rvi_median_wet','shape_median','shape_median_dry','shape_median_wet','spri_median','spri_median_1','spri_median_wet','swir1_median','swir1_median_dry','swir1_median_wet','swir1_stdDev','swir2_median','swir2_median_dry','swir2_median_wet','swir2_stdDev','ui_median','ui_median_dry','ui_median_wet','wetness_median','wetness_median_dry','wetness_median_wet',
  ])

  // Load the Sentinel 2 image collection
  var collection = ee.ImageCollection(asset)
        // Filter the collection by version and year
        .filter(ee.Filter.eq('version', '3'))
        .filter(ee.Filter.eq('year', ano))
        // Filter the collection by biome
        .filter(ee.Filter.inList('biome', [
            'MATAATLANTICA',
        ])); 

  // Create a mosaic of the image collection
  var mosaicoTotal = collection.mosaic()

  // Import the function to add indices for the Caatinga biome
  var addIndexCaatinga = require('users/marcosrosaUSP/MapBiomas_col9_MataAtlan:Mata_Atlantica_SENTINEL2/processa_Bandas_Sentinel2_CAATINGA');

  // Add the Caatinga indices to the mosaic
  mosaicoTotal = addIndexCaatinga.get(mosaicoTotal);

  // Add bands from the S2 cluster image to the mosaic
  mosaicoTotal = mosaicoTotal.addBands(S2_cluster.select([
    'clusters_'+ano, 'ndvi_median_dry_'+ano,'ndvi_median_wet_'+ano,'ndwi_median_'+ano, 'green_median_texture_'+ano
    ]))
    
  // Add the mosaic layer to the map
  Map.addLayer(mosaicoTotal, {'bands': ['swir1_median', 'nir_median', 'red_median'],
    'gain': [0.08, 0.07, 0.2],'gamma': 0.85}, 'Sentinel 2 '+ano, false);
  //print(mosaicoTotal)
  //var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/REGIONs_'+regiaoID+'_'+ano)

  // Load the training points
  var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/pontos_train_v1_'+ano)
                    // Filter the points by region ID
                    .filterMetadata('reg_id', 'equals', regiaoID)
          
  // Filter the training points by reference class
  var BDflo = BDamostras.filterMetadata("reference", "equals", 3)
  var BDsav = BDamostras.filterMetadata("reference", "equals", 4)//.limit(100)
  var BDreflo = BDamostras.filterMetadata("reference", "equals", 9)
  var BDvarzea = BDamostras.filterMetadata("reference", "equals", 11)
  var BDcampo = BDamostras.filterMetadata("reference", "equals", 12)
  var BDOutroNFlo = BDamostras.filterMetadata("reference", "equals", 13)
  var BDagro = BDamostras.filterMetadata("reference", "equals", 21)
  // BDagro = shuffle(BDagro, 2).limit(1000)
  var BDNaoVeg = BDamostras.filterMetadata("reference", "equals", 22)
  var BDAflora = BDamostras.filterMetadata("reference", "equals", 29)
  var BDagua = BDamostras.filterMetadata("reference", "equals", 33)

  // Complementary samples
  // Merge the varzea and agro training points
  var amostraTotal = varzea.merge(agro)//flo.merge(agua).merge(varzea)
  
  // Reduce the training points to an image
  var amostraTotalimg = amostraTotal.reduceToImage({properties: ['reference'],reducer: ee.Reducer.first()})

  // Rename the band
  amostraTotalimg = amostraTotalimg.select([0],['reference'])
  // var training_flo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': nao_flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_sav = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1500, 'region': sav.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': aflora.filterBounds(limite), 'scale': 10, 'seed': 1});
  // Sample the mosaic using the varzea training points
  var training_var = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 600, 'region': varzea.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_agu = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 100, 'region': agua.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_cam = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 800, 'region': campo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 200, 'region': n_flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // Sample the mosaic using the agro training points
  var training_agr = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 500, 'region': agro.filterBounds(limite), 'scale': 10, 'seed': 1});

// If collecting data, print the size of each training point set
if (coleta) {
// print('BDflo',BDflo.size())
// print('BDsav',BDsav.size())
// print('BDvar',BDvarzea.size())
// print('BDcam',BDcampo.size())
// print('BDOut',BDOutroNFlo.size())
// print('BDAfl',BDAflora.size())
// print('BDagr',BDagro.size())
// print('BDNao',BDNaoVeg.size())
// print('BDagu',BDagua.size())
//print('training_flo',training_flo.size())
//print('training_cam',training_cam.size())
//print('training_sav',training_sav.size())
//print('training_afl',training_afl.size())
//print('training_cam',training_cam.size())
print('training_agr',training_agr.size())
}

  // Merge the training points into a single feature collection
  var training = BDflo.merge(BDreflo).merge(BDcampo)//.merge(BDsav).merge(BDOutroNFlo).merge(BDAflora)
                      .merge(BDagro).merge(BDNaoVeg).merge(BDagua)
                      //complementares
                      // .merge(training_afl)
                      .merge(training_var).merge(training_agr)
                      // .merge(training_sav)
                      // .merge(training_flo)//.merge(training_agu).merge(training_agr)

  // Train a Random Forest classifier
  var classifierRF = ee.Classifier.smileRandomForest({numberOfTrees: RFtrees, variablesPerSplit:1}).train(training, 'reference', bandNames);

  // If collecting data, print the classifier explanation
  if (coleta) {print(classifierRF.explain())}

  // Train a Gradient Tree Boost classifier
  var classifierGTB = ee.Classifier.smileGradientTreeBoost({numberOfTrees: 30, shrinkage: 0.1, samplingRate: 0.8, loss: 'LeastSquares'}).train(training, 'reference', bandNames);

  // print(classifier.explain())

  // Classify the mosaic using the Random Forest classifier
  var classifiedRF = mosaicoTotal.classify(classifierRF).mask(mosaicoTotal.select('blue_median'));

  // Classify the mosaic using the Gradient Tree Boost classifier
  var classifiedGTB = mosaicoTotal.classify(classifierGTB).mask(mosaicoTotal.select('blue_median'));

  // Rename the classification band and clip the image to the region
  classifiedRF = classifiedRF.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()
  //  classifiedGTB = classifiedGTB.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()

  // If collecting data, add the classified layers to the map
  if (coleta) {  
    Map.addLayer(classifiedRF, vis, 'RF'+ano+"_"+regiaoID, false);
    // Map.addLayer(classifiedGTB, vis, 'GTB'+ano+"_"+regiaoID, false);
  }

  // If this is the first year, initialize the classified image
  if (i_ano == 0){ var classified16a23RF = classifiedRF;}//  var classified16a23GTB = classifiedGTB}  
  // Otherwise, add the classified image for the current year to the existing image
  else {classified16a23RF = classified16a23RF.addBands(classifiedRF);}// classified16a23GTB = classified16a23GTB.addBands(classifiedGTB)}
}

// If collecting data, do nothing
if (coleta) {}
   // Otherwise, export the classified image to an asset
   else 
   {
     // Set the metadata for the classified image
     classified16a23RF = classified16a23RF
     .set('territory', 'BRAZIL')
     .set('biome', 'MATA ATÂNTICA')
     .set('source', 'arcplan')
     .set('version', '1')
     .set('collection_id',versao_out)

//     classified16a23GTB = classified16a23GTB
//     .set('territory', 'BRAZIL')
//     .set('biome', 'MATA ATÂNTICA')
//     .set('source', 'arcplan')
//     .set('version', '1')
//     .set('collection_id',versao_out)
     
    // Export the classified image to an asset
    Export.image.toAsset({
       "image": classified16a23RF.toInt8(),
       "description": regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "assetId": dirout + regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "scale": 10,
       "pyramidingPolicy": {
           '.default': 'mode'
       },
       "maxPixels": 1e13,
       "region": limite
     });    
     
//    Export.image.toAsset({
//       "image": classified16a23GTB.toInt8(),
//       "description": regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "assetId": dirout + regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "scale": 10,
//       "pyramidingPolicy": {
//           '.default': 'mode'
//       },
//       "maxPixels": 1e13,
//       "region": limite
//     });    
}
