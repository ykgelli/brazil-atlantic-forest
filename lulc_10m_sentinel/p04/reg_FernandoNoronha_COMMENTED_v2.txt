var limite = 
    /* color: #d6ccca */
    /* shown: false */
    ee.Geometry({
      "type": "GeometryCollection",
      "geometries": [
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -32.39663074204338,
                -3.785031245924777
              ],
              [
                -32.43739744964606,
                -3.8071275947681587
              ],
              [
                -32.4757632558307,
                -3.8319627521753064
              ],
              [
                -32.50331621620784,
                -3.861421741315502
              ],
              [
                -32.506837346047284,
                -3.889852450971306
              ],
              [
                -32.48057341026156,
                -3.9109184787539504
              ],
              [
                -32.442635991066815,
                -3.90321108689405
              ],
              [
                -32.40761564327281,
                -3.8985872916682607
              ],
              [
                -32.37671638706442,
                -3.8720402605800093
              ],
              [
                -32.35491578246739,
                -3.8172315928217264
              ],
              [
                -32.35783527085197,
                -3.794623261419398
              ],
              [
                -32.371739949942274,
                -3.7840037269381845
              ]
            ]
          ],
          "evenOdd": true
        },
        {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -33.80569069106382,
                -3.826065425811596
              ],
              [
                -33.87710182387632,
                -3.8658011782368473
              ],
              [
                -33.8317832203607,
                -3.9466371133541482
              ],
              [
                -33.73427955825132,
                -3.9000546433973797
              ],
              [
                -33.70818702895445,
                -3.812363013911769
              ],
              [
                -33.7658652516107,
                -3.794549552096575
              ]
            ]
          ],
          "geodesic": true,
          "evenOdd": true
        }
      ],
      "coordinates": []
    }),
    forest = 
    /* color: #1e9b25 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.45541826487692, -3.8682683403978184],
                  [-32.45545581580313, -3.8679338280329545],
                  [-32.45563820601614, -3.868383412620808]]]),
            {
              "reference": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.436890749359996, -3.861280423344372],
                  [-32.43626847686854, -3.8613553547133743],
                  [-32.43659034195033, -3.8610556291976703]]]),
            {
              "reference": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40243271539144, -3.8434434798914827],
                  [-32.403065716718956, -3.8427369689921855],
                  [-32.40251854607992, -3.8438716680304528]]]),
            {
              "reference": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.401553109213346, -3.84040294286657],
                  [-32.40138144783639, -3.839439515334943],
                  [-32.40191788963937, -3.840381533377679]]]),
            {
              "reference": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40883088230236, -3.8393217630065086],
                  [-32.408476830712395, -3.8391718963832013],
                  [-32.40918493389233, -3.839064848779009]]]),
            {
              "reference": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.448649083697376, -3.8740026466114723],
                  [-32.45004383238512, -3.871476423068501],
                  [-32.45075193556505, -3.8716048752950045],
                  [-32.449121152484, -3.874066872535456]]]),
            {
              "reference": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.46511662402733, -3.878936104008608],
                  [-32.4639579097329, -3.8776087748979586],
                  [-32.46565306583031, -3.8785721591373132]]]),
            {
              "reference": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40448964695302, -3.837359056588065],
                  [-32.404081951182754, -3.8382796673844317],
                  [-32.40388883213368, -3.8380976862591973],
                  [-32.404285799067885, -3.837112846555742]]]),
            {
              "reference": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39057160856163, -3.8116198725999286],
                  [-32.38748170377647, -3.814103453129434],
                  [-32.388897910136336, -3.8122621785970683]]]),
            {
              "reference": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39490862019007, -3.8192362801462187],
                  [-32.39344949848597, -3.819771530431679],
                  [-32.3932563794369, -3.8195788403673814],
                  [-32.3947691453213, -3.819043589961748]]]),
            {
              "reference": 3,
              "system:index": "9"
            })]),
    urban = 
    /* color: #ea0a0a */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.41399479659565, -3.8456422873617764],
                  [-32.41301847251423, -3.8465200705512625],
                  [-32.41298628600605, -3.846284567833069],
                  [-32.413694389185984, -3.845513831209438]]]),
            {
              "reference": 24,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.41696668418415, -3.848264929571997],
                  [-32.41609764846333, -3.847922380843706],
                  [-32.416923768839915, -3.84795449479284]]]),
            {
              "reference": 24,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.406956680140574, -3.8474727854287996],
                  [-32.40684939177998, -3.8477939250350963],
                  [-32.40622711928852, -3.847151645701463]]]),
            {
              "reference": 24,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39871352497906, -3.8324234861022544],
                  [-32.398557956856195, -3.832439543368523],
                  [-32.398557956856195, -3.8321772746482994],
                  [-32.39874571148724, -3.8321612173771076]]]),
            {
              "reference": 24,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.399561103027764, -3.8336920092090003],
                  [-32.39934652630657, -3.834248660104806],
                  [-32.39893883053631, -3.8339007533373954],
                  [-32.3994591790852, -3.833590313333121]]]),
            {
              "reference": 24,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.42756672343386, -3.858731688915914],
                  [-32.42733068904055, -3.859716503622652],
                  [-32.42688007792605, -3.859909184627368]]]),
            {
              "reference": 24,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.43921972144634, -3.855918397730824],
                  [-32.438887127528496, -3.8562930568746916],
                  [-32.438930042872734, -3.855725715821113]]]),
            {
              "reference": 24,
              "system:index": "6"
            })]),
    agua = 
    /* color: #133cff */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.42661066550616, -3.8436657995016694],
                  [-32.429228501504696, -3.839244745554157],
                  [-32.43055887717608, -3.838645278849001],
                  [-32.42734022635821, -3.8439548264437136]]]),
            {
              "reference": 33,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.443240361398495, -3.8540921167910103],
                  [-32.44618006247882, -3.851747812223009],
                  [-32.44383044738177, -3.85460593610708]]]),
            {
              "reference": 33,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40872569579486, -3.8573784141417713],
                  [-32.40433760184649, -3.8601401786347553],
                  [-32.40832872886065, -3.8570465736178976]]]),
            {
              "reference": 33,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39385552901629, -3.852465020242415],
                  [-32.394295411294735, -3.85255065698046],
                  [-32.39323325652484, -3.854830731960225],
                  [-32.393040137475765, -3.854509595008966]]]),
            {
              "reference": 33,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39620880291436, -3.8384643977512223],
                  [-32.396085421299674, -3.838089730767441],
                  [-32.39917532608483, -3.836869385737915],
                  [-32.3994757334945, -3.837276167608141]]]),
            {
              "reference": 33,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.42994894810893, -3.8647692946880645],
                  [-32.43042101689555, -3.8653045164064426],
                  [-32.42891897984721, -3.8666318648101967],
                  [-32.42842545338847, -3.8666104559814745]]]),
            {
              "reference": 33,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.425078056537885, -3.866203688132814],
                  [-32.42488493748881, -3.8698003654997],
                  [-32.422331474506635, -3.8721981419272042],
                  [-32.42136587926127, -3.87305448900554],
                  [-32.42097964116313, -3.8727547676266694],
                  [-32.424605987751264, -3.8695648692344444],
                  [-32.42473473378398, -3.866011008557439]]]),
            {
              "reference": 33,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.38798852093165, -3.8186367994302235],
                  [-32.38747353680079, -3.818529749258306],
                  [-32.388578606914926, -3.8158749007249693],
                  [-32.38891120083277, -3.8159819512278426]]]),
            {
              "reference": 33,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.38767738468592, -3.821944643160922],
                  [-32.387140942882944, -3.821784068517071],
                  [-32.391293002438, -3.8204352403219928],
                  [-32.39151830799525, -3.8207885050542623]]]),
            {
              "reference": 33,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39714729912628, -3.855306352208967],
                  [-32.39636409409393, -3.854514214619531],
                  [-32.39744770653595, -3.8547283059326904],
                  [-32.39746916420807, -3.8552314203064455]]]),
            {
              "reference": 33,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.42741625797649, -3.8445041172119643],
                  [-32.42615025532146, -3.8439581777019836],
                  [-32.42636483204265, -3.8435299896064605],
                  [-32.42763083469768, -3.8441294528800016]]]),
            {
              "reference": 33,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.391548642252715, -3.8509872846913598],
                  [-32.390776166056426, -3.8509765800799],
                  [-32.390792259310516, -3.85026472311645],
                  [-32.39115167531851, -3.850275427736854],
                  [-32.39115167531851, -3.8507036124424783],
                  [-32.3914735404003, -3.8507196693647505]]]),
            {
              "reference": 33,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.37793181662478, -3.806191324953424],
                  [-32.37794790987887, -3.8057256498683203],
                  [-32.378575546788355, -3.805838054222259],
                  [-32.37827513937869, -3.806185972367672]]]),
            {
              "reference": 33,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.43557065725171, -3.870445098292274],
                  [-32.435205876825684, -3.87001692354176],
                  [-32.43610709905469, -3.870231010944071]]]),
            {
              "reference": 33,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.41831868886792, -3.8681810317054195],
                  [-32.41810411214673, -3.8685235722655],
                  [-32.41788953542554, -3.868073987752008]]]),
            {
              "reference": 33,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39285288769363, -3.8520581456934972],
                  [-32.39224134403823, -3.8520902594866193],
                  [-32.39206968266128, -3.8516941892866496],
                  [-32.392917260709986, -3.851822644506843]]]),
            {
              "reference": 33,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39126501995681, -3.8513516419380314],
                  [-32.39131866413711, -3.8518761675095385],
                  [-32.390953883711084, -3.8518868721096626],
                  [-32.390943154875025, -3.8513730511513584]]]),
            {
              "reference": 33,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40030166734443, -3.856422200200639],
                  [-32.40103122819648, -3.85700024532511],
                  [-32.40026948083625, -3.856732631890435]]]),
            {
              "reference": 33,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39680421820231, -3.8416427040158747],
                  [-32.39638579359599, -3.841953141093403],
                  [-32.396257047563275, -3.84177116075131],
                  [-32.39663255682536, -3.8415249519913997]]]),
            {
              "reference": 33,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.44461948572022, -3.8729214800536615],
                  [-32.44512374101502, -3.8737724742381126],
                  [-32.444667765482485, -3.8734245836371817],
                  [-32.44406255568435, -3.872585260667683],
                  [-32.44397672499587, -3.872349765176944],
                  [-32.44442733611037, -3.8726066693454047]]]),
            {
              "reference": 33,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.42799133359828, -3.850459579996993],
                  [-32.428055706614636, -3.8510804476155904],
                  [-32.42724031507411, -3.850951992283377],
                  [-32.42786258756556, -3.8508449461583973]]]),
            {
              "reference": 33,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.472216957834135, -3.8770895103727363],
                  [-32.47183071973599, -3.8770895103727363],
                  [-32.47184144857205, -3.8769075375591306],
                  [-32.472195500162016, -3.8769075375591306]]]),
            {
              "reference": 33,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.472699755456816, -3.8750235814227008],
                  [-32.47190582158841, -3.8750771029617814],
                  [-32.47191655042447, -3.874916538334413],
                  [-32.472474449899565, -3.874830903854027]]]),
            {
              "reference": 33,
              "system:index": "22"
            })]),
    beach = 
    /* color: #fff213 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.44335624129219, -3.8543332053529182],
                  [-32.443806852406695, -3.8546971606306952],
                  [-32.44339915663643, -3.85520027502286],
                  [-32.44292708784981, -3.8548470245233184]]]),
            {
              "reference": 23,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.42673139079904, -3.8450241479291463],
                  [-32.426114482725616, -3.8446869502434526],
                  [-32.426409525717254, -3.8438787457237726],
                  [-32.42708544238901, -3.844242705469834]]]),
            {
              "reference": 23,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40143150687269, -3.8354467723726398],
                  [-32.40113646388105, -3.835141685334957],
                  [-32.40149051547102, -3.8348901222570495],
                  [-32.401817744970835, -3.835259438239606]]]),
            {
              "reference": 23,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.43652549895006, -3.869538932955444],
                  [-32.4374696365233, -3.869785133602383],
                  [-32.43698683890062, -3.8705772569374255],
                  [-32.43631092222887, -3.870320352153184]]]),
            {
              "reference": 23,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40136212813349, -3.8367115679486345],
                  [-32.40090615260096, -3.837257512093994],
                  [-32.40080154644938, -3.837104968912043],
                  [-32.40124947535487, -3.8366152248279426]]]),
            {
              "reference": 23,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40863725747675, -3.8566614421101844],
                  [-32.40854069795221, -3.8564045331121015],
                  [-32.4089162072143, -3.8565008739954774],
                  [-32.40904495324701, -3.856886237419798]]]),
            {
              "reference": 23,
              "system:index": "5"
            })]),
    grassland = 
    /* color: #befa94 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.45792830386742, -3.868959676138542],
                  [-32.457027081638415, -3.868488683075161],
                  [-32.45767081180199, -3.8682317776575057]]]),
            {
              "reference": 12,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.4527044071275, -3.865460379111305],
                  [-32.452275253685116, -3.866338141836785],
                  [-32.45223233834088, -3.865267699367018]]]),
            {
              "reference": 12,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.399761247452396, -3.8557135597843253],
                  [-32.39936428051819, -3.8552425593699957],
                  [-32.39985780697693, -3.8548893088880236],
                  [-32.40016894322266, -3.8552853776002696]]]),
            {
              "reference": 12,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39709395921789, -3.8521877139701375],
                  [-32.39787716425024, -3.8515026195322952],
                  [-32.39790935075842, -3.851941508220024],
                  [-32.39720124757849, -3.8527015344365245]]]),
            {
              "reference": 12,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40005021257313, -3.8415385685545456],
                  [-32.39919190568836, -3.8407999418603493],
                  [-32.39929919404896, -3.840478799620006],
                  [-32.40021114511402, -3.8413030644606097]]]),
            {
              "reference": 12,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39863842312664, -3.831133551393547],
                  [-32.39885299984783, -3.830876634704769],
                  [-32.399013932388726, -3.831165665974212]]]),
            {
              "reference": 12,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.38999225141441, -3.8143817849830057],
                  [-32.38954164029991, -3.81590190351558],
                  [-32.38909102918541, -3.8155593418275076]]]),
            {
              "reference": 12,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.393825007748056, -3.822094512801393],
                  [-32.39326710827296, -3.8208420300010024],
                  [-32.393610431026865, -3.820949079884481],
                  [-32.394114686321664, -3.822094512801393]]]),
            {
              "reference": 12,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.43648961967263, -3.86810106931903],
                  [-32.43613556808266, -3.8684757230848597],
                  [-32.434837378919454, -3.8658103255487384],
                  [-32.43560985511574, -3.8660565272788854]]]),
            {
              "reference": 12,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.407314136866155, -3.845815446760411],
                  [-32.40667040670258, -3.8453123268220457],
                  [-32.40673477971894, -3.8451089378265055],
                  [-32.40737850988251, -3.845258803406871]]]),
            {
              "reference": 12,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40769245913005, -3.855490840954261],
                  [-32.40814307024455, -3.855084067777967],
                  [-32.40844347765422, -3.855983250328325]]]),
            {
              "reference": 12,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39829399874186, -3.8555871819411958],
                  [-32.39865877925015, -3.8550412495645117],
                  [-32.39891627123332, -3.8551375905754273],
                  [-32.39856221964335, -3.855801272984185]]]),
            {
              "reference": 12,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.408107642072835, -3.8469961625708278],
                  [-32.40775359048287, -3.847028276554872],
                  [-32.40772140397469, -3.846824887968834],
                  [-32.40805399789254, -3.846792773977132]]]),
            {
              "reference": 12,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.404095057386556, -3.846889115948626],
                  [-32.403601530927816, -3.846567976001297],
                  [-32.40379464997689, -3.84632176862639],
                  [-32.40430963410775, -3.8467392506549305]]]),
            {
              "reference": 12,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40418088807503, -3.8538792321287856],
                  [-32.403365496534505, -3.853900641278514],
                  [-32.40381610764901, -3.853215548220002]]]),
            {
              "reference": 12,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40227115525643, -3.84869820205688],
                  [-32.4030221737806, -3.849040750473146],
                  [-32.40250718964974, -3.849468935799704]]]),
            {
              "reference": 12,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.387889537545846, -3.8090191025231],
                  [-32.38848498794715, -3.809441955303588],
                  [-32.38734236690681, -3.809356314250904]]]),
            {
              "reference": 12,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.391639265748665, -3.817588930651962],
                  [-32.39172509643714, -3.817861908863112],
                  [-32.3916043970437, -3.8183998362836586],
                  [-32.39141530126491, -3.8184761095171416],
                  [-32.39131203624885, -3.8179636066058618],
                  [-32.39146223995368, -3.817567520592518]]]),
            {
              "reference": 12,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39268532726447, -3.81857379280937],
                  [-32.392363462182686, -3.8187290155463263],
                  [-32.392122063371346, -3.8182472897193276],
                  [-32.39256731006782, -3.8183168723554894]]]),
            {
              "reference": 12,
              "system:index": "18"
            })]),
    aflora = 
    /* color: #815d3d */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39119107849543, -3.8201087379401084],
                  [-32.39069218761866, -3.819257690164061],
                  [-32.39101941711848, -3.8192898051897872],
                  [-32.39130909569209, -3.819867875447612]]]),
            {
              "reference": 29,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.3843778263645, -3.8144637838637623],
                  [-32.38368045202063, -3.8141319266750546],
                  [-32.38386284223364, -3.813928530270259],
                  [-32.38467823377417, -3.8143353230317216]]]),
            {
              "reference": 29,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39534640546265, -3.8526276099970764],
                  [-32.39469194646301, -3.8524349273418053],
                  [-32.3950674557251, -3.852124494083182],
                  [-32.39548588033142, -3.852295767619194]]]),
            {
              "reference": 29,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39417696233215, -3.85064725840441],
                  [-32.39318990941467, -3.8507435999398756],
                  [-32.39345813031616, -3.8503689383518283],
                  [-32.393887283758545, -3.8504866891544105]]]),
            {
              "reference": 29,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.39906583320107, -3.8560057248059003],
                  [-32.39859376441445, -3.856112770281424],
                  [-32.39877615462746, -3.855609656429228],
                  [-32.39911947738137, -3.855631065535383]]]),
            {
              "reference": 29,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.40925433964889, -3.8587149533666656],
                  [-32.40931871266525, -3.8592287698879946],
                  [-32.40899684758346, -3.859421451003368],
                  [-32.40899684758346, -3.858757771421984]]]),
            {
              "reference": 29,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.44357210861278, -3.8513772110408735],
                  [-32.443110768662216, -3.8515056663089022],
                  [-32.443132226334335, -3.851248755753455],
                  [-32.443368260727645, -3.8510988912269606]]]),
            {
              "reference": 29,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.42190485241708, -3.844310475670651],
                  [-32.42137913945016, -3.844963461832566],
                  [-32.421003630188075, -3.844770777443358],
                  [-32.42164736035165, -3.8441070864361113]]]),
            {
              "reference": 29,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.41063889763769, -3.8377378749900055],
                  [-32.41007026932653, -3.8374274363796155],
                  [-32.41018828652319, -3.8372026359361406],
                  [-32.410488693932855, -3.8374595507238505],
                  [-32.4109285762113, -3.8375344841890424]]]),
            {
              "reference": 29,
              "system:index": "8"
            })]),
    agricultura = 
    /* color: #e717ff */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.43834541161885, -3.856485288121508],
                  [-32.437170604070324, -3.8557306175622603],
                  [-32.4373100789391, -3.8555807538253823],
                  [-32.438399055799145, -3.8563675381492795]]]),
            {
              "reference": 19,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.438672641118664, -3.858444217084021],
                  [-32.43849025090565, -3.85835322868032],
                  [-32.4385170729958, -3.85813378601951],
                  [-32.43875310738911, -3.8582033654059074]]]),
            {
              "reference": 19,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.43750847209484, -3.8575668967284957],
                  [-32.437669404635734, -3.8572618176096567],
                  [-32.437900074611015, -3.8573581583958596],
                  [-32.43770159114391, -3.8577007033249915]]]),
            {
              "reference": 19,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-32.431548837119685, -3.8570835257967757],
                  [-32.432766560012446, -3.8586999089919023],
                  [-32.43258416979943, -3.8587855451019024],
                  [-32.43100166648065, -3.8567035147316373],
                  [-32.43120551436578, -3.856494776186947]]]),
            {
              "reference": 19,
              "system:index": "3"
            })]);

// Define variables for year, number of trees in random forest, output version, and output directory.
var ano = '2023';
var RFtrees = 100;
var versao_out = 20;
var dirout = 'projects/mapbiomas-workspace/COLECAO7/classificacao-ma/';

// Load the Harmonized Sentinel-2 Level 2A collection.
var s2 = ee.ImageCollection('COPERNICUS/S2_SR_HARMONIZED');

// Load the Cloud Score+ image collection.
var csPlus = ee.ImageCollection('GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED');

// Define the region of interest.
var ROI = limite;

// Define the QA band to use for cloud masking.
var QA_BAND = 'cs_cdf';

// Define the threshold for cloud masking.
var CLEAR_THRESHOLD = 0.60;

// Create a clear median composite.
var composite = s2
    // Filter the collection by bounds and date.
    .filterBounds(ROI)
    .filterDate(ano+'-01-01', ano+'-12-31')
    // Link the Sentinel-2 collection with the Cloud Score+ collection.
    .linkCollection(csPlus, [QA_BAND])
    // Map over the collection and mask out cloudy pixels.
    .map(function(img) {
      return img.updateMask(img.select(QA_BAND).gte(CLEAR_THRESHOLD));
    });

// Print the size of the composite.
print('composite', composite.size());

// Calculate the median composite and clip it to the region of interest.
var mosaicoTotal = composite.median().clip(limite);

// Print the median composite.
print('mosaicoTotal',mosaicoTotal);

// Define visualization parameters for Sentinel-2.
var s2Viz = {bands: ['B4', 'B3', 'B2'], min: 0, max: 2500};
var palettes = require('users/mapbiomas/modules:Palettes.js');
var vis = {
    'min': 0,
    'max': 62,
    'palette': palettes.get('classification7')
};

// Add the median composite to the map.
Map.addLayer(mosaicoTotal, s2Viz, 'median composite');

// Define the band names for the Sentinel-2 image.
var bandNames = ee.List(['B2', 'B3', 'B4', 'B5', 'B6', 'B7', 'B8', 'B8A', 'B11', 'B12']);

// Merge the training samples for different classes.
var amostraTotal = forest.merge(urban).merge(agua).merge(beach).merge(grassland).merge(aflora).merge(agricultura);

// Reduce the training samples to an image.
var amostraTotalimg = amostraTotal.reduceToImage({properties: ['reference'],reducer: ee.Reducer.first()});

// Select the reference band.
amostraTotalimg = amostraTotalimg.select([0],['reference']);

// Sample the training data for each class.
var train_flo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 35, 'region': forest, 'scale': 10, 'seed': 1});
var train_urb = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 10, 'region': urban, 'scale': 10, 'seed': 1});
var train_agu = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 55, 'region': agua, 'scale': 10, 'seed': 1});
var train_bea = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 30, 'region': beach, 'scale': 10, 'seed': 1});
var train_gra = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 30, 'region': grassland, 'scale': 10, 'seed': 1});
var train_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 10, 'region': aflora, 'scale': 10, 'seed': 1});
var train_agr = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 10, 'region': agricultura, 'scale': 10, 'seed': 1});

// Merge the training samples for all classes.
var training = train_flo.merge(train_urb).merge(train_agu).merge(train_bea)
                        .merge(train_gra).merge(train_afl).merge(train_agr);

// Train a random forest classifier.
var classifierRF = ee.Classifier.smileRandomForest({numberOfTrees: RFtrees, variablesPerSplit:1}).train(training, 'reference', bandNames);

// Classify the image using the random forest classifier.
var classifiedRF = mosaicoTotal.classify(classifierRF).mask(mosaicoTotal.select('B2'));

// Select the classification band and clip the image to the region of interest.
classifiedRF = classifiedRF.select(['classification'],['classification_'+ano]).clip(limite).toInt8();

// Add the classified image to the map.
Map.addLayer(classifiedRF, vis, 'RF'+ano, true);

// Define the years for which the classification is performed.
var years = [2023];

// Get the band names list.
var bandNames = ee.List(
    years.map(
        function (year) {
            return 'classification_' + String(year);
        }
    )
);

// Generate a histogram dictionary of band names and their occurrences.
var bandsOccurrence = ee.Dictionary(
    bandNames.cat(classifiedRF.bandNames()).reduce(ee.Reducer.frequencyHistogram())
);

// Print the histogram dictionary.
print(bandsOccurrence);

// Create a dictionary of images, where each image is masked based on its occurrence in the histogram.
var bandsDictionary = bandsOccurrence.map(
    function (key, value) {
        return ee.Image(
            ee.Algorithms.If(
                ee.Number(value).eq(2),
                classifiedRF.select([key]).byte(),
                ee.Image().rename([key]).byte().updateMask(classifiedRF.select(0))
            )
        );
    }
);

// Convert the dictionary to an image.
var imageAllBands = ee.Image(
    bandNames.iterate(
        function (band, classifiedRF) {
            return ee.Image(classifiedRF).addBands(bandsDictionary.get(ee.String(band)));
        },
        ee.Image().select()
    )
);

// Generate an image of pixel years.
var imagePixelYear = ee.Image.constant(years)
    .updateMask(imageAllBands)
    .rename(bandNames);

// Add connected pixels bands to the classified image.
var imageConnected = classifiedRF.addBands(
    classifiedRF
        .connectedPixelCount(100, true)
        .rename(bandNames.map(
            function (band) {
                return ee.String(band).cat('_conn')
            }
        ))
);

// Print the image with connected pixels bands.
print(imageConnected);

// Set metadata for the image.
imageConnected = imageConnected
 .set('territory', 'BRAZIL')
 .set('biome', 'MATA ATÂNTICA')
 .set('source', 'arcplan')
 .set('version', '1')
 .set('collection_id',versao_out);

// Export the image to an asset.
Export.image.toAsset({
   "image": imageConnected.toInt8(),
   "description": 'FNoronha'+'-'+'RF_SENTINEL2_v'+versao_out,
   "assetId": dirout + 'FNoronha'+'-'+'RF_SENTINEL2_v'+versao_out,
   "scale": 10,
   "pyramidingPolicy": {
       '.default': 'mode'
   },
   "maxPixels": 1e13,
   "region": limite
 });
