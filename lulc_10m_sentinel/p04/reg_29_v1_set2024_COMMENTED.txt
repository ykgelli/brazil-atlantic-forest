var varzea = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.78050623718306, -21.58622328698546],
                  [-51.77672968689009, -21.595481061321713],
                  [-51.77363978210494, -21.593884935568017],
                  [-51.77535639587447, -21.58750025656997]]]),
            {
              "reference": 11,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.864963634644, -21.56866381355524],
                  [-51.863590343628374, -21.5718566033745],
                  [-51.859813793335405, -21.57313369960753],
                  [-51.85638056579634, -21.5718566033745]]]),
            {
              "reference": 11,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.733471019897905, -21.60824943364857],
                  [-51.74377070251509, -21.60505744619858],
                  [-51.747203930054155, -21.610483782955164]]]),
            {
              "reference": 11,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.70085535827681, -21.60617464981754],
                  [-51.69931040588423, -21.610324187720753],
                  [-51.702743633423296, -21.61606950520767],
                  [-51.69742213073775, -21.61192013214014],
                  [-51.69707880798384, -21.60649384926688]]]),
            {
              "reference": 11,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.95991681969885, -21.60120913645946],
                  [-51.97038816369299, -21.610944736965152],
                  [-51.969701518185175, -21.614615367050842],
                  [-51.96455167687658, -21.609987165968946],
                  [-51.95905851281408, -21.607274013719746]]]),
            {
              "reference": 11,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-52.005006002729736, -21.56814248710452],
                  [-52.002259420698486, -21.576603256777638],
                  [-51.999512838667236, -21.566386416408832]]]),
            {
              "reference": 11,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.939603018110596, -21.26088090676821],
                  [-51.96397893363794, -21.302789157549725],
                  [-51.92930333549341, -21.26727988515005]]]),
            {
              "reference": 11,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.808078987722034, -21.149297503376584],
                  [-51.804302437429065, -21.138090159351794],
                  [-51.81563208830797, -21.149297503376584]]]),
            {
              "reference": 11,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.7455942465111, -21.048400922650846],
                  [-51.74834082854235, -21.022765488487128],
                  [-51.75280402434313, -21.051605041705454]]]),
            {
              "reference": 11,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.63133190557086, -20.88753700973058],
                  [-51.62343548223102, -20.91768544792734],
                  [-51.61965893193805, -20.902291257744746]]]),
            {
              "reference": 11,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.45881222173297, -20.971232078348606],
                  [-51.453662380424376, -20.97347612947226],
                  [-51.456408962455626, -20.96962916406339]]]),
            {
              "reference": 11,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.45606563970172, -20.97604071807355],
                  [-51.45846889897906, -20.97347612947226],
                  [-51.45726726934039, -20.978124413907366]]]),
            {
              "reference": 11,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.424222454276915, -20.95383954013201],
                  [-51.41984508916461, -20.953037991927317],
                  [-51.41855762883746, -20.952316594871792],
                  [-51.42542408391559, -20.953037991927317]]]),
            {
              "reference": 11,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.92122764220934, -20.661808091197173],
                  [-50.91873855224352, -20.65803347381692],
                  [-50.91723651519518, -20.657993317808824],
                  [-50.918566890866565, -20.65690910157944],
                  [-50.917279430539416, -20.6533351488684],
                  [-50.91951102843981, -20.655302841095672],
                  [-50.921313472897815, -20.65441939059362],
                  [-50.92024058929186, -20.657350820236267],
                  [-50.92122764220934, -20.66024203792061]]]),
            {
              "reference": 11,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.91465032946907, -20.711918301562903],
                  [-50.9143499220594, -20.709710489435135],
                  [-50.91263330828987, -20.70826535862578],
                  [-50.912976631043776, -20.707141358469837],
                  [-50.91456449878059, -20.70894778322512],
                  [-50.91563738238655, -20.70754278805383],
                  [-50.91555155169807, -20.711958443303857]]]),
            {
              "reference": 11,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.00295280913133, -21.104649398381213],
                  [-50.00192284086961, -21.10160657280753],
                  [-50.00346779326219, -21.09904414500786],
                  [-50.00501274565477, -21.10512983882333]]]),
            {
              "reference": 11,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.94733452299852, -21.11746061129348],
                  [-49.94767784575242, -21.112656536060676],
                  [-49.95008110502977, -21.109293590851173],
                  [-49.949394459521955, -21.11665994289044]]]),
            {
              "reference": 11,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.90786700121571, -21.40405843750656],
                  [-49.900313900629776, -21.40262003345252],
                  [-49.90615038744618, -21.401661089553244]]]),
            {
              "reference": 11,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.87044482103993, -21.394229061069268],
                  [-49.867612408320205, -21.39718593485463],
                  [-49.86649660937001, -21.395827378647965],
                  [-49.86932902208974, -21.391991387112615],
                  [-49.86932902208974, -21.393509812459754]]]),
            {
              "reference": 11,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.717177875252695, -21.903700101027045],
                  [-48.71477461597535, -21.906885455698742],
                  [-48.69589186451051, -21.908796634320215],
                  [-48.703444965096445, -21.90147031038972],
                  [-48.72026778003785, -21.89478072916508]]]),
            {
              "reference": 11,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.611777789803476, -21.850885850489586],
                  [-48.595298297615976, -21.86108250898515],
                  [-48.596328265877695, -21.853753734257975],
                  [-48.60868788501832, -21.847380581043538]]]),
            {
              "reference": 11,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-48.27336039921567, -21.865866317782093],
                  [-48.26906886479184, -21.86108688484831],
                  [-48.27233043095395, -21.859493704988704],
                  [-48.275935319869966, -21.863157992094283]]]),
            {
              "reference": 11,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.85820110587952, -22.28001838042572],
                  [-47.85785778312562, -22.29081945592615],
                  [-47.85648449210999, -22.29701381380641],
                  [-47.85373791007874, -22.29256661030775],
                  [-47.855626185225226, -22.28367177876464]]]),
            {
              "reference": 11,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.86991279898547, -22.233868933010466],
                  [-47.87592094717883, -22.21956739698714],
                  [-47.88038414297961, -22.21909065399911],
                  [-47.87557762442492, -22.23243884505619]]]),
            {
              "reference": 11,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.162309239600695, -23.516953356865425],
                  [-49.15801770517687, -23.528443313430586],
                  [-49.157331059669055, -23.53332230662615],
                  [-49.1516662342296, -23.52466590413326],
                  [-49.1542411548839, -23.51490709501682],
                  [-49.15836102793077, -23.516953356865425]]]),
            {
              "reference": 11,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.16848904917101, -23.519314388712516],
                  [-49.16986234018663, -23.53017458978897],
                  [-49.16402585337023, -23.529387648813454],
                  [-49.16574246713976, -23.517897774685142]]]),
            {
              "reference": 11,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.796162698072614, -22.435950375486776],
                  [-49.79702100495738, -22.442614261757253],
                  [-49.79581937531871, -22.443248900898435],
                  [-49.79358777741832, -22.437219711833848]]]),
            {
              "reference": 11,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.924222085279645, -22.452926787990304],
                  [-49.92061719636363, -22.459907139672445],
                  [-49.92233381013316, -22.45356137994012],
                  [-49.923192117017926, -22.45118164515178]]]),
            {
              "reference": 11,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.74091476760391, -22.727212481587063],
                  [-51.73889774642471, -22.725391643672644],
                  [-51.73997063003067, -22.725708312877043],
                  [-51.74091476760391, -22.72653956605083]]]),
            {
              "reference": 11,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.75340313277725, -22.735405952239123],
                  [-51.75194401107315, -22.73394145486799],
                  [-51.753832286219634, -22.7349705627672],
                  [-51.75460476241592, -22.735880920990958]]]),
            {
              "reference": 11,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.71687006037192, -22.70501945811347],
                  [-51.71534656565146, -22.707335429464507],
                  [-51.714960327553314, -22.70696923147352],
                  [-51.71638726274924, -22.70514812421617]]]),
            {
              "reference": 11,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.40822248675257, -22.661120366567662],
                  [-51.40667753435999, -22.66373409140914],
                  [-51.39903860308558, -22.665001334017226],
                  [-51.40676336504847, -22.661199571082182]]]),
            {
              "reference": 11,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.41320066668421, -22.652486800458604],
                  [-51.410883238095344, -22.65090260093024],
                  [-51.41345815874964, -22.651773912932935],
                  [-51.41568975665003, -22.6533581024074]]]),
            {
              "reference": 11,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.50776831468549, -22.64967483372316],
                  [-51.504420917834906, -22.650783785228732],
                  [-51.50437800249067, -22.650110494311367],
                  [-51.50678126176801, -22.649278777443474]]]),
            {
              "reference": 11,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.2899482090298, -22.308584628790467],
                  [-51.28582833598293, -22.307195008014173],
                  [-51.288403256637224, -22.306877378466623]]]),
            {
              "reference": 11,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.3055264789883, -22.326172062052226],
                  [-51.30196450541652, -22.327045420837262],
                  [-51.30192159007228, -22.326092665527952],
                  [-51.3049685795132, -22.325695682228837]]]),
            {
              "reference": 11,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.447574113786544, -21.884664601169803],
                  [-49.44714496034416, -21.88653625555962],
                  [-49.44690892595085, -21.885082738855516],
                  [-49.447810148179855, -21.883927879407832]]]),
            {
              "reference": 11,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.44446275132927, -21.888248598699402],
                  [-49.44469878572258, -21.888606993498858],
                  [-49.44444129365715, -21.88984145758052],
                  [-49.44386193650993, -21.88910476255944],
                  [-49.44411942857536, -21.888646815087633]]]),
            {
              "reference": 11,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.39864488007983, -21.795928483660678],
                  [-49.398451761030756, -21.79708405421869],
                  [-49.39885945680102, -21.798817392579956],
                  [-49.39819426896533, -21.79710397776728],
                  [-49.398215726637446, -21.79578901761821]]]),
            {
              "reference": 11,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.2445185571485, -22.222619379344696],
                  [-50.24301652010016, -22.22381120378941],
                  [-50.24108532960944, -22.224168749147655],
                  [-50.24164322908454, -22.222937200187]]]),
            {
              "reference": 11,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.37877781413896, -22.379748091406068],
                  [-50.378552508581706, -22.381375084453726],
                  [-50.37862761043412, -22.383061581555722],
                  [-50.37811262630326, -22.38302189950582],
                  [-50.37749035381181, -22.380025872053622]]]),
            {
              "reference": 11,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.07465383194917, -22.348741195226612],
                  [-50.07362386368745, -22.350249476455133],
                  [-50.07147809647554, -22.35167835940268],
                  [-50.07225057267183, -22.350090710778765],
                  [-50.074568001260694, -22.34770920392799]]]),
            {
              "reference": 11,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.52792988022176, -22.309114908331438],
                  [-49.527586557467856, -22.31189409784355],
                  [-49.53024730881063, -22.31213231151343],
                  [-49.52827320297567, -22.312449929107718],
                  [-49.52647075851766, -22.311417669284456],
                  [-49.526912400374684, -22.30895609583139]]]),
            {
              "reference": 11,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.242877462162156, -22.013342903768127],
                  [-50.2427058007852, -22.014456926132222],
                  [-50.241117933048386, -22.017043015714147],
                  [-50.2403454568521, -22.015889227731922],
                  [-50.24193332458891, -22.01409884847025],
                  [-50.24249122406401, -22.01202993759644]]]),
            {
              "reference": 11,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.27248904968657, -22.02277203067294],
                  [-50.270128705753464, -22.02058389258258],
                  [-50.27154491211333, -22.020623677213166],
                  [-50.273390271915574, -22.022692462607314]]]),
            {
              "reference": 11,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.79923348465405, -22.102599603666782],
                  [-49.79747395554028, -22.104070773810086],
                  [-49.79764561691724, -22.09997531613345]]]),
            {
              "reference": 11,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.6289545472702, -21.895277703332862],
                  [-51.62710918746795, -21.89535734277338],
                  [-51.627752917631526, -21.89472022600356]]]),
            {
              "reference": 11,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.57801403365936, -21.90121071983675],
                  [-51.57745613418426, -21.902046896937332],
                  [-51.57698406539764, -21.901051447451813]]]),
            {
              "reference": 11,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.570589679106135, -21.89245047437212],
                  [-51.56818641982879, -21.892131909848075],
                  [-51.56895889602508, -21.891136391123037]]]),
            {
              "reference": 11,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.60234703384246, -21.891892985987944],
                  [-51.60084499679412, -21.89245047437212],
                  [-51.60088791213836, -21.891773523907762]]]),
            {
              "reference": 11,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.59899963699188, -21.891813344612277],
                  [-51.59775509200897, -21.89149477866475],
                  [-51.597540515287776, -21.890539076551836]]]),
            {
              "reference": 11,
              "system:index": "50"
            })]),
    agro = /* color: #d63000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.66269780046323, -22.39397889919722],
                  [-51.66115284807065, -22.400327383003784],
                  [-51.6584062660394, -22.400327383003784],
                  [-51.6584062660394, -22.3962009015041]]]),
            {
              "reference": 21,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.19743160689461, -22.17709827874508],
                  [-51.20000652754891, -22.173601068331887],
                  [-51.20172314131844, -22.175985539414857],
                  [-51.19863323653328, -22.178528930654437]]]),
            {
              "reference": 21,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.15464021873731, -21.983342501899088],
                  [-51.15300943565626, -21.983262911703868],
                  [-51.152837774279305, -21.977293519870074],
                  [-51.154125234606454, -21.979044567491595]]]),
            {
              "reference": 21,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.8245141545689, -21.95132544270168],
                  [-50.82863402761578, -21.948141082454317],
                  [-50.82932067312359, -21.94989248941667],
                  [-50.82726073660015, -21.95339523861348]]]),
            {
              "reference": 21,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.7996232549107, -21.954987368806737],
                  [-50.79756331838726, -21.95196230619208],
                  [-50.79893660940289, -21.949733271493454],
                  [-50.80236983694195, -21.954987368806737]]]),
            {
              "reference": 21,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.65601268997615, -21.80910572182158],
                  [-50.652922785190995, -21.81101820931425],
                  [-50.65154949417537, -21.810061968761186],
                  [-50.6558410285992, -21.807830715967906]]]),
            {
              "reference": 21,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.71188846817439, -21.79515972840174],
                  [-50.7151500343365, -21.794043990274773],
                  [-50.715064203648026, -21.795080033109365],
                  [-50.71248928299373, -21.79635515246814]]]),
            {
              "reference": 21,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.95733662360761, -21.470491270837737],
                  [-49.96403141730878, -21.475283666259454],
                  [-49.96300144904706, -21.477679804836686]]]),
            {
              "reference": 21,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.975189406810735, -21.48327064151633],
                  [-49.9789659571037, -21.48614584535136],
                  [-49.97553272956464, -21.486784771824485]]]),
            {
              "reference": 21,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.991153914867375, -21.45515454611215],
                  [-49.9951021265373, -21.453876412870727],
                  [-49.99269886725995, -21.45898887860216]]]),
            {
              "reference": 21,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.425065015733566, -21.88163804423433],
                  [-49.429099058091964, -21.88213583761613],
                  [-49.4291419734362, -21.886257500079424],
                  [-49.42377755540642, -21.886436700093512],
                  [-49.42429253953728, -21.8822553077693]]]),
            {
              "reference": 21,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.6947196138774, -21.986659886637113],
                  [-49.691458047715294, -21.99509599696761],
                  [-49.6892264498149, -21.989047515925275]]]),
            {
              "reference": 21,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.65437919029342, -21.992708469467185],
                  [-49.65008765586959, -21.993345147396344],
                  [-49.654207528916466, -21.989047515925275]]]),
            {
              "reference": 21,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.65985109666834, -21.232617500351296],
                  [-51.65828468660364, -21.233627551319824],
                  [-51.65758731225977, -21.233047522896488],
                  [-51.658713840046026, -21.23231748387949]]]),
            {
              "reference": 21,
              "system:index": "13"
            })]),
    flo = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.95910695599953, -21.481983943069313],
                  [-49.960480247015155, -21.479747614395272],
                  [-49.9628835062925, -21.479747614395272],
                  [-49.961510215276874, -21.481983943069313]]]),
            {
              "reference": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.53352396439619, -21.57175554843365],
                  [-50.53000490616865, -21.568083831515093],
                  [-50.53343813370771, -21.56760490505958],
                  [-50.536356377115915, -21.57143627239424]]]),
            {
              "reference": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.72511463042251, -21.57462591043207],
                  [-50.713784979543604, -21.576302064896204],
                  [-50.71696071501724, -21.569756970841336],
                  [-50.72262554045669, -21.567362350381085]]]),
            {
              "reference": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.89969019088332, -21.603673095325167],
                  [-50.90947488936965, -21.601279035613842],
                  [-50.90947488936965, -21.607503508466795],
                  [-50.90089182052199, -21.609259080594953]]]),
            {
              "reference": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.36628271819689, -21.240957016833995],
                  [-51.37726904632189, -21.236796969269196],
                  [-51.38413550140002, -21.249596740472597],
                  [-51.374179141536736, -21.262395399818345]]]),
            {
              "reference": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.73492528930447, -20.738834516985833],
                  [-50.74247838989041, -20.733376111364386],
                  [-50.74694158569119, -20.738513439752047],
                  [-50.74316503539822, -20.742687390648967]]]),
            {
              "reference": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.70894283614639, -22.714901562014727],
                  [-51.70950073562149, -22.716009985996116],
                  [-51.70499462447647, -22.71688088425541],
                  [-51.703149264674224, -22.715732880842335],
                  [-51.70778412185196, -22.714782801770014]]]),
            {
              "reference": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.521172660215754, -21.91739584759588],
                  [-51.51823295913543, -21.918689782107244],
                  [-51.51801838241424, -21.916440319178935]]]),
            {
              "reference": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.5270520623764, -21.913912119320145],
                  [-51.52608646713104, -21.915663947619297],
                  [-51.52477754913177, -21.913713046559085]]]),
            {
              "reference": 3,
              "system:index": "8"
            })]),
    savana = /* color: #ffd654 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.193140694052076, -22.806912230985247],
                  [-49.19970674172053, -22.80801990838384],
                  [-49.195887276083326, -22.81379550891368],
                  [-49.1895787204803, -22.816327201809155],
                  [-49.19211072579036, -22.810709944574473]]]),
            {
              "reference": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.24472493782649, -22.802837483068412],
                  [-49.24867314949641, -22.804894652585617],
                  [-49.24618405953059, -22.809958322162444],
                  [-49.24129171028743, -22.804973773869957]]]),
            {
              "reference": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.25553960457454, -22.790098165017838],
                  [-49.25399465218196, -22.79848567599902],
                  [-49.24867314949641, -22.79207639806621]]]),
            {
              "reference": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.91607669131052, -22.199814110900135],
                  [-47.917964966457006, -22.20625088874316],
                  [-47.91384509341013, -22.202992803512856],
                  [-47.91371634737742, -22.197668452701716]]]),
            {
              "reference": 4,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.88938334719431, -22.233345690910593],
                  [-47.88423350588572, -22.231756697462448],
                  [-47.88740924135935, -22.230167686001874],
                  [-47.891529114406225, -22.231597797126945]]]),
            {
              "reference": 4,
              "system:index": "4"
            })]),
    campo = /* color: #0b4a8b */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.89109996096384, -22.223712141738773],
                  [-47.890284569423315, -22.229154681794572],
                  [-47.88440516726267, -22.224864229887555]]]),
            {
              "reference": 12,
              "system:index": "0"
            })]);

// Define the region ID (reg_29)
var regiaoID = 'reg_29'; // old 11

// Define whether to collect data (false)
var coleta = false;   // true or false

// Define the years to process (2016-2023)
var anos = [2016,2017,2018,2019,2020,2021,2022,2023]

// If collecting data, only process 2023
if (coleta) {var anos = [2023]}

// Define the number of trees for the Random Forest classifier (100)
var RFtrees = 100;

// If collecting data, use 200 trees
if (coleta) {var RFtrees = 200}

// Define the output version (1)
var versao_out = 1;

// Define the version of the point data (S2_v1)
var versao_pt = 'S2_v1';

// Define the stable version (3)
var versao_estavel = '3'

// Define the input directory for point data
var dir_pt_in = 'projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/';

// Load the 250,000 biomes feature collection
var bioma250mil = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil');

// Filter the collection to only include the Atlantic Forest biome
var bioma250mil_MA_vetor = bioma250mil.filterMetadata('Bioma','equals', 'Mata Atlântica');

// Load the biomes raster
var biomes = ee.Image('projects/mapbiomas-workspace/AUXILIAR/biomas-raster-41');

// Mask the biomes raster to only include the Atlantic Forest biome
var bioma250mil_MA = biomes.mask(biomes.eq(2));

// Add the Atlantic Forest biome layer to the map
Map.addLayer(bioma250mil_MA,{},'layer bioma',false)

// Import the palettes module
var palettes = require('users/mapbiomas/modules:Palettes.js');

// Define the visualization parameters for the classification
var vis = {
    'min': 0,
    'max': 62,
    'palette': palettes.get('classification7')
};

// Load the Atlantic Forest regions feature collection
var regioesCollection = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/Mata_Atlantica_col6_PLANET');

// Define the visualization parameters for the median composite
var visParMedian2 = {bands: ['swir1_median', 'nir_median', 'red_median'],gain: [0.08, 0.06, 0.2],gamma: 0.85}

// Define the biome name (MATAATLANTICA)
var bioma = "MATAATLANTICA";

// Define the output directory
var dirout = 'projects/mapbiomas-workspace/COLECAO7/classificacao-ma/';

// Load the S2 cluster image
var S2_cluster = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/mosaicos_MA_S2_clusters_2106_2023')

// Filter the regions collection to only include the specified region ID
var limite = regioesCollection.filterMetadata('reg_id', "equals", regiaoID);
//var limite = reg_04_rev

// Load the stable map from collection 6
var mapa_estavel_col6 = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/col7/MATA_ATLANTICA/MA_amostras_estaveis85a20_col6_v1')

// Add the stable map layer to the map
Map.addLayer(mapa_estavel_col6, vis, 'mapa_estavel_col6', false);

// Create a blank image
var blank = ee.Image(0).mask(0);
// Paint the outline of the region on the blank image
var outline = blank.paint(limite, 'AA0000', 2); 
// Define the visualization parameters for the outline
var visPar = {'palette':'000000','opacity': 0.6};
// Add the outline layer to the map
Map.addLayer(outline, visPar, regiaoID, false);

// Define a function to shuffle a feature collection
var shuffle = function (collection, seed) {
    // Add a random column to the collection
    collection = collection.randomColumn('random', seed || 1)
        // Sort the collection by the random column
        .sort('random', true)
        // Map over the collection and set a new ID based on the random column
        .map(function (feature) {
                var rescaled = ee.Number(feature.get('random')).multiply(1000000000).round();
                return feature.set('new_id', rescaled)});
    // Get a list of the new IDs
    var randomIdList = ee.List(collection.reduceColumns(ee.Reducer.toList(), ['new_id']).get('list'));
    // Create a sequential list of IDs
    var sequentialIdList = ee.List.sequence(1, collection.size());
    // Remap the collection using the random and sequential ID lists
    var shuffled = collection.remap(randomIdList, sequentialIdList, 'new_id');
    // Return the shuffled collection
    return shuffled;
};

// Define the visualization parameters for the hand-labeled data
var vis_hand = {
    'min': 0,
    'max': 60,
    'palette': 'blue,white,green,orange,red,brown'
};

// Loop through the years
for (var i_ano=0;i_ano<anos.length; i_ano++){
  // Get the current year
  var ano = anos[i_ano];

  // Define the asset path for the Sentinel-2 mosaics
  var asset = 'projects/mapbiomas-mosaics/assets/SENTINEL/BRAZIL/mosaics-3';
  // Define the band names to use for classification
  var bandNames = ee.List([
  //  THE 60 MOST IMPORTANT BANDS FOR THIS REGION
  'ndvi_median_wet_'+ano,'latitude','gcvi_median_wet','longitude','spri_median_1','green_median_texture_'+ano,'brba_median_dry','swir2_median','red_edge_2_median_wet','swir1_median','green_median','awei_median_dry','red_edge_1_median','ndwi_median_'+ano,'avi_median_wet','red_median_dry','red_edge_3_median','red_median','red_edge_4_median_dry','iia_median_wet','swir1_median_wet','red_edge_3_median_wet','red_median_wet','red_edge_4_median','spri_median_wet','cvi_median_wet','ratio_median','avi_median_dry','red_edge_3_median_dry','gvmi_median_dry','avi_median','nir_median_wet','evi_median_wet','msi_median_dry','brba_median_wet','osavi_median_dry','spri_median','ndvi_median_dry_'+ano,'awei_median','ndvi_median_dry','cvi_median','green_median_texture','ui_median','blue_median','iia_median_dry','green_median_wet','brightness_median_wet','red_min','brba_median','dswi5_median','afvi_median_dry','gli_median_dry','red_edge_2_median_dry','co2flux_median','green_median_dry','blue_median_dry','gemi_median_wet','ndwi_median_dry','rvi_median','red_edge_1_median_wet',

  // ALL 143 BANDS TO FEATURE IMPORTANCE
  //    'blue_median','afvi_median','afvi_median_dry','afvi_median_wet','avi_median','avi_median_dry','avi_median_wet','awei_median','awei_median_dry','awei_median_wet','blue_median_dry','blue_median_wet','blue_stdDev','brba_median','brba_median_dry','brba_median_wet','brightness_median','brightness_median_dry','brightness_median_wet','bsi_median','bsi_median_1','bsi_median_2','clusters_2023','co2flux_median','cvi_median','cvi_median_dry','cvi_median_wet','dswi5_median','dswi5_median_dry','dswi5_median_wet','evi_median','evi_median_dry','evi_median_wet','gcvi_median','gcvi_median_dry','gcvi_median_wet','gemi_median','gemi_median_dry','gemi_median_wet','gli_median','gli_median_dry','gli_median_wet','green_median','green_median_dry','green_median_texture','green_median_texture_2023','green_median_wet','green_min','green_stdDev','gvmi_median','gvmi_median_1','gvmi_median_dry','gvmi_median_dry_1','gvmi_median_wet','gvmi_median_wet_1','iia_median','iia_median_dry','iia_median_wet','lai_median','latitude','longitude','lswi_median','lswi_median_dry','lswi_median_wet','mbi_median','mbi_median_dry','mbi_median_wet','msi_median','msi_median_dry','msi_median_wet','nddi_median','nddi_median_dry','nddi_median_wet','ndvi_median','ndvi_median_dry','ndvi_median_dry_2023','ndvi_median_wet','ndvi_median_wet_2023','ndwi_median','ndwi_median_2023','ndwi_median_dry','ndwi_median_wet','nir_median','nir_median_contrast','nir_median_dry','nir_median_dry_contrast','nir_median_wet','nir_stdDev','osavi_median','osavi_median_dry','osavi_median_wet','ratio_median','ratio_median_dry','ratio_median_wet','red_edge_1_median','red_edge_1_median_dry','red_edge_1_median_wet','red_edge_1_stdDev','red_edge_2_median','red_edge_2_median_dry','red_edge_2_median_wet','red_edge_2_stdDev','red_edge_3_median','red_edge_3_median_dry','red_edge_3_median_wet','red_edge_3_stdDev','red_edge_4_median','red_edge_4_median_dry','red_edge_4_median_wet','red_edge_4_stdDev','red_median','red_median_contrast','red_median_dry','red_median_dry_contrast','red_median_wet','red_min','red_stdDev','ri_median','ri_median_dry','ri_median_wet','rvi_median','rvi_median_1','rvi_median_wet','shape_median','shape_median_dry','shape_median_wet','spri_median','spri_median_1','spri_median_wet','swir1_median','swir1_median_dry','swir1_median_wet','swir1_stdDev','swir2_median','swir2_median_dry','swir2_median_wet','swir2_stdDev','ui_median','ui_median_dry','ui_median_wet','wetness_median','wetness_median_dry','wetness_median_wet',
  ])

  // Load the Sentinel-2 mosaics for the current year
  var collection = ee.ImageCollection(asset)
        // Filter the collection to only include version 3
        .filter(ee.Filter.eq('version', '3'))
        // Filter the collection to only include the current year
        .filter(ee.Filter.eq('year', ano))
        // Filter the collection to only include the Atlantic Forest biome
        .filter(ee.Filter.inList('biome', [
            'MATAATLANTICA',
        ])); 

  // Create a mosaic of the Sentinel-2 images
  var mosaicoTotal = collection.mosaic()

  // Import the function to add indices for the Caatinga biome
  var addIndexCaatinga = require('users/marcosrosaUSP/MapBiomas_col9_MataAtlan:Mata_Atlantica_SENTINEL2/processa_Bandas_Sentinel2_CAATINGA');

  // Add the Caatinga indices to the mosaic
  mosaicoTotal = addIndexCaatinga.get(mosaicoTotal);

  // Add the S2 cluster bands to the mosaic
  mosaicoTotal = mosaicoTotal.addBands(S2_cluster.select([
    'clusters_'+ano, 'ndvi_median_dry_'+ano,'ndvi_median_wet_'+ano,'ndwi_median_'+ano, 'green_median_texture_'+ano
    ]))
    
  // Add the mosaic layer to the map
  Map.addLayer(mosaicoTotal, {'bands': ['swir1_median', 'nir_median', 'red_median'],
    'gain': [0.08, 0.07, 0.2],'gamma': 0.85}, 'Sentinel 2 '+ano, false);

  //print(mosaicoTotal)
  //var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/REGIONs_'+regiaoID+'_'+ano)

  // Load the training points for the current year
  var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/pontos_train_v1_'+ano)
                    // Filter the points to only include the specified region ID
                    .filterMetadata('reg_id', 'equals', regiaoID)
                    
    // Filter the points to only include forest
    var BDflo = BDamostras.filterMetadata("reference", "equals", 3)
    // Filter the points to only include savanna
    var BDsav = BDamostras.filterMetadata("reference", "equals", 4)//.limit(100)
    // Filter the points to only include reforestation
    var BDreflo = BDamostras.filterMetadata("reference", "equals", 9)
    // Filter the points to only include floodplain forest
    var BDvarzea = BDamostras.filterMetadata("reference", "equals", 11)
    // Filter the points to only include grassland
    var BDcampo = BDamostras.filterMetadata("reference", "equals", 12)
    // Filter the points to only include other non-forest
    var BDOutroNFlo = BDamostras.filterMetadata("reference", "equals", 13)
    // Filter the points to only include agriculture
    var BDagro = BDamostras.filterMetadata("reference", "equals", 21)
    // BDagro = shuffle(BDagro, 2).limit(2500)
    // Filter the points to only include non-vegetation
    var BDNaoVeg = BDamostras.filterMetadata("reference", "equals", 22)
    // Filter the points to only include afforestation
    var BDAflora = BDamostras.filterMetadata("reference", "equals", 29)
    // Filter the points to only include water
    var BDagua = BDamostras.filterMetadata("reference", "equals", 33)

  // Complementary samples
  // Merge the training points for different classes
  var amostraTotal = varzea.merge(agro).merge(flo).merge(savana).merge(campo)////.merge(agua)
  
  // Reduce the training points to an image
  var amostraTotalimg = amostraTotal.reduceToImage({properties: ['reference'],reducer: ee.Reducer.first()})

  // Rename the band to 'reference'
  amostraTotalimg = amostraTotalimg.select([0],['reference'])

  // Sample the mosaic using the forest points
  var training_flo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 600, 'region': flo.filterBounds(limite), 'scale': 30, 'seed': 1});
  // var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': restinga.filterBounds(limite), 'scale': 30, 'seed': 1});
  // Sample the mosaic using the savanna points
  var training_sav = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1500, 'region': savana.filterBounds(limite), 'scale': 30, 'seed': 1});
  // var training_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': aflora.filterBounds(limite), 'scale': 30, 'seed': 1});
  // Sample the mosaic using the floodplain forest points
  var training_var = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1600, 'region': varzea.filterBounds(limite), 'scale': 30, 'seed': 1});
  // var training_agu = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 100, 'region': agua.filterBounds(limite), 'scale': 30, 'seed': 1});
  // Sample the mosaic using the grassland points
  var training_cam = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 100, 'region': campo.filterBounds(limite), 'scale': 30, 'seed': 1});
  // var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 500, 'region': restinga.filterBounds(limite), 'scale': 30, 'seed': 1});
  // Sample the mosaic using the agriculture points
  var training_agr = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 400, 'region': agro.filterBounds(limite), 'scale': 30, 'seed': 1});

// If collecting data, print the number of points for each class
if (coleta) {
// print('BDflo',BDflo.size())
// print('BDsav',BDsav.size())
// print('BDvar',BDvarzea.size())
// print('BDcam',BDcampo.size())
// print('BDOut',BDOutroNFlo.size())
// print('BDAfl',BDAflora.size())
// print('BDagr',BDagro.size())
// print('BDNao',BDNaoVeg.size())
// print('BDagu',BDagua.size())
print('training_flo',training_flo.size())
print('training_var',training_var.size())
// print('training_nflo',training_nflo.size())
// print('training_cam',training_cam.size())
print('training_sav',training_sav.size())
// print('training_afl',training_afl.size())
print('training_cam',training_cam.size())
print('training_agr',training_agr.size())
}

  // Merge the training points for all classes
  var training = BDflo.merge(BDreflo).merge(BDcampo)//.merge(BDsav).merge(BDOutroNFlo).merge(BDAflora)
                      .merge(BDagro).merge(BDNaoVeg).merge(BDagua)
                      //complementares
                      .merge(training_var).merge(training_agr).merge(training_flo)
                       .merge(training_sav)
                       .merge(training_cam)
                      // //.merge(training_agu).merge(training_agr)

  // Train a Random Forest classifier
  var classifierRF = ee.Classifier.smileRandomForest({numberOfTrees: RFtrees, variablesPerSplit:1}).train(training, 'reference', bandNames);

  // If collecting data, print the classifier explanation
  if (coleta) {print(classifierRF.explain())}

  // Train a Gradient Tree Boost classifier
  var classifierGTB = ee.Classifier.smileGradientTreeBoost({numberOfTrees: 30, shrinkage: 0.1, samplingRate: 0.8, loss: 'LeastSquares'}).train(training, 'reference', bandNames);

  // print(classifier.explain())

  // Classify the mosaic using the Random Forest classifier
  var classifiedRF = mosaicoTotal.classify(classifierRF).mask(mosaicoTotal.select('blue_median'));

  // Classify the mosaic using the Gradient Tree Boost classifier
  var classifiedGTB = mosaicoTotal.classify(classifierGTB).mask(mosaicoTotal.select('blue_median'));

  // Rename the classification band and clip the image to the region
  classifiedRF = classifiedRF.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()
  // classifiedGTB = classifiedGTB.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()

  // If collecting data, add the classified images to the map
  if (coleta) {  
    Map.addLayer(classifiedRF, vis, 'RF'+ano+"_"+regiaoID, false);
//    Map.addLayer(classifiedGTB, vis, 'GTB'+ano+"_"+regiaoID, false);
  }

  // If this is the first year, initialize the classified image for the entire period
  if (i_ano == 0){ var classified16a23RF = classifiedRF;}//  var classified16a23GTB = classifiedGTB}  
  // Otherwise, add the current year's classification to the image
  else {classified16a23RF = classified16a23RF.addBands(classifiedRF);}// classified16a23GTB = classified16a23GTB.addBands(classifiedGTB)}
}

// If collecting data, do nothing
if (coleta) {}
// Otherwise, export the classified image to an asset
   else 
   {
     // Set the metadata for the classified image
     classified16a23RF = classified16a23RF
     .set('territory', 'BRAZIL')
     .set('biome', 'MATA ATÂNTICA')
     .set('source', 'arcplan')
     .set('version', '1')
     .set('collection_id',versao_out)

//     classified16a23GTB = classified16a23GTB
//     .set('territory', 'BRAZIL')
//     .set('biome', 'MATA ATÂNTICA')
//     .set('source', 'arcplan')
//     .set('version', '1')
//     .set('collection_id',versao_out)
     
    // Export the classified image to an asset
    Export.image.toAsset({
       "image": classified16a23RF.toInt8(),
       "description": regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "assetId": dirout + regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "scale": 10,
       "pyramidingPolicy": {
           '.default': 'mode'
       },
       "maxPixels": 1e13,
       "region": limite
     });    
     
//    Export.image.toAsset({
//       "image": classified16a23GTB.toInt8(),
//       "description": regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "assetId": dirout + regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "scale": 10,
//       "pyramidingPolicy": {
//           '.default': 'mode'
//       },
//       "maxPixels": 1e13,
//       "region": limite
//     });    
}
