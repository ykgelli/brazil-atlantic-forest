var campo = /* color: #ffc021 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.884623896055196, -27.89706873473077],
                  [-50.88050402300832, -27.90859827308017],
                  [-50.876384149961446, -27.898282428199078]]]),
            {
              "reference": 12,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.84205187457082, -27.805699280417144],
                  [-50.848918329648946, -27.806002960840246],
                  [-50.851664911680196, -27.81389835387806]]]),
            {
              "reference": 12,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.95466173785207, -27.789299277205423],
                  [-50.96118487017629, -27.792640219303745],
                  [-50.96015490191457, -27.797195883964253]]]),
            {
              "reference": 12,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.85029162066457, -27.883717208339235],
                  [-50.83381212847707, -27.884020670406823],
                  [-50.84239519732473, -27.87764778840773]]]),
            {
              "reference": 12,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.13571160839789, -28.040201987374363],
                  [-51.12369531201117, -28.042323126280408],
                  [-51.12953179882758, -28.036565651944315]]]),
            {
              "reference": 12,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.14429467724555, -27.975941975459882],
                  [-51.14944451855414, -27.98170269097981],
                  [-51.14051812695258, -27.980489934335456]]]),
            {
              "reference": 12,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.011772094237735, -28.117142235610682],
                  [-51.01142877148383, -28.121987019431348],
                  [-51.00696557568305, -28.123198181179426]]]),
            {
              "reference": 12,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.0316848139643, -28.06565289321841],
                  [-51.022758422362735, -28.06686469082686],
                  [-51.0261916499018, -28.06080556613634]]]),
            {
              "reference": 12,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.91377869456384, -28.270573928513308],
                  [-50.907598884993526, -28.270573928513308],
                  [-50.9117187580404, -28.26422393857286]]]),
            {
              "reference": 12,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.89056699838576, -28.332314730892698],
                  [-50.89228361215529, -28.338358480256343],
                  [-50.88473051156935, -28.337149757885882]]]),
            {
              "reference": 12,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.14033153676903, -28.648135691165514],
                  [-51.12968853139794, -28.655969025831894],
                  [-51.131748467921376, -28.64452010858239]]]),
            {
              "reference": 12,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.98244894615591, -28.908104602273287],
                  [-50.97729910484732, -28.910508921769825],
                  [-50.97695578209341, -28.90509912455242]]]),
            {
              "reference": 12,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.84340323082388, -28.887966239488307],
                  [-50.83138693443716, -28.887665637319127],
                  [-50.83825338951529, -28.88465956776902]]]),
            {
              "reference": 12,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.93014145886334, -28.967425118754786],
                  [-50.93460465466412, -28.95691158486568],
                  [-50.93632126843365, -28.968626597497465]]]),
            {
              "reference": 12,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.879329691285214, -29.039489143767995],
                  [-50.87726975476178, -29.026581368206575],
                  [-50.868343363160214, -29.019676546686313],
                  [-50.876583109253964, -29.01907610560547],
                  [-50.88688279187115, -29.03438626263097]]]),
            {
              "reference": 12,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.81718827282818, -29.06349931410384],
                  [-50.81959153210553, -29.07910292708241],
                  [-50.80929184948834, -29.078802879881824],
                  [-50.80894852673443, -29.070401203518546],
                  [-50.81203843151959, -29.065900023706313]]]),
            {
              "reference": 12,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.76191330944928, -29.06890083208814],
                  [-50.74543381726178, -29.070101130979737],
                  [-50.74303055798443, -29.05989814487858],
                  [-50.750240335816464, -29.062298938337918]]]),
            {
              "reference": 12,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.94005447542452, -29.146017813057703],
                  [-50.92906814729952, -29.15471314393202],
                  [-50.922888337729205, -29.156811906625997],
                  [-50.92632156526827, -29.151115165251163],
                  [-50.93250137483858, -29.14721721279755]]]),
            {
              "reference": 12,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.773542939779986, -29.202374459165956],
                  [-50.78590255892061, -29.207469012748255],
                  [-50.77800613558077, -29.217357717368415]]]),
            {
              "reference": 12,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.75397354280733, -29.17839669039102],
                  [-50.75672012483858, -29.16670549589147],
                  [-50.76015335237764, -29.18139421803928]]]),
            {
              "reference": 12,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.65579550439807, -29.306601768861274],
                  [-50.66128866846057, -29.30899679566538],
                  [-50.649959017581665, -29.318875687137158]]]),
            {
              "reference": 12,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.625239779300415, -29.221161662954245],
                  [-50.6355394619176, -29.22056239694331],
                  [-50.63759939844104, -29.235542995317445]]]),
            {
              "reference": 12,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.508853365726196, -29.2990363744379],
                  [-50.50954001123401, -29.304126116417486],
                  [-50.49855368310901, -29.30472489290911],
                  [-50.49958365137073, -29.296641113944283]]]),
            {
              "reference": 12,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.420276095218384, -29.26999005210024],
                  [-50.43091910058948, -29.27058902871611],
                  [-50.430232455081665, -29.278674869500506],
                  [-50.424739291019165, -29.275680188242454],
                  [-50.41409628564807, -29.281070551321793]]]),
            {
              "reference": 12,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.34367539040655, -29.3288103597317],
                  [-50.33406235329718, -29.33838804436212],
                  [-50.34195877663702, -29.32551782286241]]]),
            {
              "reference": 12,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.48752762429327, -29.42843407838955],
                  [-50.47928787819952, -29.447868768462346],
                  [-50.4782579099378, -29.43501238998146]]]),
            {
              "reference": 12,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.25063492409796, -29.478358780364136],
                  [-50.23535706154913, -29.47462275215339],
                  [-50.24119354836554, -29.474174419515027]]]),
            {
              "reference": 12,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.07881240644415, -29.363852321090004],
                  [-50.07400588788946, -29.362356241122708],
                  [-50.075722501658994, -29.357269404839126]]]),
            {
              "reference": 12,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.139688291310236, -29.1829155584233],
                  [-50.12578371977703, -29.191907482537523],
                  [-50.12767199492352, -29.18261581404409]]]),
            {
              "reference": 12,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.272057871485586, -29.14964021574123],
                  [-50.29197059121215, -29.12624994717039],
                  [-50.285104136134024, -29.15863505528811]]]),
            {
              "reference": 12,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.400460581446524, -29.140044852079836],
                  [-50.387414316798086, -29.17482378114571],
                  [-50.370934824610586, -29.172425612482446]]]),
            {
              "reference": 12,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.980233530665274, -29.068651234612464],
                  [-49.982980112696524, -29.10645402473647],
                  [-49.96856055703246, -29.074052482623593]]]),
            {
              "reference": 12,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.989899044115106, -28.860279512527516],
                  [-49.97959936149792, -28.8783188577169],
                  [-49.98028600700573, -28.858475405798206]]]),
            {
              "reference": 12,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.49939001091198, -28.997299928073232],
                  [-50.459564571458856, -28.99609878233542],
                  [-50.48497045524792, -28.987089744484617]]]),
            {
              "reference": 12,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.924473024354924, -28.713437176179877],
                  [-49.8626749286518, -28.700187692452946],
                  [-49.92584631537055, -28.69536928239448]]]),
            {
              "reference": 12,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.715732789979924, -28.565188442703604],
                  [-49.707493043886174, -28.59292566810091],
                  [-49.699253297792424, -28.57121889650717]]]),
            {
              "reference": 12,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.57977697943305, -28.442206210358304],
                  [-49.6044962177143, -28.4397911187805],
                  [-49.594883180604924, -28.459110307359673]]]),
            {
              "reference": 12,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.5550577411518, -28.34918541048286],
                  [-49.575657106386174, -28.343142277089783],
                  [-49.572910524354924, -28.354019669603915]]]),
            {
              "reference": 12,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.61204931830024, -28.161430219369848],
                  [-49.6154825458393, -28.17595790546236],
                  [-49.5990030536518, -28.162640935213656]]]),
            {
              "reference": 12,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.77684424017524, -28.062710869376748],
                  [-49.773411012636174, -28.078463603611624],
                  [-49.76860449408149, -28.05846935402992]]]),
            {
              "reference": 12,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.932014332738554, -27.96086834047674],
                  [-49.904548512426054, -27.971178212361007],
                  [-49.910728321996366, -27.961474830794245]]]),
            {
              "reference": 12,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.12226627144399, -27.86739428570135],
                  [-50.1284460810143, -27.872250308462952],
                  [-50.12157962593618, -27.880140881237573]]]),
            {
              "reference": 12,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.278934084824755, -28.000854163828457],
                  [-50.26314123814507, -28.016009777541953],
                  [-50.26176794712944, -28.000247894930453]]]),
            {
              "reference": 12,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.133365237168505, -28.043890533892753],
                  [-50.11757239048882, -28.052980522944985],
                  [-50.12031897252007, -28.0384361716784]]]),
            {
              "reference": 12,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.41429197004691, -28.123133383351956],
                  [-50.4245916526641, -28.15159176163818],
                  [-50.412918679031286, -28.14129917830718]]]),
            {
              "reference": 12,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.31541501692191, -28.169752730507398],
                  [-50.31816159895316, -28.184884516865747],
                  [-50.30442868879691, -28.183674052740887]]]),
            {
              "reference": 12,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.31168796306064, -28.2374392258395],
                  [-50.290401952318454, -28.252561426419177],
                  [-50.295895116380954, -28.233204625485907]]]),
            {
              "reference": 12,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.08414163958479, -28.400338990480364],
                  [-50.06903543841292, -28.39248663706243],
                  [-50.08963480364729, -28.393694729301664]]]),
            {
              "reference": 12,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-49.97839823138167, -28.310908598307968],
                  [-49.97565164935042, -28.324207071028464],
                  [-49.96603861224104, -28.304863288220645]]]),
            {
              "reference": 12,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.06672426174051, -28.566739609529993],
                  [-50.05024476955301, -28.566739609529993],
                  [-50.057111224631136, -28.560708899033582]]]),
            {
              "reference": 12,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.20679994533426, -28.587241439934537],
                  [-50.20611329982645, -28.563121224699753],
                  [-50.21778627345926, -28.596887977244723]]]),
            {
              "reference": 12,
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.15736146877176, -28.592667726094533],
                  [-50.139508685568636, -28.596887977244723],
                  [-50.15461488674051, -28.581211904630777]]]),
            {
              "reference": 12,
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.51441713283426, -28.484692356378876],
                  [-50.50892396877176, -28.496158677077506],
                  [-50.50617738674051, -28.487709929939186]]]),
            {
              "reference": 12,
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.453837101924485, -28.298002221973096],
                  [-50.43667096422917, -28.310093278345512],
                  [-50.44147748278386, -28.29921138944282]]]),
            {
              "reference": 12,
              "system:index": "53"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.60672423983955, -28.170787615011566],
                  [-50.61221740390205, -28.18531403047574],
                  [-50.597111202730176, -28.174419403837174]]]),
            {
              "reference": 12,
              "system:index": "54"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.57445190097236, -28.159286137081697],
                  [-50.575138546480176, -28.173208821261397],
                  [-50.56758544589424, -28.180472111209276],
                  [-50.5655255093708, -28.165945038129664]]]),
            {
              "reference": 12,
              "system:index": "55"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.16815421280189, -28.022205847318002],
                  [-51.15957114395423, -28.02008431185521],
                  [-51.16437766250892, -28.01584111551676]]]),
            {
              "reference": 12,
              "system:index": "56"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.176693659671415, -28.149327134250388],
                  [-51.16433404053079, -28.151748826017805],
                  [-51.17360375488626, -28.14236446535622],
                  [-51.17635033691751, -28.145391768320334]]]),
            {
              "reference": 12,
              "system:index": "57"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.445858698733915, -28.424581010607017],
                  [-51.44173882568704, -28.41959899414656],
                  [-51.44345543945657, -28.41854217263702],
                  [-51.4477469738804, -28.421561634678582]]]),
            {
              "reference": 12,
              "system:index": "58"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.31831429565774, -28.46548506269944],
                  [-51.31814263428079, -28.47212481799472],
                  [-51.31161950195657, -28.467295946431005],
                  [-51.31367943848001, -28.463825058684947]]]),
            {
              "reference": 12,
              "system:index": "59"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.48257131850478, -28.54145519049106],
                  [-51.48411627089736, -28.54597908290814],
                  [-51.481713011620016, -28.54612987597583]]]),
            {
              "reference": 12,
              "system:index": "60"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.450617210737725, -28.571260202028732],
                  [-51.4466689990678, -28.572918515583552],
                  [-51.44426573979046, -28.572466250842663],
                  [-51.44478072392132, -28.570506414499523],
                  [-51.44718398319866, -28.570657172437404],
                  [-51.451132194868585, -28.569149583338334]]]),
            {
              "reference": 12,
              "system:index": "61"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.39190901981976, -28.544874425941398],
                  [-51.38727416264202, -28.546985531384383],
                  [-51.38487090336468, -28.544874425941398],
                  [-51.38830413090374, -28.544120449457054]]]),
            {
              "reference": 12,
              "system:index": "62"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.25836672649692, -27.862307680658315],
                  [-51.26111330852817, -27.863521763735605],
                  [-51.26059832439731, -27.86534286285113]]]),
            {
              "reference": 12,
              "system:index": "63"
            })]),
    reflo = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.31422735062009, -28.857963638039713],
                  [-50.3189480384863, -28.859016042616698],
                  [-50.3149139961279, -28.85931672768206]]]),
            {
              "reference": 9,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.33585668411618, -28.837138871586667],
                  [-50.33791662063962, -28.839469648294408],
                  [-50.33388257828122, -28.839018534296443],
                  [-50.33208013382321, -28.83593586963368]]]),
            {
              "reference": 9,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.328475244907196, -28.823679494801556],
                  [-50.33233762588864, -28.818941981685924],
                  [-50.33190847244626, -28.82390508528779]]]),
            {
              "reference": 9,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.29508710708981, -28.873222461656525],
                  [-50.29345632400876, -28.875853066891416],
                  [-50.29319883194333, -28.872621171108495]]]),
            {
              "reference": 9,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.34206491793737, -28.854839798389452],
                  [-50.3448973306571, -28.85390011421363],
                  [-50.34365278567419, -28.855666713439916]]]),
            {
              "reference": 9,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.350936052079405, -28.845260273852578],
                  [-50.352180597062315, -28.846801479469544],
                  [-50.34780323195001, -28.84650075821542]]]),
            {
              "reference": 9,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.37299453901788, -28.845786541752556],
                  [-50.373895761246885, -28.848906503905262],
                  [-50.371664163346495, -28.84597449392874]]]),
            {
              "reference": 9,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.34634411024591, -28.832779426384736],
                  [-50.349691507096495, -28.83082445926075],
                  [-50.348404046769346, -28.83435841148581]]]),
            {
              "reference": 9,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.368660089249815, -28.78411991297726],
                  [-50.36926090406915, -28.785925308464783],
                  [-50.36677181410333, -28.785097839412757],
                  [-50.36711513685724, -28.78246493965739]]]),
            {
              "reference": 9,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.40765809937558, -28.78899339982347],
                  [-50.40946054383359, -28.78906862174387],
                  [-50.407572268687105, -28.791927014505863]]]),
            {
              "reference": 9,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.418816088877534, -28.79741791756105],
                  [-50.423021792612886, -28.796665756156937],
                  [-50.418301104746675, -28.7992230827856]]]),
            {
              "reference": 9,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.39993571999115, -28.764658001195826],
                  [-50.40285396339935, -28.76119692695213],
                  [-50.40019321205658, -28.766012303354966]]]),
            {
              "reference": 9,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.414526937032164, -28.764281803032905],
                  [-50.41435527565521, -28.765335154472055],
                  [-50.4110937094931, -28.764658001195826]]]),
            {
              "reference": 9,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.061582533664804, -27.843351621946635],
                  [-50.05703350717555, -27.852079067495566],
                  [-50.05952259714137, -27.84357930336066]]]),
            {
              "reference": 9,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.03919064346517, -27.835496037901247],
                  [-50.03498493972982, -27.837848893167056],
                  [-50.038503997957356, -27.83390213921763]]]),
            {
              "reference": 9,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.0368732148763, -27.82578048239606],
                  [-50.032324188387044, -27.814166216484754],
                  [-50.038761490022786, -27.825932294639166]]]),
            {
              "reference": 9,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.036787384187825, -27.80194332742439],
                  [-50.035757415926106, -27.79753971369322],
                  [-50.03824650589193, -27.80194332742439]]]),
            {
              "reference": 9,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.09355935547317, -27.801335943036104],
                  [-50.0912419268843, -27.799285995661254],
                  [-50.095876784062035, -27.800728555252807]]]),
            {
              "reference": 9,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.03989591945062, -27.89803459485097],
                  [-50.044530776628356, -27.89871729300879],
                  [-50.043844131120544, -27.900386092596783]]]),
            {
              "reference": 9,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.060495284685, -27.89666918561528],
                  [-50.059293655046325, -27.90410287191191],
                  [-50.05886450160394, -27.89742774842851]]]),
            {
              "reference": 9,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.115173010822446, -27.745693590722738],
                  [-50.1193787145578, -27.742655064273205],
                  [-50.11697545528045, -27.746225324136983]]]),
            {
              "reference": 9,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.04238858699432, -27.74911183166102],
                  [-50.041015295978696, -27.74835223183492],
                  [-50.04462018489471, -27.74500992966157]]]),
            {
              "reference": 9,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.049512534137875, -27.76346727193891],
                  [-50.04745259761444, -27.763543221615052],
                  [-50.050285010334164, -27.76042924143496]]]),
            {
              "reference": 9,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.53154750360863, -28.543145578178414],
                  [-50.53292079462425, -28.540431193027285],
                  [-50.53669734491722, -28.544050357685805]]]),
            {
              "reference": 9,
              "system:index": "23"
            })]),
    flo = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.438264782079756, -27.59914315147184],
                  [-50.43599026883513, -27.597431696804616],
                  [-50.437277729162275, -27.59629071218002],
                  [-50.439766819128096, -27.5983444759528]]]),
            {
              "reference": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.76493944988559, -27.850773213191133],
                  [-51.76631274090121, -27.853201624113158],
                  [-51.764767788508635, -27.852594526481326]]]),
            {
              "reference": 3,
              "system:index": "1"
            })]),
    agro = /* color: #00ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.49157576883571, -27.574827187868273],
                  [-50.48801379526393, -27.57258277757488],
                  [-50.48848586405055, -27.5719741160226],
                  [-50.492691567785904, -27.573647927167013]]]),
            {
              "reference": 21,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.566579329345544, -27.569914294764313],
                  [-50.56842468914779, -27.569077363907137],
                  [-50.56945465740951, -27.570675135459147]]]),
            {
              "reference": 21,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.58508892834317, -27.575752320193384],
                  [-50.58350106060635, -27.573964418924344],
                  [-50.58547516644131, -27.573888337372992],
                  [-50.587406356932036, -27.576018600868274]]]),
            {
              "reference": 21,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.612826777635625, -27.574248690759283],
                  [-50.6108955871449, -27.574629096739066],
                  [-50.61025185698133, -27.572879218311467],
                  [-50.611110163866094, -27.57280313600762]]]),
            {
              "reference": 21,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.6238989364491, -27.570064137934946],
                  [-50.625830126939825, -27.568466357486848],
                  [-50.62638802641492, -27.569417420079773],
                  [-50.62600178831678, -27.570216306288145]]]),
            {
              "reference": 21,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.62372727507215, -27.5672870284249],
                  [-50.62402768248182, -27.565993556172312],
                  [-50.62514348143201, -27.565993556172312],
                  [-50.6250147353993, -27.567210942243793]]]),
            {
              "reference": 21,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.75977771977538, -27.76017355418767],
                  [-50.762095148364246, -27.758654503570302],
                  [-50.76291053990477, -27.759452007787484],
                  [-50.76042144993895, -27.761009022991683]]]),
            {
              "reference": 21,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.018051501556855, -27.75541936833731],
                  [-51.02148472909592, -27.753292598666388],
                  [-51.022772189423065, -27.75709037250654],
                  [-51.020025607391815, -27.758077772005752]]]),
            {
              "reference": 21,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.07036530618332, -27.741708570368928],
                  [-51.07216775064133, -27.740834970737904],
                  [-51.07255398873947, -27.741442692961943],
                  [-51.070966121002655, -27.742278305484522]]]),
            {
              "reference": 21,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.21959782875637, -27.761848754204177],
                  [-51.22079945839504, -27.75991199075676],
                  [-51.22208691872219, -27.75976008628392],
                  [-51.22011281288723, -27.762418383953964]]]),
            {
              "reference": 21,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.48473431563557, -27.808119641052848],
                  [-51.48155858016194, -27.807967803905772],
                  [-51.48258854842366, -27.806829018538203],
                  [-51.48404767012776, -27.806829018538203]]]),
            {
              "reference": 21,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.519785535455924, -27.865623059691],
                  [-51.52167381060241, -27.865471302992542],
                  [-51.52236045611022, -27.864560758339067],
                  [-51.521244657160025, -27.86410548314345],
                  [-51.521244657160025, -27.86258788534537],
                  [-51.52304710161803, -27.86243612439681],
                  [-51.523476255060416, -27.865243667546398],
                  [-51.52158797991393, -27.866533595418947]]]),
            {
              "reference": 21,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.80366346809598, -27.963632928664655],
                  [-51.80280516121122, -27.965755575492235],
                  [-51.801603531572546, -27.96499749213232],
                  [-51.80229017708036, -27.96348130943654]]]),
            {
              "reference": 21,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.81207487556669, -27.983190022753643],
                  [-51.81121656868192, -27.982128876071222],
                  [-51.8127615210745, -27.981749892582645],
                  [-51.81327650520536, -27.982432061903147]]]),
            {
              "reference": 21,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.60024017768105, -28.115648809260918],
                  [-51.603673405220114, -28.11655723555443],
                  [-51.600411839058005, -28.118601166576703]]]),
            {
              "reference": 21,
              "system:index": "14"
            })]),
    varzea = /* color: #d626cc */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.23502192876662, -27.349518128393925],
                  [-51.23536525152053, -27.348450811160518],
                  [-51.23879847905959, -27.348908234091187]]]),
            {
              "reference": 11,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.2834304370674, -27.375740406146466],
                  [-51.285833696344746, -27.378026938219048],
                  [-51.28446040532912, -27.37817937201044]]]),
            {
              "reference": 11,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.32171092412795, -27.38153286228489],
                  [-51.32239756963576, -27.378941537817102],
                  [-51.32411418340529, -27.380465853678608]]]),
            {
              "reference": 11,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.972208360651386, -27.34059808968326],
                  [-50.97169337652053, -27.34273286516817],
                  [-50.971006731012714, -27.33983565990048]]]),
            {
              "reference": 11,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.95366893194045, -27.340445604146357],
                  [-50.954012254694355, -27.341817966424834],
                  [-50.95212397954787, -27.340445604146357]]]),
            {
              "reference": 11,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.97443995855178, -27.344257679620156],
                  [-50.97340999029006, -27.34532503725094],
                  [-50.97255168340529, -27.343190311707065]]]),
            {
              "reference": 11,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.93663912071061, -27.32336589643681],
                  [-50.93457918418717, -27.325501003801158],
                  [-50.93440752281022, -27.324280947483853]]]),
            {
              "reference": 11,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.61799731121371, -27.860031238233066],
                  [-51.61628069744418, -27.862004157764005],
                  [-51.61662402019809, -27.86018300254884]]]),
            {
              "reference": 11,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.61851229534457, -27.86079005768706],
                  [-51.61885561809848, -27.859727708964073],
                  [-51.62040057049106, -27.86079005768706]]]),
            {
              "reference": 11,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.19777026043246, -27.886586757726235],
                  [-51.19811358318637, -27.885524661939147],
                  [-51.20103182659457, -27.886435030394495]]]),
            {
              "reference": 11,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.193478726008635, -27.8859798471236],
                  [-51.19244875774692, -27.884614285829716],
                  [-51.19536700115512, -27.88567639054658]]]),
            {
              "reference": 11,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.7739383207352, -27.921630072444042],
                  [-50.775483273127776, -27.92329851855978],
                  [-50.77308001385043, -27.922843490354552]]]),
            {
              "reference": 11,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.78389468059848, -27.90706799535339],
                  [-50.78440966472934, -27.909040058071476],
                  [-50.78269305095981, -27.908281576665217]]]),
            {
              "reference": 11,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.7768565641434, -27.91404590196504],
                  [-50.778229855159026, -27.91328745566139],
                  [-50.78011813030551, -27.91434927899719]]]),
            {
              "reference": 11,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.756257198909026, -27.917079633989246],
                  [-50.75522723064731, -27.915714465110252],
                  [-50.7574588285477, -27.916624579611184]]]),
            {
              "reference": 11,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.13116564617465, -28.15367505579795],
                  [-51.13185229168246, -28.151556116616792],
                  [-51.13597216472934, -28.15367505579795]]]),
            {
              "reference": 11,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.095116757014495, -28.147015391454357],
                  [-51.09271349773715, -28.1494371355019],
                  [-51.09099688396762, -28.146712669597704]]]),
            {
              "reference": 11,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-51.33990588054965, -28.14247447375931],
                  [-51.34093584881137, -28.144593592641975],
                  [-51.33750262127231, -28.144593592641975]]]),
            {
              "reference": 11,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.9636241422684, -28.409454584275558],
                  [-50.96568407879184, -28.40734072823778],
                  [-50.96980395183871, -28.411266427304593]]]),
            {
              "reference": 11,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.93238177166293, -28.399488893665232],
                  [-50.93718829021762, -28.405528818060663],
                  [-50.93169512615512, -28.405226830018265]]]),
            {
              "reference": 11,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.9416514860184, -28.405830805242264],
                  [-50.94474139080356, -28.410662483071906],
                  [-50.941308163264495, -28.410662483071906]]]),
            {
              "reference": 11,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.95710100994418, -28.442666780851653],
                  [-50.95332445965121, -28.43934603017551],
                  [-50.95572771892856, -28.438138458630263]]]),
            {
              "reference": 11,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.94508471355746, -28.360825227032137],
                  [-50.945771359065276, -28.358408279932547],
                  [-50.95023455486606, -28.363846333511955]]]),
            {
              "reference": 11,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.93650164470981, -28.385595761094827],
                  [-50.93650164470981, -28.389824298551854],
                  [-50.93409838543246, -28.387105972404168]]]),
            {
              "reference": 11,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.76329036249535, -28.540129590359797],
                  [-50.76466365351097, -28.537415127497674],
                  [-50.76844020380394, -28.543748765380197]]]),
            {
              "reference": 11,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.73445125116722, -28.515696907288525],
                  [-50.73616786493675, -28.51961858361914],
                  [-50.73204799188988, -28.51750692987207]]]),
            {
              "reference": 11,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.72621150507347, -28.49397421341541],
                  [-50.725868182319566, -28.498500143452528],
                  [-50.724151568550035, -28.496086338252017]]]),
            {
              "reference": 11,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.64759059442894, -28.51931692138724],
                  [-50.64415736688988, -28.523238463082194],
                  [-50.64484401239769, -28.51961858361914]]]),
            {
              "reference": 11,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.603301959175035, -28.526254934358374],
                  [-50.606048541206285, -28.520825223916162],
                  [-50.60742183222191, -28.522936811207316]]]),
            {
              "reference": 11,
              "system:index": "28"
            })]),
    reg24_revisado = /* color: #98ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-50.18770541072362, -29.480423538181547],
                  [-50.22615755916112, -29.367985919370593],
                  [-50.186296618532936, -29.37395630120626],
                  [-50.12312009401036, -29.317679070772268],
                  [-50.105994595293936, -29.24763587221266],
                  [-50.023547608564066, -29.182323109831668],
                  [-49.94875277400487, -29.111547766171764],
                  [-49.92403353572362, -29.01311643158764],
                  [-49.91441951511446, -28.973751114334785],
                  [-49.92128695369237, -28.864692143010373],
                  [-49.94463861746968, -28.842426611814552],
                  [-49.93776644587987, -28.78949770830127],
                  [-49.83614291072362, -28.726894576603055],
                  [-49.74001253962987, -28.681122407980656],
                  [-49.66036166072362, -28.626892643867677],
                  [-49.635598858290706, -28.599761782392097],
                  [-49.642458639024994, -28.54880703048439],
                  [-49.545691860918936, -28.493609591698387],
                  [-49.52783907771581, -28.43324511254405],
                  [-49.535389806319195, -28.35707777896648],
                  [-49.49694002986425, -28.278472053343766],
                  [-49.38845003962987, -28.16775486398861],
                  [-49.43755772352447, -28.12052500570711],
                  [-49.45368136287206, -28.085398937387115],
                  [-49.54500521541112, -28.01571040129203],
                  [-49.5807068609508, -28.049352298457865],
                  [-49.61641634822362, -28.03934896556342],
                  [-49.69881380916112, -28.022378214269747],
                  [-49.75374544978612, -27.97812046252627],
                  [-49.83614291072362, -27.932631248312674],
                  [-49.87459963652775, -27.92292854240927],
                  [-49.90480746150487, -27.898046632468557],
                  [-49.919227017168936, -27.878625861573582],
                  [-49.903605019036455, -27.869974512992282],
                  [-49.89622594688502, -27.845539512729474],
                  [-49.93227328181737, -27.83066592396974],
                  [-50.02497042537206, -27.788759516686138],
                  [-50.07784212947362, -27.765066137719273],
                  [-50.13277377009862, -27.709153628987263],
                  [-50.14925326228612, -27.658078036126565],
                  [-50.204359324369435, -27.613893571980547],
                  [-50.253797800931935, -27.601724285136754],
                  [-50.308729441556935, -27.5579036650286],
                  [-50.300489695463185, -27.497012670570196],
                  [-50.37121418276787, -27.47142840031061],
                  [-50.422025950346, -27.554859916482805],
                  [-50.511976511869435, -27.6333616188365],
                  [-50.572401316556935, -27.655259032738293],
                  [-50.685011179838185, -27.647960381823754],
                  [-50.778394968900685, -27.699040704707386],
                  [-50.816847117338185, -27.716062170138652],
                  [-50.852552683744435, -27.66985487297957],
                  [-50.937696726713185, -27.62849493166505],
                  [-50.976148875150685, -27.572512483393297],
                  [-50.945936472806935, -27.419023027738984],
                  [-50.907484324369435, -27.326338756375126],
                  [-51.020094187650685, -27.28729059309292],
                  [-51.135450632963185, -27.240903063647018],
                  [-51.640821726713185, -27.362933925392294],
                  [-51.71206273331423, -27.529079592506843],
                  [-51.805616648588185, -27.81570594775508],
                  [-51.8008101300335, -27.95954192066465],
                  [-51.80973652163506, -28.135888780410024],
                  [-51.73835206599052, -28.19096962071969],
                  [-51.709486277494435, -28.24966333580644],
                  [-51.632581980619435, -28.424324860824413],
                  [-51.69918659487725, -28.563123299509197],
                  [-51.651808054838185, -28.732450629868833],
                  [-51.492506297025685, -28.795050430633186],
                  [-51.390882761869435, -28.790236394529817],
                  [-51.289259226713185, -28.845584383313458],
                  [-51.138197214994435, -28.876855011865903],
                  [-51.031080515775685, -28.896093799081292],
                  [-51.058546336088185, -29.047474552159663],
                  [-51.0475579894909, -29.148244134150982],
                  [-51.064039500150685, -29.19863349488617],
                  [-50.95554950991631, -29.2543621636806],
                  [-50.89135933401514, -29.25468757701843],
                  [-50.78594806948662, -29.281316756990687],
                  [-50.871778757963185, -29.356751786619615],
                  [-50.83813312808037, -29.384277654215957],
                  [-50.79727270884503, -29.378908487163066],
                  [-50.75967911388331, -29.354073988739447],
                  [-50.706983836088185, -29.3687204695908],
                  [-50.638319285306935, -29.45246183969778],
                  [-50.60673359194756, -29.465614922526917],
                  [-50.437818797025685, -29.50745429031137],
                  [-50.36228931522345, -29.503286688376544],
                  [-50.308729441556935, -29.512234832102227],
                  [-50.220838816556935, -29.505063934758628]]]),
            {
              "system:index": "0"
            })]);

// Define the region ID (reg_24)
var regiaoID = 'reg_24'; // old 29

// Define whether to collect data (false)
var coleta = false;   // true or false

// Define the years to process (2016-2023)
var anos = [2016,2017,2018,2019,2020,2021,2022,2023]

// If collecting data, only process 2023
if (coleta) {var anos = [2023]}

// Define the number of trees for the Random Forest classifier (100)
var RFtrees = 100;

// If collecting data, use 200 trees
if (coleta) {var RFtrees = 200}

// Define the output version (1)
var versao_out = 1;

// Define the version of the point data (S2_v1)
var versao_pt = 'S2_v1';

// Define the stable version (3)
var versao_estavel = '3'

// Define the input directory for point data
var dir_pt_in = 'projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/';

// Load the 250,000 biomes feature collection
var bioma250mil = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil');

// Filter the collection to only include the Atlantic Forest biome
var bioma250mil_MA_vetor = bioma250mil.filterMetadata('Bioma','equals', 'Mata Atlântica');

// Load the biomes raster
var biomes = ee.Image('projects/mapbiomas-workspace/AUXILIAR/biomas-raster-41');

// Mask the biomes raster to only include the Atlantic Forest biome
var bioma250mil_MA = biomes.mask(biomes.eq(2));

// Add the Atlantic Forest biome layer to the map
Map.addLayer(bioma250mil_MA,{},'layer bioma',false)

// Import the palettes module
var palettes = require('users/mapbiomas/modules:Palettes.js');

// Define the visualization parameters for the classification
var vis = {
    'min': 0,
    'max': 62,
    'palette': palettes.get('classification7')
};

// Load the Atlantic Forest regions feature collection
var regioesCollection = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/Mata_Atlantica_col6_PLANET');

// Define the visualization parameters for the median composite
var visParMedian2 = {bands: ['swir1_median', 'nir_median', 'red_median'],gain: [0.08, 0.06, 0.2],gamma: 0.85}

// Define the biome name (MATAATLANTICA)
var bioma = "MATAATLANTICA";

// Define the output directory
var dirout = 'projects/mapbiomas-workspace/COLECAO7/classificacao-ma/';

// Load the Sentinel-2 cluster image
var S2_cluster = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/mosaicos_MA_S2_clusters_2106_2023')

// Define the region boundary (reg24_revisado)
//var limite = regioesCollection.filterMetadata('reg_id', "equals", regiaoID);
var limite = reg24_revisado

// Load the stable map from collection 6
var mapa_estavel_col6 = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/col7/MATA_ATLANTICA/MA_amostras_estaveis85a20_col6_v1')

// Add the stable map layer to the map
Map.addLayer(mapa_estavel_col6, vis, 'mapa_estavel_col6', false);

// Create a blank image
var blank = ee.Image(0).mask(0);
// Outline the region boundary
var outline = blank.paint(limite, 'AA0000', 2); 
// Define the visualization parameters for the outline
var visPar = {'palette':'000000','opacity': 0.6};
// Add the outline layer to the map
Map.addLayer(outline, visPar, regiaoID, false);

// Define a function to shuffle a feature collection
var shuffle = function (collection, seed) {
    // Add a random column to the collection
    collection = collection.randomColumn('random', seed || 1)
        // Sort the collection by the random column
        .sort('random', true)
        // Map over the collection and set a new ID based on the random column
        .map(function (feature) {
                var rescaled = ee.Number(feature.get('random')).multiply(1000000000).round();
                return feature.set('new_id', rescaled)});
    // Get a list of the new IDs
    var randomIdList = ee.List(collection.reduceColumns(ee.Reducer.toList(), ['new_id']).get('list'));
    // Create a sequential list of IDs
    var sequentialIdList = ee.List.sequence(1, collection.size());
    // Remap the collection using the new and sequential IDs
    var shuffled = collection.remap(randomIdList, sequentialIdList, 'new_id');
    // Return the shuffled collection
    return shuffled;
};

// Define the visualization parameters for the hand-labeled data
var vis_hand = {
    'min': 0,
    'max': 60,
    'palette': 'blue,white,green,orange,red,brown'
};

// Loop through the years
for (var i_ano=0;i_ano<anos.length; i_ano++){
  // Get the current year
  var ano = anos[i_ano];

  // Define the asset path for the Sentinel-2 mosaics
  var asset = 'projects/mapbiomas-mosaics/assets/SENTINEL/BRAZIL/mosaics-3';
  // Define the band names to use for classification
  var bandNames = ee.List([
  //  THE 60 MOST IMPORTANT BANDS FOR THIS REGION
  'latitude','longitude','green_median_texture_'+ano,'red_edge_2_median_wet','green_min','spri_median_1','evi_median_dry','cvi_median','blue_median','blue_median_wet','red_median','swir2_median_dry','awei_median_wet','ndwi_median_'+ano,'nir_median','osavi_median_wet','cvi_median_wet','ndvi_median_dry_'+ano,'ndvi_median_wet_'+ano,'spri_median','ri_median_wet','avi_median_wet','iia_median_dry','ratio_median_dry','avi_median_dry','ndvi_median_dry','red_edge_4_median','evi_median_wet','gvmi_median','iia_median','nir_median_dry','blue_median_dry','swir1_stdDev','red_edge_1_median_wet','swir1_median_wet','brba_median_wet','nddi_median','red_edge_1_median','gemi_median_dry','nddi_median_wet','iia_median_wet','swir2_median_wet','red_median_dry','gcvi_median_wet','red_edge_4_stdDev','afvi_median','ndwi_median_dry','green_median_texture','swir2_stdDev','afvi_median_dry','afvi_median_wet','mbi_median_dry','ui_median_dry','bsi_median_2','swir2_median','awei_median_dry','brba_median','ui_median','ndwi_median','ri_median_dry',

  // ALL 143 BANDS TO FEATURE IMPORTANCE
  //    'blue_median','afvi_median','afvi_median_dry','afvi_median_wet','avi_median','avi_median_dry','avi_median_wet','awei_median','awei_median_dry','awei_median_wet','blue_median_dry','blue_median_wet','blue_stdDev','brba_median','brba_median_dry','brba_median_wet','brightness_median','brightness_median_dry','brightness_median_wet','bsi_median','bsi_median_1','bsi_median_2','clusters_2023','co2flux_median','cvi_median','cvi_median_dry','cvi_median_wet','dswi5_median','dswi5_median_dry','dswi5_median_wet','evi_median','evi_median_dry','evi_median_wet','gcvi_median','gcvi_median_dry','gcvi_median_wet','gemi_median','gemi_median_dry','gemi_median_wet','gli_median','gli_median_dry','gli_median_wet','green_median','green_median_dry','green_median_texture','green_median_texture_2023','green_median_wet','green_min','green_stdDev','gvmi_median','gvmi_median_1','gvmi_median_dry','gvmi_median_dry_1','gvmi_median_wet','gvmi_median_wet_1','iia_median','iia_median_dry','iia_median_wet','lai_median','latitude','longitude','lswi_median','lswi_median_dry','lswi_median_wet','mbi_median','mbi_median_dry','mbi_median_wet','msi_median','msi_median_dry','msi_median_wet','nddi_median','nddi_median_dry','nddi_median_wet','ndvi_median','ndvi_median_dry','ndvi_median_dry_2023','ndvi_median_wet','ndvi_median_wet_2023','ndwi_median','ndwi_median_2023','ndwi_median_dry','ndwi_median_wet','nir_median','nir_median_contrast','nir_median_dry','nir_median_dry_contrast','nir_median_wet','nir_stdDev','osavi_median','osavi_median_dry','osavi_median_wet','ratio_median','ratio_median_dry','ratio_median_wet','red_edge_1_median','red_edge_1_median_dry','red_edge_1_median_wet','red_edge_1_stdDev','red_edge_2_median','red_edge_2_median_dry','red_edge_2_median_wet','red_edge_2_stdDev','red_edge_3_median','red_edge_3_median_dry','red_edge_3_median_wet','red_edge_3_stdDev','red_edge_4_median','red_edge_4_median_dry','red_edge_4_median_wet','red_edge_4_stdDev','red_median','red_median_contrast','red_median_dry','red_median_dry_contrast','red_median_wet','red_min','red_stdDev','ri_median','ri_median_dry','ri_median_wet','rvi_median','rvi_median_1','rvi_median_wet','shape_median','shape_median_dry','shape_median_wet','spri_median','spri_median_1','spri_median_wet','swir1_median','swir1_median_dry','swir1_median_wet','swir1_stdDev','swir2_median','swir2_median_dry','swir2_median_wet','swir2_stdDev','ui_median','ui_median_dry','ui_median_wet','wetness_median','wetness_median_dry','wetness_median_wet',
  ])

  // Load the Sentinel-2 mosaic for the current year
  var collection = ee.ImageCollection(asset)
        // Filter the collection by version and year
        .filter(ee.Filter.eq('version', '3'))
        .filter(ee.Filter.eq('year', ano))
        // Filter the collection by biome
        .filter(ee.Filter.inList('biome', [
            'MATAATLANTICA',
        ])); 

  // Create a mosaic from the filtered collection
  var mosaicoTotal = collection.mosaic()

  // Add indices for the Caatinga biome
  var addIndexCaatinga = require('users/marcosrosaUSP/MapBiomas_col9_MataAtlan:Mata_Atlantica_SENTINEL2/processa_Bandas_Sentinel2_CAATINGA');
  mosaicoTotal = addIndexCaatinga.get(mosaicoTotal);

  // Add bands from the Sentinel-2 cluster image
  mosaicoTotal = mosaicoTotal.addBands(S2_cluster.select([
    'clusters_'+ano, 'ndvi_median_dry_'+ano,'ndvi_median_wet_'+ano,'ndwi_median_'+ano, 'green_median_texture_'+ano
    ]))
    
  // Add the Sentinel-2 mosaic layer to the map
  Map.addLayer(mosaicoTotal, {'bands': ['swir1_median', 'nir_median', 'red_median'],
    'gain': [0.08, 0.07, 0.2],'gamma': 0.85}, 'Sentinel 2 '+ano, false);

  // Print the mosaic
  //print(mosaicoTotal)

  // Load the training data
  //var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/REGIONs_'+regiaoID+'_'+ano)
  var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/pontos_train_v1_'+ano)
                    // Filter the training data by region ID
                    .filterMetadata('reg_id', 'equals', regiaoID)
                    
    // Filter the training data by reference class
    var BDflo = BDamostras.filterMetadata("reference", "equals", 3)
    var BDsav = BDamostras.filterMetadata("reference", "equals", 4)//.limit(100)
    var BDreflo = BDamostras.filterMetadata("reference", "equals", 9)
    var BDvarzea = BDamostras.filterMetadata("reference", "equals", 11)
    var BDcampo = BDamostras.filterMetadata("reference", "equals", 12)
    var BDOutroNFlo = BDamostras.filterMetadata("reference", "equals", 13)
    var BDagro = BDamostras.filterMetadata("reference", "equals", 21)
    // Shuffle the agriculture training data
    // BDagro = shuffle(BDagro, 2).limit(2500)
    var BDNaoVeg = BDamostras.filterMetadata("reference", "equals", 22)
    var BDAflora = BDamostras.filterMetadata("reference", "equals", 29)
    var BDagua = BDamostras.filterMetadata("reference", "equals", 33)

  // Complementary samples
  // Merge the training data for different classes
  var amostraTotal = campo.merge(reflo).merge(flo).merge(agro).merge (varzea)//.merge(aflora)//.merge(agua)
  
  // Reduce the training data to an image
  var amostraTotalimg = amostraTotal.reduceToImage({properties: ['reference'],reducer: ee.Reducer.first()})

  // Rename the band
  amostraTotalimg = amostraTotalimg.select([0],['reference'])

   // Sample the mosaic for the forest class
  var training_flo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // Sample the mosaic for the reforestation class
  var training_reflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': reflo.filterBounds(limite), 'scale': 10, 'seed': 1});
  //  // Sample the mosaic for the non-forest class
  //  var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 300, 'region': nao_flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // // Sample the mosaic for the savanna class
  // var training_sav = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 2000, 'region': savana.filterBounds(limite), 'scale': 10, 'seed': 1});
  // // Sample the mosaic for the aflora class
  // var training_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': aflora.filterBounds(limite), 'scale': 10, 'seed': 1});
  // Sample the mosaic for the varzea class
  var training_var = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': varzea.filterBounds(limite), 'scale': 10, 'seed': 1});
  // // Sample the mosaic for the water class
  // var training_agu = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 100, 'region': agua.filterBounds(limite), 'scale': 10, 'seed': 1});
  // Sample the mosaic for the campo class
  var training_cam = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 4500, 'region': campo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // // Sample the mosaic for the restinga class
  // var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 500, 'region': restinga.filterBounds(limite), 'scale': 10, 'seed': 1});
  // Sample the mosaic for the agriculture class
  var training_agr = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 100, 'region': agro.filterBounds(limite), 'scale': 10, 'seed': 1});

// If collecting data, print the size of each training set
if (coleta) {
// print('BDflo',BDflo.size())
// print('BDsav',BDsav.size())
// print('BDvar',BDvarzea.size())
// print('BDcam',BDcampo.size())
// print('BDOut',BDOutroNFlo.size())
// print('BDAfl',BDAflora.size())
// print('BDagr',BDagro.size())
// print('BDNao',BDNaoVeg.size())
// print('BDagu',BDagua.size())
print('training_flo',training_flo.size())
print('training_var',training_var.size())
// print('training_nflo',training_nflo.size())
//print('training_cam',training_cam.size())
//print('training_ref',training_reflo.size())
// print('training_sav',training_sav.size())
// print('training_afl',training_afl.size())
// print('training_cam',training_cam.size())
print('training_agr',training_agr.size())
}

  // Merge all the training data
  var training = BDflo.merge(BDreflo).merge(BDcampo)//.merge(BDsav).merge(BDOutroNFlo).merge(BDAflora)
                      .merge(BDagro).merge(BDNaoVeg).merge(BDagua)
                      // Add the complementary training data
                      .merge(training_cam)
                      .merge(training_reflo).merge(training_agr).merge(training_flo).merge (training_var)
                      // .merge(training_afl)
                      // //.merge(training_agu).merge(training_agr)

  // Train a Random Forest classifier
  var classifierRF = ee.Classifier.smileRandomForest({numberOfTrees: RFtrees, variablesPerSplit:1}).train(training, 'reference', bandNames);

  // Print the classifier explanation if collecting data
  if (coleta) {print(classifierRF.explain())}

  // Train a Gradient Tree Boost classifier
  var classifierGTB = ee.Classifier.smileGradientTreeBoost({numberOfTrees: 30, shrinkage: 0.1, samplingRate: 0.8, loss: 'LeastSquares'}).train(training, 'reference', bandNames);

  // Print the classifier explanation
  // print(classifier.explain())

  // Classify the mosaic using the Random Forest classifier
  var classifiedRF = mosaicoTotal.classify(classifierRF).mask(mosaicoTotal.select('blue_median'));

  // Classify the mosaic using the Gradient Tree Boost classifier
  var classifiedGTB = mosaicoTotal.classify(classifierGTB).mask(mosaicoTotal.select('blue_median'));

  // Rename the classification band and clip the image to the region boundary
  classifiedRF = classifiedRF.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()
  // classifiedGTB = classifiedGTB.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()

  // Add the classified layers to the map if collecting data
  if (coleta) {  
    Map.addLayer(classifiedRF, vis, 'RF'+ano+"_"+regiaoID, false);
//    Map.addLayer(classifiedGTB, vis, 'GTB'+ano+"_"+regiaoID, false);
  }

  // Combine the classified images for all years
  if (i_ano == 0){ var classified16a23RF = classifiedRF;}//  var classified16a23GTB = classifiedGTB}  
  else {classified16a23RF = classified16a23RF.addBands(classifiedRF);}// classified16a23GTB = classified16a23GTB.addBands(classifiedGTB)}
}

// If collecting data, do nothing
if (coleta) {}
   // Otherwise, export the classified image to an asset
   else 
   {
     // Set metadata for the classified image
     classified16a23RF = classified16a23RF
     .set('territory', 'BRAZIL')
     .set('biome', 'MATA ATÂNTICA')
     .set('source', 'arcplan')
     .set('version', '1')
     .set('collection_id',versao_out)

//     classified16a23GTB = classified16a23GTB
//     .set('territory', 'BRAZIL')
//     .set('biome', 'MATA ATÂNTICA')
//     .set('source', 'arcplan')
//     .set('version', '1')
//     .set('collection_id',versao_out)
     
    // Export the classified image to an asset
    Export.image.toAsset({
       "image": classified16a23RF.toInt8(),
       "description": regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "assetId": dirout + regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "scale": 10,
       "pyramidingPolicy": {
           '.default': 'mode'
       },
       "maxPixels": 1e13,
       "region": limite
     });    
     
//    Export.image.toAsset({
//       "image": classified16a23GTB.toInt8(),
//       "description": regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "assetId": dirout + regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "scale": 10,
//       "pyramidingPolicy": {
//           '.default': 'mode'
//       },
//       "maxPixels": 1e13,
//       "region": limite
//     });    
}
