var varzea = /* color: #00ffff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.8019676551462, -23.796458986022255],
                  [-46.8005085334421, -23.800542677293663],
                  [-46.79827693554171, -23.799914425453235],
                  [-46.79947856518038, -23.796694587084712]]]),
            {
              "reference": 11,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.79278377147921, -23.786013576325548],
                  [-46.79295543285616, -23.78130108665554],
                  [-46.79467204662569, -23.78420714214188],
                  [-46.79364207836397, -23.787741446403363]]]),
            {
              "reference": 11,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.72480586620577, -23.76386339232635],
                  [-46.7290974006296, -23.766848389111722],
                  [-46.72549251171358, -23.766691285724956]]]),
            {
              "reference": 11,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.80016521068819, -23.806118281623576],
                  [-46.80565837475069, -23.814441974266767],
                  [-46.80102351757296, -23.810358720023]]]),
            {
              "reference": 11,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.803598438227255, -23.82763314862886],
                  [-46.80617335888155, -23.827319088631807],
                  [-46.80497172924288, -23.82920343721024]]]),
            {
              "reference": 11,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.76630927372623, -23.893597140205074],
                  [-46.762876046187166, -23.89312628975653],
                  [-46.75995780277896, -23.890615058415104]]]),
            {
              "reference": 11,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.70964459797186, -23.88345198067453],
                  [-46.70835713764471, -23.88062663072146],
                  [-46.70955876728338, -23.880705113497548]]]),
            {
              "reference": 11,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.81418637653631, -23.87160079403571],
                  [-46.81547383686346, -23.875054231970587],
                  [-46.81375722309393, -23.87411239439746]]]),
            {
              "reference": 11,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.810152334177914, -23.906758763425376],
                  [-46.80843572040838, -23.908720422136273],
                  [-46.80783490558905, -23.906680296457672]]]),
            {
              "reference": 11,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.780566797233334, -23.935084668594207],
                  [-46.77670441625189, -23.937202794150668],
                  [-46.77970849034857, -23.93398636758491]]]),
            {
              "reference": 11,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.75524674413275, -23.952420896237093],
                  [-46.754302606559506, -23.954146547062408],
                  [-46.75327263829779, -23.95265621361832]]]),
            {
              "reference": 11,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.79567299840521, -23.93351566429175],
                  [-46.79258309362005, -23.935163118308715],
                  [-46.792497262931576, -23.933672565580167]]]),
            {
              "reference": 11,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.6389796274098, -24.49338512638147],
                  [-47.6441294687184, -24.479950054611],
                  [-47.64584608248793, -24.494009978518374],
                  [-47.63623304537855, -24.506193974572398]]]),
            {
              "reference": 11,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.77493543795668, -24.450262834559062],
                  [-47.779741956511366, -24.453075608112798],
                  [-47.77733869723402, -24.45651335718383]]]),
            {
              "reference": 11,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.59228773287855, -24.464013574980644],
                  [-47.583018018523084, -24.469638445211167],
                  [-47.58610792330824, -24.463701074822815]]]),
            {
              "reference": 11,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.470408155241834, -24.442449245273128],
                  [-47.455645276823866, -24.436198025112333],
                  [-47.46731825045668, -24.437135727895296]]]),
            {
              "reference": 11,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.50748701266371, -24.418692960075816],
                  [-47.511606885710584, -24.416504656167398],
                  [-47.51092024020277, -24.421819042692917]]]),
            {
              "reference": 11,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.61288709811293, -24.430571661984253],
                  [-47.603960706511366, -24.42525764412127],
                  [-47.60911054781996, -24.42619542824585]]]),
            {
              "reference": 11,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.84696217717086, -24.303091831796394],
                  [-47.849537097825156, -24.30809809875527],
                  [-47.845588886155234, -24.307159438749025]]]),
            {
              "reference": 11,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.86412831486617, -24.28838478029291],
                  [-47.86859151066695, -24.288697714024963],
                  [-47.86395665348922, -24.290731764482356]]]),
            {
              "reference": 11,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.87286858625601, -24.232423670386407],
                  [-47.86909203596304, -24.231797525051235],
                  [-47.87098031110953, -24.229605992125038]]]),
            {
              "reference": 11,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.88814644880484, -24.233362882614376],
                  [-47.88505654401968, -24.234928220927742],
                  [-47.88368325300406, -24.23258020623898]]]),
            {
              "reference": 11,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.11634229333563, -23.64784575687363],
                  [-47.11033414514227, -23.653270653610242],
                  [-47.11256574304266, -23.649654080779435]]]),
            {
              "reference": 11,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.06192563684149, -23.64037632813287],
                  [-47.05832074792547, -23.639904560426388],
                  [-47.05883573205633, -23.63361416187522]]]),
            {
              "reference": 11,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.07874845178289, -23.673395840749333],
                  [-47.08406995446844, -23.672452541807495],
                  [-47.079435097290705, -23.6754396317657]]]),
            {
              "reference": 11,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.29566592600307, -22.92209327751475],
                  [-47.29429263498744, -22.9237533822997],
                  [-47.293262666725724, -22.922488542403773]]]),
            {
              "reference": 11,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.244081682228654, -22.9366382657394],
                  [-47.24159259226283, -22.939641927383402],
                  [-47.241764253639786, -22.937349665309014]]]),
            {
              "reference": 11,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.21146602060756, -22.952209157179723],
                  [-47.20974940683803, -22.95331564980984],
                  [-47.20974940683803, -22.951576871613756]]]),
            {
              "reference": 11,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.27017421152553, -22.95418503052767],
                  [-47.27094668772182, -22.952288192667698],
                  [-47.27240580942592, -22.954105996147824]]]),
            {
              "reference": 11,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.21395045072138, -22.74062222103909],
                  [-47.20931559354364, -22.74394684079267],
                  [-47.21068888455927, -22.74078053809908]]]),
            {
              "reference": 11,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.0860627248913, -22.753128703777236],
                  [-47.08623438626825, -22.74932938702762],
                  [-47.08932429105341, -22.753445308737263]]]),
            {
              "reference": 11,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.04537897855341, -22.72858958805314],
                  [-47.047438915076846, -22.73017288972738],
                  [-47.047438915076846, -22.73254780787153]]]),
            {
              "reference": 11,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.09956275555767, -22.69198809050847],
                  [-47.10059272381939, -22.694363671222618],
                  [-47.099219432803764, -22.695788999880364]]]),
            {
              "reference": 11,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.10829136035012, -22.638666040790458],
                  [-47.111724587889185, -22.63771542760926],
                  [-47.11086628100442, -22.63993351480011]]]),
            {
              "reference": 11,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.987613412352076, -22.60982784896645],
                  [-46.99053165576028, -22.60649997611547],
                  [-46.98950168749856, -22.61157098833498]]]),
            {
              "reference": 11,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.99619648119973, -22.580666607781666],
                  [-46.99756977221536, -22.578923077082383],
                  [-46.99756977221536, -22.582251616543783]]]),
            {
              "reference": 11,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.79497790178597, -22.54200533893226],
                  [-46.79446291765511, -22.544700598514627],
                  [-46.79205965837777, -22.543907880571375]]]),
            {
              "reference": 11,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.78450655779183, -22.556273761929678],
                  [-46.78450655779183, -22.55896874281459],
                  [-46.782103298514485, -22.557224937666348]]]),
            {
              "reference": 11,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.79343294939339, -22.513622647505166],
                  [-46.79240298113167, -22.517111337282596],
                  [-46.791373012869954, -22.514574117086234]]]),
            {
              "reference": 11,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.8582969521616, -22.375723523188896],
                  [-46.85984190455418, -22.37826328477601],
                  [-46.858983597669415, -22.380803000011593]]]),
            {
              "reference": 11,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.864476761731915, -22.37635846793091],
                  [-46.86293180933934, -22.37635846793091],
                  [-46.86138685694676, -22.374453625014812]]]),
            {
              "reference": 11,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.404977074211445, -22.74166993587858],
                  [-46.401715508049335, -22.741274145460004],
                  [-46.4051487355884, -22.73984929046436]]]),
            {
              "reference": 11,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.06087832456225, -22.679209597767304],
                  [-45.06602816587085, -22.67715053588768],
                  [-45.06276659970874, -22.682535709328892]]]),
            {
              "reference": 11,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.07890276914233, -22.671606754073377],
                  [-45.07237963681811, -22.671606754073377],
                  [-45.07598452573413, -22.669389178603353]]]),
            {
              "reference": 11,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.93268756710118, -23.303592691545813],
                  [-44.93028430782384, -23.30989884254689],
                  [-44.92633609615392, -23.302173766364977]]]),
            {
              "reference": 11,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.874698406553236, -23.560767834752557],
                  [-45.871007686948744, -23.560295780578176],
                  [-45.872981792783705, -23.559430343520397]]]),
            {
              "reference": 11,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.14711067276777, -23.684860298464073],
                  [-46.14985725479902, -23.68721830910205],
                  [-46.147625656898626, -23.687375508297578]]]),
            {
              "reference": 11,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.084711762245306, -23.687139709433318],
                  [-46.08565589981855, -23.68588210830064],
                  [-46.08642837601484, -23.688161501437037]]]),
            {
              "reference": 11,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.252357509878465, -22.988128092850996],
                  [-47.248580959585496, -22.987970063733414],
                  [-47.24840929820854, -22.986942869962153],
                  [-47.252615001943894, -22.98678483945781]]]),
            {
              "reference": 11,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.24574854686577, -23.00440410142102],
                  [-47.24248698070366, -23.00440410142102],
                  [-47.244117763784715, -23.002823992425807]]]),
            {
              "reference": 11,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.255361583975144, -23.008986312881447],
                  [-47.25493243053276, -23.011988367049195],
                  [-47.25415995433647, -23.01151436293756],
                  [-47.25450327709038, -23.00835429296579]]]),
            {
              "reference": 11,
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.18177623492791, -23.641411020918547],
                  [-47.18048877460076, -23.64015297986747],
                  [-47.182892033878105, -23.639602583105464]]]),
            {
              "reference": 11,
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.18452281695916, -23.636850564581703],
                  [-47.18478030902459, -23.635513848995764],
                  [-47.1854669545324, -23.635907002055447]]]),
            {
              "reference": 11,
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.15096301776482, -23.642433170369078],
                  [-47.15053386432244, -23.641725529292003],
                  [-47.151907155338066, -23.641489648082764]]]),
            {
              "reference": 11,
              "system:index": "53"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.17576808673455, -23.643298059822968],
                  [-47.174652287784355, -23.642590423422174],
                  [-47.17722720843865, -23.642590423422174]]]),
            {
              "reference": 11,
              "system:index": "54"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.2114736531408, -23.651160429041024],
                  [-47.20992870074822, -23.654226624976296],
                  [-47.20864124042107, -23.65296870713287],
                  [-47.20919914968398, -23.651042500300417]]]),
            {
              "reference": 11,
              "system:index": "55"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.20580882770135, -23.630324117966786],
                  [-47.20366306048943, -23.62875143159265],
                  [-47.20349139911248, -23.627021454768197],
                  [-47.20623798114373, -23.62867279677818]]]),
            {
              "reference": 11,
              "system:index": "56"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.21379108172967, -23.637715490923316],
                  [-47.2129327748449, -23.642983555228305],
                  [-47.211130330386894, -23.64015297986747],
                  [-47.21297570257539, -23.635631795037636]]]),
            {
              "reference": 11,
              "system:index": "57"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.14272327167107, -23.643298059822968],
                  [-47.14177913409783, -23.641725529292003],
                  [-47.1440965626867, -23.64188278319532]]]),
            {
              "reference": 11,
              "system:index": "58"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.231043050113456, -23.633705329715166],
                  [-47.22769565326287, -23.63527795659325],
                  [-47.22700900775506, -23.634727539334577],
                  [-47.23018474322869, -23.632840376880875]]]),
            {
              "reference": 11,
              "system:index": "59"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.214821049991386, -23.643298059822968],
                  [-47.21705264789178, -23.639366698070425],
                  [-47.21799678546502, -23.643691189503485]]]),
            {
              "reference": 11,
              "system:index": "60"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.941894179636, -24.220725379579992],
                  [-46.939576751047134, -24.220020901142586],
                  [-46.94034922724342, -24.218846761754804],
                  [-46.94361079340553, -24.22009917671694]]]),
            {
              "reference": 11,
              "system:index": "61"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.98386538630104, -24.151119761708426],
                  [-46.9829212487278, -24.153860858289992],
                  [-46.98086131220436, -24.15378254206088],
                  [-46.9814621270237, -24.15190293816075]]]),
            {
              "reference": 11,
              "system:index": "62"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.93425524836159, -24.218024701606335],
                  [-46.9320236504612, -24.220372984713993],
                  [-46.930564528757095, -24.219746780118406],
                  [-46.93296778803444, -24.217398485466063]]]),
            {
              "reference": 11,
              "system:index": "63"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.87626033565919, -24.1867881256259],
                  [-46.874372060512705, -24.189763339254398],
                  [-46.874629552578135, -24.186709829593312]]]),
            {
              "reference": 11,
              "system:index": "64"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.9889091289358, -24.156448451915637],
                  [-46.98942411306666, -24.15394235953059],
                  [-46.99139821890162, -24.155273727231165]]]),
            {
              "reference": 11,
              "system:index": "65"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.98547590139674, -24.1592564440481],
                  [-46.984360102446544, -24.157846804116794],
                  [-46.9859908855276, -24.156828721158654]]]),
            {
              "reference": 11,
              "system:index": "66"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.110196399127254, -23.8053284777469],
                  [-46.1085656160462, -23.807448727150085],
                  [-46.10805063191534, -23.805485534445324]]]),
            {
              "reference": 11,
              "system:index": "67"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.10075502339483, -23.80634934289167],
                  [-46.10006837788702, -23.807841362129693],
                  [-46.098952578936824, -23.806506398355538]]]),
            {
              "reference": 11,
              "system:index": "68"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.59941739076793, -22.972685792224066],
                  [-45.59993237489879, -22.97189555447333],
                  [-45.6017348193568, -22.972290673926224]]]),
            {
              "reference": 11,
              "system:index": "69"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.60499638551891, -22.97655789041442],
                  [-45.60473889345348, -22.975530609870017],
                  [-45.60645550722301, -22.976478869111336]]]),
            {
              "reference": 11,
              "system:index": "70"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.625853242818714, -22.99441551937785],
                  [-45.62593907350719, -22.995837706893745],
                  [-45.62473744386852, -22.995758696869213]]]),
            {
              "reference": 11,
              "system:index": "71"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.646538438741565, -23.005871604138516],
                  [-45.644821824972034, -23.00389648648187],
                  [-45.645079317037464, -23.00326444272648],
                  [-45.647310914937854, -23.005476582919844]]]),
            {
              "reference": 11,
              "system:index": "72"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.50433117012087, -22.91041889580214],
                  [-45.50106960395876, -22.9093911131686],
                  [-45.50227123359743, -22.90614959382728],
                  [-45.50579029182497, -22.908126139231296]]]),
            {
              "reference": 11,
              "system:index": "73"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.54805147978543, -23.587912766633977],
                  [-45.54746139380215, -23.589367955454936],
                  [-45.54751503798245, -23.58813891190173]]]),
            {
              "reference": 11,
              "system:index": "74"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.55202114912747, -23.59109842926183],
                  [-45.55148470732449, -23.591334401194423],
                  [-45.551624182193265, -23.590793631554078]]]),
            {
              "reference": 11,
              "system:index": "75"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.557354547868876, -23.591904951068333],
                  [-45.55744037855735, -23.593517407569426],
                  [-45.55692539442649, -23.59237689160787]]]),
            {
              "reference": 11,
              "system:index": "76"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.26856218771128, -22.731016077190084],
                  [-45.266995777646585, -22.731134823344675],
                  [-45.26716743902354, -22.730818166703315]]]),
            {
              "reference": 11,
              "system:index": "77"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.29817139481445, -22.739127943339383],
                  [-45.29817139481445, -22.739899745711522],
                  [-45.297592037667236, -22.739246682449473]]]),
            {
              "reference": 11,
              "system:index": "78"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.48427066875454, -22.425887789574073],
                  [-46.48360548091885, -22.42642333108645],
                  [-46.48399171901699, -22.4243604931738],
                  [-46.48469982219692, -22.424519174101384]]]),
            {
              "reference": 11,
              "system:index": "79"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.48010788036343, -22.428664649073774],
                  [-46.48000059200283, -22.429775377320478],
                  [-46.47948560787197, -22.429140676553533]]]),
            {
              "reference": 11,
              "system:index": "80"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.48300466609951, -22.4270580442778],
                  [-46.48279008937832, -22.428069612428477],
                  [-46.48197469783779, -22.42773242386394]]]),
            {
              "reference": 11,
              "system:index": "81"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.47530619897946, -22.406745363441104],
                  [-46.47431914606198, -22.40743967920652],
                  [-46.475220368290984, -22.405932017703808]]]),
            {
              "reference": 11,
              "system:index": "82"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.47483413019284, -22.40501947779547],
                  [-46.47431914606198, -22.405178180818666],
                  [-46.474168942357146, -22.40472190913854]]]),
            {
              "reference": 11,
              "system:index": "83"
            })]),
    aflora = /* color: #bf04c2 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.127960749304464, -22.509868690617804],
                  [-45.11748940531032, -22.50051197024618],
                  [-45.119206019079854, -22.493216460975937],
                  [-45.12272507730739, -22.4934543640852],
                  [-45.12427002969997, -22.50225649154731],
                  [-45.13122231546657, -22.507807094746617]]]),
            {
              "reference": 29,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.076462336218526, -22.485920567033883],
                  [-45.07714898172634, -22.48243109050115],
                  [-45.0831571299197, -22.48417583976246]]]),
            {
              "reference": 29,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.825982407962954, -22.44104915037952],
                  [-44.8327630323526, -22.435813207616302],
                  [-44.834908799564516, -22.440493832483998],
                  [-44.82932980481354, -22.444539669106977]]]),
            {
              "reference": 29,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.798773571839725, -22.445571715790408],
                  [-44.79697054503914, -22.438350759546843],
                  [-44.80366691197529, -22.439382455522935],
                  [-44.80538445878197, -22.44493730263046]]]),
            {
              "reference": 29,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.67320378247467, -22.36550552860645],
                  [-44.66977055493561, -22.401060582886657],
                  [-44.66084416333405, -22.398203816115178],
                  [-44.66256077710358, -22.357885406582714]]]),
            {
              "reference": 29,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.712322567356196, -22.16133344055443],
                  [-44.71575579489526, -22.15386118423546],
                  [-44.716614101780024, -22.160379557589966]]]),
            {
              "reference": 29,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.70528445090112, -22.12412721416893],
                  [-44.710605953586665, -22.11840230696477],
                  [-44.710090969455806, -22.12476330061556]]]),
            {
              "reference": 29,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.68984410646507, -22.04224407486822],
                  [-44.684179281025614, -22.04749474609998],
                  [-44.686925863056864, -22.04033469156818]]]),
            {
              "reference": 29,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.6889857995803, -22.027286549652086],
                  [-44.684179281025614, -22.02108030412096],
                  [-44.689157460957254, -22.02346735381485]]]),
            {
              "reference": 29,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.66686360601337, -22.00206450993866],
                  [-44.67046849492939, -22.00222366918931],
                  [-44.66617696050556, -22.009544801583793]]]),
            {
              "reference": 29,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.71561543706806, -22.00413356626225],
                  [-44.71132390264423, -22.004770192902843],
                  [-44.71269719365986, -22.00047290760675]]]),
            {
              "reference": 29,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.45846693129629, -22.0977816239627],
                  [-44.464131756735746, -22.092373763201646],
                  [-44.46155683608145, -22.098099726966115]]]),
            {
              "reference": 29,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.53263688667031, -22.158190625500847],
                  [-44.53589845283242, -22.154056993606815],
                  [-44.5348684845707, -22.159621469785176]]]),
            {
              "reference": 29,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.52697206123086, -22.18124134485714],
                  [-44.5319502411625, -22.18140030221359],
                  [-44.52783036811562, -22.18489731856393]]]),
            {
              "reference": 29,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.541048294141014, -22.187122647290078],
                  [-44.54310823066445, -22.18442045782272],
                  [-44.54465318305703, -22.188394247879437]]]),
            {
              "reference": 29,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.56336427314492, -22.193003703524354],
                  [-44.567484146191795, -22.19141425314756],
                  [-44.564737564160545, -22.194593135913564]]]),
            {
              "reference": 29,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.65222797578191, -22.12548382721436],
                  [-44.65497455781316, -22.11991800192228],
                  [-44.65497455781316, -22.12627892717001]]]),
            {
              "reference": 29,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.77416441000191, -22.111159721972328],
                  [-44.77708265341011, -22.104957158247828],
                  [-44.779485912687456, -22.112591044094373]]]),
            {
              "reference": 29,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.77107450521675, -22.073622092438175],
                  [-44.773477764494096, -22.069645064054537],
                  [-44.77296278036324, -22.07489471787936]]]),
            {
              "reference": 29,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.82529218360241, -22.06411350966802],
                  [-44.830098702157095, -22.065386220740166],
                  [-44.829583718026235, -22.068567948283864]]]),
            {
              "reference": 29,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.137663964590466, -21.973834121531873],
                  [-44.14109719212953, -21.975744400773777],
                  [-44.140410546621716, -21.981156719050844]]]),
            {
              "reference": 29,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.74660055923068, -22.73454171860067],
                  [-44.75381033706271, -22.746573827770522],
                  [-44.743167331691616, -22.74182443751008]]]),
            {
              "reference": 29,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.67793600844943, -22.7741170355678],
                  [-44.68239920425021, -22.771584558753307],
                  [-44.682055881496304, -22.775699809713473],
                  [-44.676562717433804, -22.777282565501487]]]),
            {
              "reference": 29,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.81223623977271, -22.432920747193755],
                  [-44.81094877944556, -22.430540658289317],
                  [-44.81627028213111, -22.428477881558376],
                  [-44.822535922389896, -22.432206724808054]]]),
            {
              "reference": 29,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.75543319891397, -22.804871503651256],
                  [-44.75320160101358, -22.80455501800077],
                  [-44.75448906134073, -22.803051701123305]]]),
            {
              "reference": 29,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.71955597113077, -22.80154836766255],
                  [-44.71929847906534, -22.8035264345604],
                  [-44.717581865295806, -22.8016274908897]]]),
            {
              "reference": 29,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.74444687078897, -22.790470662543417],
                  [-44.7432452411503, -22.78983762363602],
                  [-44.74513351629678, -22.789521103080325]]]),
            {
              "reference": 29,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.70393478582803, -22.810330765415685],
                  [-44.704106447204985, -22.811834001983065],
                  [-44.7022181720585, -22.81120106229228]]]),
            {
              "reference": 29,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.69844162176553, -22.78144958071107],
                  [-44.698613283142485, -22.782953135782375],
                  [-44.695866701111235, -22.78334880541526]]]),
            {
              "reference": 29,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.734833833679595, -22.793635812998467],
                  [-44.73526298712198, -22.79490185260774],
                  [-44.732602235779204, -22.795930501133558]]]),
            {
              "reference": 29,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.75775062750284, -22.215628172196357],
                  [-44.75792228887979, -22.216343303722446],
                  [-44.75543319891397, -22.21689951461129]]]),
            {
              "reference": 29,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.72427665899698, -22.22842052983478],
                  [-44.72427665899698, -22.227387649854904],
                  [-44.72590744207803, -22.227943816943448]]]),
            {
              "reference": 29,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.748824235901274, -22.19615930284717],
                  [-44.748824235901274, -22.19727188240798],
                  [-44.74496185491983, -22.19727188240798],
                  [-44.74513351629678, -22.196397713495138]]]),
            {
              "reference": 29,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.74590599249307, -22.205457018152032],
                  [-44.745562669739165, -22.207046309566344],
                  [-44.74298774908487, -22.2060132721941]]]),
            {
              "reference": 29,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.76470291326944, -22.213085452802954],
                  [-44.763758775696196, -22.21395951779229],
                  [-44.76247131536905, -22.213005992079374]]]),
            {
              "reference": 29,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.20097654781053, -22.743108108928805],
                  [-44.200547394368144, -22.744532929954435],
                  [-44.194796738240214, -22.74128748267011]]]),
            {
              "reference": 29,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.192994293782206, -22.740575057098276],
                  [-44.19144934138963, -22.740654215678518],
                  [-44.18999021968553, -22.737487836716276]]]),
            {
              "reference": 29,
              "system:index": "36"
            })]),
    agua = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.727324080337524, -23.673168742088762],
                  [-46.72749574171448, -23.731640072779914],
                  [-46.72543580519104, -23.730068605557793],
                  [-46.72543580519104, -23.6744264656056]]]),
            {
              "reference": 33,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.675139021743774, -23.705865618255643],
                  [-46.65350968824768, -23.7357257988774],
                  [-46.6380601643219, -23.77594764352779],
                  [-46.63806133538991, -23.773668279526838],
                  [-46.652651381362915, -23.734154380922618],
                  [-46.67350945827378, -23.706572551262983]]]),
            {
              "reference": 33,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.66138960000109, -23.58259879011682],
                  [-46.6595013248546, -23.58157617393944],
                  [-46.661217938624134, -23.58102553115935]]]),
            {
              "reference": 33,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.69606519814562, -23.578036287191154],
                  [-46.69460607644152, -23.58102553115935],
                  [-46.69349027749132, -23.581261521205096],
                  [-46.695378552637806, -23.578193617518036]]]),
            {
              "reference": 33,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.72353101845812, -23.554277244614056],
                  [-46.71975446816515, -23.55632289414469],
                  [-46.717608700953235, -23.556558928580014],
                  [-46.72241521950792, -23.554198565150084]]]),
            {
              "reference": 33,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.6251665973109, -22.979876743416288],
                  [-45.625080766622425, -22.978691448130586],
                  [-45.626539888326526, -22.97971870464563]]]),
            {
              "reference": 33,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.60070485109508, -22.97971870464563],
                  [-45.60018986696422, -22.97782222497941],
                  [-45.60190648073375, -22.97821732710494]]]),
            {
              "reference": 33,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.636067094747425, -23.006108616314656],
                  [-45.63623875612438, -23.00500255593106],
                  [-45.63744038576305, -23.005397578537348]]]),
            {
              "reference": 33,
              "system:index": "7"
            })]),
    flo = /* color: #00ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.39729616874285, -23.814232379101075],
                  [-46.39472124808855, -23.82836575171778],
                  [-46.39394877189226, -23.827973178819466],
                  [-46.39506457084246, -23.81266190936194]]]),
            {
              "reference": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.3821041368825, -23.815724307756128],
                  [-46.38433573478289, -23.80991354160678],
                  [-46.38399241202898, -23.816352483112745]]]),
            {
              "reference": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.43214342826433, -23.82585326464189],
                  [-46.432315089641286, -23.828993865884172],
                  [-46.43102762931414, -23.83017157174929]]]),
            {
              "reference": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.407853343425465, -23.833155045420966],
                  [-46.40871165031023, -23.83111372874321],
                  [-46.408625819621754, -23.834646756522822]]]),
            {
              "reference": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.269881870726564, -23.837837076088743],
                  [-46.26327290771387, -23.834853710117912],
                  [-46.27074017761133, -23.835874343041894]]]),
            {
              "reference": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.2788940930166, -23.839250225487973],
                  [-46.281125690916994, -23.837444531855876],
                  [-46.28052487609766, -23.840192316531475]]]),
            {
              "reference": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.61802987481645, -24.01729202109391],
                  [-46.61811570550493, -24.02332865596421],
                  [-46.61596993829301, -24.02183912305206]]]),
            {
              "reference": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.60601357842973, -24.026934822062557],
                  [-46.60730103875688, -24.024191009235174],
                  [-46.60712937737993, -24.02787554440523]]]),
            {
              "reference": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.61227921868852, -24.03947722041011],
                  [-46.61476830865434, -24.04198555314648],
                  [-46.611420911803755, -24.042377475711547]]]),
            {
              "reference": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.59115486108087, -24.041566525285386],
                  [-46.58840827904962, -24.040233975271],
                  [-46.587721633541804, -24.042350371776944],
                  [-46.585919189083796, -24.04101782989494],
                  [-46.587721633541804, -24.039920432082024],
                  [-46.59184150658868, -24.039606888127654]]]),
            {
              "reference": 3,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.87774352990411, -24.07824541219524],
                  [-46.87825851403497, -24.07393540295767],
                  [-46.880575942623835, -24.075737788080353],
                  [-46.88100509606622, -24.077931961862802],
                  [-46.87868766747735, -24.079420844117074]]]),
            {
              "reference": 3,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.94635858746995, -24.09108407492793],
                  [-46.952280904974835, -24.090535591282958],
                  [-46.95356836530198, -24.09288621894585],
                  [-46.946186926093, -24.09233774301487]]]),
            {
              "reference": 3,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.829529491567364, -24.01402480124698],
                  [-46.825237957143536, -24.01888561402589],
                  [-46.82489463438963, -24.011672729102532]]]),
            {
              "reference": 3,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.819744793081036, -24.022178318280492],
                  [-46.81545325865721, -24.022491904763598],
                  [-46.81682654967283, -24.019356005511003]]]),
            {
              "reference": 3,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.85503744935662, -23.301968164642417],
                  [-45.85606741761834, -23.311742690625064],
                  [-45.853492496964044, -23.30251997153078]]]),
            {
              "reference": 3,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.71025103262302, -23.608927234500037],
                  [-45.7641527049863, -23.664754483872297],
                  [-45.7311937206113, -23.633777231810978]]]),
            {
              "reference": 3,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.907702112296626, -23.678382950319172],
                  [-45.8704515934978, -23.68970157441066],
                  [-45.88967766771655, -23.682155933989296]]]),
            {
              "reference": 3,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.62883481912346, -23.987287806576614],
                  [-46.598021601960376, -23.97136797295839],
                  [-46.61870679788323, -23.98101421542743]]]),
            {
              "reference": 3,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.673357036856004, -23.94062584365115],
                  [-47.66812136485893, -23.945410983516023],
                  [-47.66674807384331, -23.937566398944245]]]),
            {
              "reference": 3,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.25750735118706, -22.997056437606368],
                  [-47.25518992259819, -22.99745148346915],
                  [-47.25639155223686, -22.9961083228192]]]),
            {
              "reference": 3,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.222917583731004, -22.994923169971813],
                  [-47.22429087474663, -22.996187332639106],
                  [-47.222917583731004, -22.996503371456377]]]),
            {
              "reference": 3,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.14023418170525, -23.093028530618987],
                  [-47.13680095416619, -23.090502010574813],
                  [-47.14057750445916, -23.08797544303132]]]),
            {
              "reference": 3,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.14358157855584, -23.64015297986747],
                  [-47.1440965626867, -23.638423153679586],
                  [-47.14572734576775, -23.639288069630958]]]),
            {
              "reference": 3,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.20846957904412, -23.628830066359892],
                  [-47.20726794940545, -23.62710009057412],
                  [-47.21052951556756, -23.628122351754953]]]),
            {
              "reference": 3,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.23696536761834, -23.654226624976296],
                  [-47.23593539935662, -23.656427952094198],
                  [-47.23370380145623, -23.65477696022896]]]),
            {
              "reference": 3,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.96910250788307, -24.173516713253136],
                  [-46.969531661325455, -24.176022421520443],
                  [-46.96558344965553, -24.176257329148523]]]),
            {
              "reference": 3,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.9583736718235, -24.18995952580235],
                  [-46.95674288874245, -24.18792386394757],
                  [-46.95845950251198, -24.187062612613946]]]),
            {
              "reference": 3,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.919578200632095, -24.182756268728326],
                  [-46.91648829584694, -24.185026904529188],
                  [-46.91794741755104, -24.182756268728326]]]),
            {
              "reference": 3,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.96292269831276, -24.20992294873602],
                  [-46.961806899362564, -24.21446321241521],
                  [-46.95897448664284, -24.210392638687946]]]),
            {
              "reference": 3,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.95786884725497, -24.14904065588968],
                  [-46.95795467794345, -24.15256496946656],
                  [-46.95615223348544, -24.15037207466522]]]),
            {
              "reference": 3,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.635211240015735, -23.42368332758151],
                  [-46.63383794900011, -23.429668755627127],
                  [-46.62662817116808, -23.424628413178844]]]),
            {
              "reference": 3,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.98093725319933, -23.25598155205861],
                  [-46.98265386696886, -23.249988289575604],
                  [-46.986773740015735, -23.25408897195578]]]),
            {
              "reference": 3,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.52397466775011, -23.225697047636285],
                  [-46.52157140847277, -23.2200179379357],
                  [-46.52981115456652, -23.22222650929701]]]),
            {
              "reference": 3,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.68509085544707, -23.003401187305275],
                  [-46.6868074692166, -23.006245358011473],
                  [-46.68337424167754, -23.00719340159242]]]),
            {
              "reference": 3,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.78654222432257, -22.575912828113303],
                  [-46.78894548359991, -22.580350959819132],
                  [-46.78379564229132, -22.581935972212655]]]),
            {
              "reference": 3,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.93269853535772, -22.729578943707793],
                  [-45.93578844014288, -22.73432875938136],
                  [-45.928921985064754, -22.734962055672913]]]),
            {
              "reference": 3,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.25988511983038, -22.745094397389543],
                  [-46.258511828814754, -22.742244752191468],
                  [-46.26434831563116, -22.743511268503365]]]),
            {
              "reference": 3,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.40270738545538, -23.034181274043217],
                  [-46.40270738545538, -23.030073859159284],
                  [-46.405797290240535, -23.03196960466089]]]),
            {
              "reference": 3,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.365628528033504, -23.2911185946438],
                  [-46.36631517354132, -23.296164012403167],
                  [-46.36150865498663, -23.295848679397416]]]),
            {
              "reference": 3,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.17989091817022, -23.474698257010502],
                  [-46.17474107686163, -23.477847299568506],
                  [-46.17199449483038, -23.470289471151965]]]),
            {
              "reference": 3,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.035008716021785, -23.671997515678445],
                  [-46.026768969928035, -23.68174464366492],
                  [-46.018529223834285, -23.671997515678445]]]),
            {
              "reference": 3,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.139893817340145, -23.804307604577637],
                  [-46.13852052632452, -23.801401998561794],
                  [-46.142640399371395, -23.80273701480256]]]),
            {
              "reference": 3,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.24306230488897, -23.930206981907837],
                  [-46.24434976521612, -23.9353847564399],
                  [-46.2389424318421, -23.933188150183195]]]),
            {
              "reference": 3,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.814079942647815, -23.687042098442834],
                  [-45.80481022829235, -23.680439552476425],
                  [-45.81819981569469, -23.67760978776286]]]),
            {
              "reference": 3,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.66988438600719, -23.721621408327405],
                  [-45.661301317159534, -23.741421793816812],
                  [-45.65786808962047, -23.72539314223545]]]),
            {
              "reference": 3,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.42749852174938, -23.565313081706684],
                  [-45.432305040304065, -23.57034804648411],
                  [-45.425095262472034, -23.570662725374028]]]),
            {
              "reference": 3,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.75751751894176, -23.006740646749183],
                  [-45.75751751894176, -22.997575915734746],
                  [-45.76335400575817, -22.99852402021485]]]),
            {
              "reference": 3,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.644821824972034, -23.00982175272297],
                  [-45.646538438741565, -23.009663748999987],
                  [-45.6456801318568, -23.011401779775255]]]),
            {
              "reference": 3,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.589415748405884, -22.810308464212977],
                  [-45.585639198112915, -22.816637770250654],
                  [-45.579116065788696, -22.81062493649956]]]),
            {
              "reference": 3,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.84390776382056, -22.187478325329366],
                  [-44.83841459975806, -22.184935096060666],
                  [-44.84699766860572, -22.181120165843264]]]),
            {
              "reference": 3,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.180621554714115, -22.538079854926227],
                  [-45.181651522975834, -22.5323719103967],
                  [-45.190577914577396, -22.535860126757512]]]),
            {
              "reference": 3,
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.04993761860118, -22.868334703705145],
                  [-45.04993761860118, -22.864222251425677],
                  [-45.05405749164805, -22.866436664275135]]]),
            {
              "reference": 3,
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.79473237695373, -23.08790944864369],
                  [-44.794389054199826, -23.092646726149848],
                  [-44.79129914941467, -23.090751835186126]]]),
            {
              "reference": 3,
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.144234940430295, -23.407142037411685],
                  [-45.13977174462951, -23.398004719711004],
                  [-45.144234940430295, -23.39705944395628]]]),
            {
              "reference": 3,
              "system:index": "53"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.30396585168518, -23.78578223865857],
                  [-45.300532624146115, -23.780755567992593],
                  [-45.31117562951721, -23.78295476032307]]]),
            {
              "reference": 3,
              "system:index": "54"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.68942939947549, -23.321888446872485],
                  [-44.688399431213774, -23.317159288152872],
                  [-44.69251930426065, -23.317789852370648]]]),
            {
              "reference": 3,
              "system:index": "55"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.622481462463774, -23.007824224207443],
                  [-44.621451494202056, -22.99865956677624],
                  [-44.63381111334268, -22.999607663645346]]]),
            {
              "reference": 3,
              "system:index": "56"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.64908897589151, -22.81120106229228],
                  [-44.647200700745024, -22.80835279729233],
                  [-44.64934646795694, -22.80748248222074]]]),
            {
              "reference": 3,
              "system:index": "57"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.34885322760049, -22.768945691492636],
                  [-44.34576332281534, -22.773694138778172],
                  [-44.34198677252237, -22.770528525609205],
                  [-44.34336006353799, -22.766729692895925]]]),
            {
              "reference": 3,
              "system:index": "58"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.731314775452056, -22.511333466346123],
                  [-44.73268806646768, -22.50594159241022],
                  [-44.73612129400674, -22.51006480904277]]]),
            {
              "reference": 3,
              "system:index": "59"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.46077644537393, -22.318807734764235],
                  [-44.45322334478799, -22.31753731791305],
                  [-44.46008979986612, -22.309914573999237]]]),
            {
              "reference": 3,
              "system:index": "60"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.51296150396768, -21.986917715842445],
                  [-44.513819810852446, -21.98962368775011],
                  [-44.51030075262491, -21.98922575394126]]]),
            {
              "reference": 3,
              "system:index": "61"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.20440017889444, -22.003868982824088],
                  [-44.20440017889444, -22.008961925408407],
                  [-44.198220369324126, -22.008007012610783]]]),
            {
              "reference": 3,
              "system:index": "62"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.19617002925584, -22.746195202377375],
                  [-44.20089071712205, -22.747145063255562],
                  [-44.19994657954881, -22.75039037143954],
                  [-44.19565504512498, -22.748015763260657]]]),
            {
              "reference": 3,
              "system:index": "63"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.31907957515428, -22.801434459816612],
                  [-44.31667631587693, -22.795104447537437],
                  [-44.32491606197068, -22.79605396811811]]]),
            {
              "reference": 3,
              "system:index": "64"
            })]),
    agro = /* color: #d63000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.39614001041483, -23.792062104279935],
                  [-47.396612079201454, -23.790884052699013],
                  [-47.39747038608622, -23.7919442996024]]]),
            {
              "reference": 21,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.414334832549955, -23.78238271794699],
                  [-47.41274696481314, -23.78108676412329],
                  [-47.41502147805777, -23.78151875016645]]]),
            {
              "reference": 21,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.40113616824914, -23.76920578561648],
                  [-47.40135074497033, -23.76826317952978],
                  [-47.401736983068474, -23.76963781112378]]]),
            {
              "reference": 21,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.459715645583735, -23.734296501915843],
                  [-47.45980147627221, -23.732725066725113],
                  [-47.46108893659936, -23.732803638934687],
                  [-47.46091727522241, -23.734257216267018]]]),
            {
              "reference": 21,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.38636304527768, -23.698333521291755],
                  [-47.38640596062192, -23.69723321529564],
                  [-47.38773633629331, -23.696683058819666],
                  [-47.38799382835874, -23.69849070710552]]]),
            {
              "reference": 21,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.307581954021074, -23.64662705367194],
                  [-47.30642323972664, -23.64544768754589],
                  [-47.30835443021736, -23.64505456314189],
                  [-47.30865483762703, -23.647138109025583]]]),
            {
              "reference": 21,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.14441732772228, -23.56322096337357],
                  [-46.147035163720815, -23.562394882879623],
                  [-46.147764724572866, -23.563338974448676],
                  [-46.1448893965089, -23.563811017689037]]]),
            {
              "reference": 21,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.97194344908959, -23.516171711506075],
                  [-45.97383172423608, -23.517273538178266],
                  [-45.975634168694086, -23.517667045469487],
                  [-45.97855241210229, -23.519083661979522],
                  [-45.97760827452905, -23.52010676442354],
                  [-45.97160012633569, -23.517037433239015]]]),
            {
              "reference": 21,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.968681882927484, -23.53828518169005],
                  [-45.96902520568139, -23.53671139205859],
                  [-45.970398496697015, -23.537891736047506]]]),
            {
              "reference": 21,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.7727258191076, -23.314265032318346],
                  [-45.77469992494256, -23.3150532542839],
                  [-45.773584125992365, -23.31662968419482]]]),
            {
              "reference": 21,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.86526255792841, -23.292713515481854],
                  [-45.86148600763544, -23.294526712778534],
                  [-45.86380343622431, -23.29216166792288]]]),
            {
              "reference": 21,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.733009365347215, -23.852500528368658],
                  [-47.733009365347215, -23.85595447562615],
                  [-47.72717287853081, -23.85564048422546],
                  [-47.72785952403862, -23.852500528368658]]]),
            {
              "reference": 21,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.147443959537284, -23.374751801367893],
                  [-47.14881725055291, -23.377903224900546],
                  [-47.14435405475213, -23.380109176791457]]]),
            {
              "reference": 21,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.1440965626867, -23.64636444001216],
                  [-47.13911838275506, -23.64604994278668],
                  [-47.138689229312675, -23.64384844104503],
                  [-47.14461154681756, -23.644084318003074]]]),
            {
              "reference": 21,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-47.21979922992303, -23.62505554427646],
                  [-47.2195417378576, -23.626706911072354],
                  [-47.2169668172033, -23.62654963894117]]]),
            {
              "reference": 21,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.988767895106534, -24.14230503068597],
                  [-46.98790958822177, -24.14473302952248],
                  [-46.98645046651767, -24.144028131385543]]]),
            {
              "reference": 21,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.72318769570421, -23.548218788081172],
                  [-46.725075970850696, -23.54955639341211],
                  [-46.723616849146595, -23.549792439998907]]]),
            {
              "reference": 21,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.818814563189754, -22.57496178129362],
                  [-46.81538133565069, -22.575912828113303],
                  [-46.81709794942022, -22.571791577828574]]]),
            {
              "reference": 21,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.36940507832647, -23.040500129402787],
                  [-46.36597185078741, -23.045555000304873],
                  [-46.36322526875616, -23.04239572822076]]]),
            {
              "reference": 21,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.275248813067684, -23.934678708505206],
                  [-46.2733605379212, -23.935541655456497],
                  [-46.273188876544246, -23.933580404041862]]]),
            {
              "reference": 21,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-45.402648170280884, -22.819485862010232],
                  [-45.403334815788696, -22.815371932571797],
                  [-45.40951462535901, -22.81695422783205]]]),
            {
              "reference": 21,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-44.36739265631143, -22.616591389324306],
                  [-44.36739265631143, -22.610886695630537],
                  [-44.37357246588174, -22.616274468103942]]]),
            {
              "reference": 21,
              "system:index": "21"
            })]),
    campo = /* color: #d63000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.70566822457455, -23.349584288046092],
                  [-46.705582393886075, -23.34800824918622],
                  [-46.707813991786466, -23.346905010849596],
                  [-46.70747066903256, -23.349426685002253]]]),
            {
              "reference": 12,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.69554020333432, -23.343437630670028],
                  [-46.69579769539975, -23.339497315994592],
                  [-46.69691349434994, -23.34233435434812]]]),
            {
              "reference": 12,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.68541218209408, -23.3447773110208],
                  [-46.68481136727475, -23.34115226240098],
                  [-46.68627048897885, -23.339576123434046],
                  [-46.68678547310971, -23.34406807016618]]]),
            {
              "reference": 12,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.72077442574643, -23.35525787297712],
                  [-46.71914364266537, -23.352499910599555],
                  [-46.722319378139005, -23.353997097288538]]]),
            {
              "reference": 12,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.72712589669369, -23.350057096054734],
                  [-46.72867084908627, -23.349190280085587],
                  [-46.72995830941342, -23.351160308191275]]]),
            {
              "reference": 12,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.67845989632748, -23.351396709598855],
                  [-46.68026234078549, -23.352815109200996],
                  [-46.67880321908139, -23.352815109200996]]]),
            {
              "reference": 12,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.67528416085385, -23.3447773110208],
                  [-46.676399959804044, -23.342255548545733],
                  [-46.676914943934904, -23.34509252796216]]]),
            {
              "reference": 12,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.70635497297352, -23.362267767743234],
                  [-46.70287883009022, -23.361952591598154],
                  [-46.70571124280995, -23.361322237061326]]]),
            {
              "reference": 12,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.69966017927235, -23.358131021251815],
                  [-46.6978148194701, -23.35797342835859],
                  [-46.699788925305064, -23.357421851758094]]]),
            {
              "reference": 12,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.71382224287098, -23.354033545190788],
                  [-46.71167647565907, -23.356042900224445],
                  [-46.712792274609264, -23.35375774898781]]]),
            {
              "reference": 12,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.718757507458385, -23.355294320533048],
                  [-46.718328354016, -23.35430934082053],
                  [-46.71931540693348, -23.353954746334136]]]),
            {
              "reference": 12,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.69191174211667, -23.34922027726277],
                  [-46.69229798021482, -23.349890089948296],
                  [-46.69152550401853, -23.35024469529565]]]),
            {
              "reference": 12,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.69707947009363, -23.3331930304342],
                  [-46.69274502032556, -23.332680756621198],
                  [-46.69553451770105, -23.33193204518687]]]),
            {
              "reference": 12,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.700898935730834, -23.333074813575777],
                  [-46.70330219500818, -23.33181382720621],
                  [-46.701585581238646, -23.33413876151378]]]),
            {
              "reference": 12,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.71514683001794, -23.338039831035765],
                  [-46.7136447929696, -23.337094127734698],
                  [-46.715103914673705, -23.336345441178555]]]),
            {
              "reference": 12,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.722099115784545, -23.339300758294225],
                  [-46.72051124804773, -23.33827625580873],
                  [-46.72197036975183, -23.338512680160772]]]),
            {
              "reference": 12,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.732728168818895, -23.347043165969268],
                  [-46.73238484606499, -23.345348891005216],
                  [-46.73388688311333, -23.346333937220436]]]),
            {
              "reference": 12,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.72955243334526, -23.349210230333462],
                  [-46.72963826403374, -23.3483434088335],
                  [-46.7310544703936, -23.34905262684545]]]),
            {
              "reference": 12,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.72835080370659, -23.354174644406317],
                  [-46.72736375078911, -23.353623052013695],
                  [-46.72826497301811, -23.35279565912567]]]),
            {
              "reference": 12,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.738736317012254, -23.353150256709373],
                  [-46.73916547045464, -23.35181066086601],
                  [-46.739680454585496, -23.353386654572102]]]),
            {
              "reference": 12,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-46.738394576450645, -23.349170829479004],
                  [-46.73719294681197, -23.34932843282666],
                  [-46.73719294681197, -23.34850101316364]]]),
            {
              "reference": 12,
              "system:index": "20"
            })]);

// Define the region ID (reg_30)
var regiaoID = 'reg_30'; // old 11

// Define whether to collect data (false)
var coleta = false;   // true or false

// Define the years to process (2016-2023)
var anos = [2016,2017,2018,2019,2020,2021,2022,2023]

// If collecting data, only process 2023
if (coleta) {var anos = [2023]}

// Define the number of trees for the Random Forest classifier (100)
var RFtrees = 100;

// If collecting data, use 20 trees
if (coleta) {var RFtrees = 20}

// Define output version (2)
var versao_out = 2;

// Define the version of the point data (S2_v1)
var versao_pt = 'S2_v1';

// Define the stable version (3)
var versao_estavel = '3'

// Define the input directory for point data
var dir_pt_in = 'projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/';

// Load the 250,000 biomes feature collection
var bioma250mil = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/biomas_IBGE_250mil');

// Filter the collection to only include the Atlantic Forest biome
var bioma250mil_MA_vetor = bioma250mil.filterMetadata('Bioma','equals', 'Mata Atlântica');

// Load the biomes raster
var biomes = ee.Image('projects/mapbiomas-workspace/AUXILIAR/biomas-raster-41');

// Mask the biomes raster to only include the Atlantic Forest biome
var bioma250mil_MA = biomes.mask(biomes.eq(2));

// Add the Atlantic Forest biome layer to the map
Map.addLayer(bioma250mil_MA,{},'layer bioma',false)

// Import the palettes module
var palettes = require('users/mapbiomas/modules:Palettes.js');

// Define visualization parameters for the classification
var vis = {
    'min': 0,
    'max': 62,
    'palette': palettes.get('classification7')
};

// Load the Atlantic Forest regions feature collection
var regioesCollection = ee.FeatureCollection('projects/mapbiomas-workspace/AUXILIAR/Mata_Atlantica_col6_PLANET');

// Define visualization parameters for the median composite
var visParMedian2 = {bands: ['swir1_median', 'nir_median', 'red_median'],gain: [0.08, 0.06, 0.2],gamma: 0.85}

// Define the biome name (MATAATLANTICA)
var bioma = "MATAATLANTICA";

// Define the output directory
var dirout = 'projects/mapbiomas-workspace/COLECAO7/classificacao-ma/';

// Load the Sentinel-2 clusters image
var S2_cluster = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/mosaicos_MA_S2_clusters_2106_2023')

// Filter the regions collection to only include the specified region ID
var limite = regioesCollection.filterMetadata('reg_id', "equals", regiaoID);
//var limite = reg_04_rev

// Load the stable map from collection 6
var mapa_estavel_col6 = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/col7/MATA_ATLANTICA/MA_amostras_estaveis85a20_col6_v1')

// Add the stable map layer to the map
Map.addLayer(mapa_estavel_col6, vis, 'mapa_estavel_col6', false);

// Create a blank image
var blank = ee.Image(0).mask(0);
// Outline the region boundary
var outline = blank.paint(limite, 'AA0000', 2); 
// Define visualization parameters for the outline
var visPar = {'palette':'000000','opacity': 0.6};
// Add the outline layer to the map
Map.addLayer(outline, visPar, regiaoID, false);

// Define a function to shuffle a feature collection
var shuffle = function (collection, seed) {
    // Add a random column to the collection
    collection = collection.randomColumn('random', seed || 1)
        // Sort the collection by the random column
        .sort('random', true)
        // Map over the collection and set a new ID based on the random value
        .map(function (feature) {
                var rescaled = ee.Number(feature.get('random')).multiply(1000000000).round();
                return feature.set('new_id', rescaled)});
    // Get a list of the new IDs
    var randomIdList = ee.List(collection.reduceColumns(ee.Reducer.toList(), ['new_id']).get('list'));
    // Create a sequential list of IDs
    var sequentialIdList = ee.List.sequence(1, collection.size());
    // Remap the collection using the new and sequential IDs
    var shuffled = collection.remap(randomIdList, sequentialIdList, 'new_id');
    // Return the shuffled collection
    return shuffled;
};

// Define visualization parameters for the hand-labeled data
var vis_hand = {
    'min': 0,
    'max': 60,
    'palette': 'blue,white,green,orange,red,brown'
};

// Loop through each year
for (var i_ano=0;i_ano<anos.length; i_ano++){
  // Get the current year
  var ano = anos[i_ano];

  // Define the asset path for the Sentinel-2 mosaics
  var asset = 'projects/mapbiomas-mosaics/assets/SENTINEL/BRAZIL/mosaics-3';
  // Define the band names to use for classification
  var bandNames = ee.List([
  //  THE 60 MOST IMPORTANT BANDS FOR THIS REGION
  'ndvi_median_dry_'+ano,'ui_median_dry','red_edge_3_median_wet','green_median_wet','lswi_median','swir2_median_wet','avi_median_dry','green_median_texture_'+ano,'wetness_median_dry','bsi_median_2','red_edge_4_median_wet','awei_median_dry','msi_median_dry','longitude','brba_median_wet','ndvi_median_wet_'+ano,'red_edge_4_median','green_median','gli_median_wet','green_median_texture','gemi_median_wet','latitude','brightness_median','ndwi_median_dry','red_median_dry','ndwi_median_wet','red_edge_2_median_wet','red_min','osavi_median_dry','swir1_median','ndvi_median_dry','msi_median','nir_median_wet','red_edge_3_median','brba_median','ri_median_wet','mbi_median_wet','cvi_median','red_edge_1_median','swir1_median_dry','ndwi_median_'+ano,'wetness_median_wet','blue_median_wet','iia_median_wet','evi_median','red_median_wet','ndwi_median','nddi_median_wet','afvi_median_dry','spri_median_wet','ratio_median','brightness_median_wet','avi_median','gvmi_median_wet','wetness_median','nddi_median_dry','ri_median_dry','spri_median_1','iia_median_dry','shape_median_wet',

  // ALL 143 BANDS TO FEATURE IMPORTANCE
  //    'blue_median','afvi_median','afvi_median_dry','afvi_median_wet','avi_median','avi_median_dry','avi_median_wet','awei_median','awei_median_dry','awei_median_wet','blue_median_dry','blue_median_wet','blue_stdDev','brba_median','brba_median_dry','brba_median_wet','brightness_median','brightness_median_dry','brightness_median_wet','bsi_median','bsi_median_1','bsi_median_2','clusters_2023','co2flux_median','cvi_median','cvi_median_dry','cvi_median_wet','dswi5_median','dswi5_median_dry','dswi5_median_wet','evi_median','evi_median_dry','evi_median_wet','gcvi_median','gcvi_median_dry','gcvi_median_wet','gemi_median','gemi_median_dry','gemi_median_wet','gli_median','gli_median_dry','gli_median_wet','green_median','green_median_dry','green_median_texture','green_median_texture_2023','green_median_wet','green_min','green_stdDev','gvmi_median','gvmi_median_1','gvmi_median_dry','gvmi_median_dry_1','gvmi_median_wet','gvmi_median_wet_1','iia_median','iia_median_dry','iia_median_wet','lai_median','latitude','longitude','lswi_median','lswi_median_dry','lswi_median_wet','mbi_median','mbi_median_dry','mbi_median_wet','msi_median','msi_median_dry','msi_median_wet','nddi_median','nddi_median_dry','nddi_median_wet','ndvi_median','ndvi_median_dry','ndvi_median_dry_2023','ndvi_median_wet','ndvi_median_wet_2023','ndwi_median','ndwi_median_2023','ndwi_median_dry','ndwi_median_wet','nir_median','nir_median_contrast','nir_median_dry','nir_median_dry_contrast','nir_median_wet','nir_stdDev','osavi_median','osavi_median_dry','osavi_median_wet','ratio_median','ratio_median_dry','ratio_median_wet','red_edge_1_median','red_edge_1_median_dry','red_edge_1_median_wet','red_edge_1_stdDev','red_edge_2_median','red_edge_2_median_dry','red_edge_2_median_wet','red_edge_2_stdDev','red_edge_3_median','red_edge_3_median_dry','red_edge_3_median_wet','red_edge_3_stdDev','red_edge_4_median','red_edge_4_median_dry','red_edge_4_median_wet','red_edge_4_stdDev','red_median','red_median_contrast','red_median_dry','red_median_dry_contrast','red_median_wet','red_min','red_stdDev','ri_median','ri_median_dry','ri_median_wet','rvi_median','rvi_median_1','rvi_median_wet','shape_median','shape_median_dry','shape_median_wet','spri_median','spri_median_1','spri_median_wet','swir1_median','swir1_median_dry','swir1_median_wet','swir1_stdDev','swir2_median','swir2_median_dry','swir2_median_wet','swir2_stdDev','ui_median','ui_median_dry','ui_median_wet','wetness_median','wetness_median_dry','wetness_median_wet',
  ])

  // Filter the Sentinel-2 mosaics collection by version, year, and biome
  var collection = ee.ImageCollection(asset)
        .filter(ee.Filter.eq('version', '3'))
        .filter(ee.Filter.eq('year', ano))
        .filter(ee.Filter.inList('biome', [
            'MATAATLANTICA',
        ])); 

  // Create a mosaic of the filtered collection
  var mosaicoTotal = collection.mosaic()

  // Import the function to add indices for the Caatinga biome
  var addIndexCaatinga = require('users/marcosrosaUSP/MapBiomas_col9_MataAtlan:Mata_Atlantica_SENTINEL2/processa_Bandas_Sentinel2_CAATINGA');

  // Add the Caatinga indices to the mosaic
  mosaicoTotal = addIndexCaatinga.get(mosaicoTotal);

  // Add bands from the Sentinel-2 clusters image to the mosaic
  mosaicoTotal = mosaicoTotal.addBands(S2_cluster.select([
    'clusters_'+ano, 'ndvi_median_dry_'+ano,'ndvi_median_wet_'+ano,'ndwi_median_'+ano, 'green_median_texture_'+ano
    ]))
    
  // Add the mosaic layer to the map
  Map.addLayer(mosaicoTotal, {'bands': ['swir1_median', 'nir_median', 'red_median'],
    'gain': [0.08, 0.07, 0.2],'gamma': 0.85}, 'Sentinel 2 '+ano, false);

  //print(mosaicoTotal)
  //var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/col9/MATA_ATLANTICA/teste/REGIONs_'+regiaoID+'_'+ano)

  // Load the training points for the current year
  var BDamostras = ee.FeatureCollection('projects/mapbiomas-workspace/AMOSTRAS/S2_2024/MATA_ATLANTICA/pontos_train_v1_'+ano)
                    .filterMetadata('reg_id', 'equals', regiaoID)
          
    // Filter the training points by reference class
    var BDflo = BDamostras.filterMetadata("reference", "equals", 3)
    var BDsav = BDamostras.filterMetadata("reference", "equals", 4)//.limit(100)
    var BDreflo = BDamostras.filterMetadata("reference", "equals", 9)
    var BDvarzea = BDamostras.filterMetadata("reference", "equals", 11)
    var BDcampo = BDamostras.filterMetadata("reference", "equals", 12)
    var BDOutroNFlo = BDamostras.filterMetadata("reference", "equals", 13)
    var BDagro = BDamostras.filterMetadata("reference", "equals", 21)
    // BDagro = shuffle(BDagro, 2).limit(1000)
    var BDNaoVeg = BDamostras.filterMetadata("reference", "equals", 22)
    var BDAflora = BDamostras.filterMetadata("reference", "equals", 29)
    var BDagua = BDamostras.filterMetadata("reference", "equals", 33)

// print('BDflo',BDflo.size())
// print('BDsav',BDsav.size())
// print('BDvar',BDvarzea.size())
// print('BDcam',BDcampo.size())
// print('BDOut',BDOutroNFlo.size())
// print('BDAfl',BDAflora.size())
// print('BDagr',BDagro.size())
// print('BDNao',BDNaoVeg.size())
// print('BDagu',BDagua.size())

  // Complementary samples
  // Merge the complementary samples
  var amostraTotal = varzea.merge(aflora).merge(agua).merge(flo).merge(agro).merge(campo)
  
  // Create an image from the merged samples
  var amostraTotalimg = amostraTotal.reduceToImage({properties: ['reference'],reducer: ee.Reducer.first()})

  // Rename the band
  amostraTotalimg = amostraTotalimg.select([0],['reference'])

  // Sample the mosaic using the merged samples
  var training_flo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 400, 'region': flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_sav = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 1000, 'region': sav.filterBounds(limite), 'scale': 10, 'seed': 1});
  var training_afl = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 400, 'region': aflora.filterBounds(limite), 'scale': 10, 'seed': 1});
  var training_var = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 400, 'region': varzea.filterBounds(limite), 'scale': 10, 'seed': 1});
  var training_agu = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 200, 'region': agua.filterBounds(limite), 'scale': 10, 'seed': 1});
  var training_cam = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 700, 'region': campo.filterBounds(limite), 'scale': 10, 'seed': 1});
  // var training_nflo = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 200, 'region': n_flo.filterBounds(limite), 'scale': 10, 'seed': 1});
  var training_agr = mosaicoTotal.select(bandNames).addBands(amostraTotalimg).sample({'numPixels': 600, 'region': agro.filterBounds(limite), 'scale': 10, 'seed': 1});

// If collecting data, print the size of the training samples
if (coleta) {
//  print('training_agr',training_agr.size())
//  print('training_cam',training_cam.size())
//print(training_sav.size())
//print(training_afl.size())
//print(training_cam.size())
print(training_agr.size())
}

  // Merge the training samples
  var training = BDflo.merge(BDreflo).merge(BDcampo)//.merge(BDsav).merge(BDOutroNFlo).merge(BDAflora)
                      .merge(BDagro).merge(BDNaoVeg).merge(BDagua)
                      //complementares
                      .merge(training_afl).merge(training_var).merge(training_agu).merge(training_flo).merge(training_agr).merge(training_cam)

  // Train the Random Forest classifier
  var classifierRF = ee.Classifier.smileRandomForest({numberOfTrees: RFtrees, variablesPerSplit:1}).train(training, 'reference', bandNames);

  // If collecting data, print the classifier explanation
  if (coleta) {print(classifierRF.explain())}

  // Train the Gradient Tree Boost classifier
  var classifierGTB = ee.Classifier.smileGradientTreeBoost({numberOfTrees: 30, shrinkage: 0.1, samplingRate: 0.8, loss: 'LeastSquares'}).train(training, 'reference', bandNames);

  // print(classifier.explain())

  // Classify the mosaic using the Random Forest classifier
  var classifiedRF = mosaicoTotal.classify(classifierRF).mask(mosaicoTotal.select('blue_median'));

  // Classify the mosaic using the Gradient Tree Boost classifier
  var classifiedGTB = mosaicoTotal.classify(classifierGTB).mask(mosaicoTotal.select('blue_median'));

  // Rename the classification band and clip the image to the region boundary
  classifiedRF = classifiedRF.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()
  // classifiedGTB = classifiedGTB.select(['classification'],['classification_'+ano]).clip(limite.geometry()).toInt8()

  // If collecting data, add the classified layers to the map
  if (coleta) {  
    Map.addLayer(classifiedRF, vis, 'RF'+ano+"_"+regiaoID, false);
//    Map.addLayer(classifiedGTB, vis, 'GTB'+ano+"_"+regiaoID, false);
  }

  // If it's the first year, initialize the combined classification image
  if (i_ano == 0){ var classified16a23RF = classifiedRF;}//  var classified16a23GTB = classifiedGTB}  
  // Otherwise, add the current year's classification to the combined image
  else {classified16a23RF = classified16a23RF.addBands(classifiedRF);}// classified16a23GTB = classified16a23GTB.addBands(classifiedGTB)}
}

// If collecting data, do nothing
if (coleta) {}
// Otherwise, export the combined classification image to an asset
   else 
   {
     // Set metadata for the combined classification image
     classified16a23RF = classified16a23RF
     .set('territory', 'BRAZIL')
     .set('biome', 'MATA ATÂNTICA')
     .set('source', 'arcplan')
     .set('version', '1')
     .set('collection_id',versao_out)

//     classified16a23GTB = classified16a23GTB
//     .set('territory', 'BRAZIL')
//     .set('biome', 'MATA ATÂNTICA')
//     .set('source', 'arcplan')
//     .set('version', '1')
//     .set('collection_id',versao_out)
     
    // Export the Random Forest classification to an asset
    Export.image.toAsset({
       "image": classified16a23RF.toInt8(),
       "description": regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "assetId": dirout + regiaoID+'-'+'RF_SENTINEL2_v'+versao_out,
       "scale": 10,
       "pyramidingPolicy": {
           '.default': 'mode'
       },
       "maxPixels": 1e13,
       "region": limite
     });    
     
//    // Export the Gradient Tree Boost classification to an asset
//    Export.image.toAsset({
//       "image": classified16a23GTB.toInt8(),
//       "description": regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "assetId": dirout + regiaoID+'-'+'GTB_SENTINEL2_v'+versao_out,
//       "scale": 10,
//       "pyramidingPolicy": {
//           '.default': 'mode'
//       },
//       "maxPixels": 1e13,
//       "region": limite
//     });    
}
